{"version":3,"sources":["node_modules/kontra/kontra.mjs","src/common/events.js","src/common/helpers.js","src/common/consts.js","src/services/store.js","node_modules/mithril/render/vnode.js","node_modules/mithril/render/hyperscriptVnode.js","node_modules/mithril/render/hyperscript.js","node_modules/mithril/render/trust.js","node_modules/mithril/render/fragment.js","node_modules/mithril/hyperscript.js","node_modules/mithril/promise/polyfill.js","node_modules/mithril/promise/promise.js","node_modules/mithril/render/render.js","node_modules/mithril/render.js","node_modules/mithril/api/mount-redraw.js","node_modules/mithril/mount-redraw.js","node_modules/mithril/querystring/build.js","node_modules/mithril/pathname/assign.js","node_modules/mithril/pathname/build.js","node_modules/mithril/request/request.js","node_modules/mithril/request.js","node_modules/mithril/querystring/parse.js","node_modules/mithril/pathname/parse.js","node_modules/mithril/pathname/compileTemplate.js","node_modules/mithril/api/router.js","node_modules/mithril/route.js","node_modules/mithril/index.js","src/ui/effects.js","src/ui/dialogue.js","src/common/conversationIterator.js","src/input/onPush.js","src/states/startConvoState.js","src/ui/inventory.js","src/ui/questlog.js","src/states/fieldState.js","src/states/curtainState.js","src/managers/sceneManager.js","src/managers/stateManager.js","src/common/spriteFunctions.js","src/sprites/player.js","src/states/aiIdleState.js","src/ai/scripts/talkOnly.js","node_modules/easystarjs/src/instance.js","node_modules/easystarjs/src/node.js","node_modules/heap/lib/heap.js","node_modules/heap/index.js","node_modules/easystarjs/src/easystar.js","src/common/aiHelpers.js","src/states/aiFollowPathState.js","src/ai/scripts/npcRoam.js","src/ai/aiLoader.js","src/sprites/npc.js","src/sprites/fixed.js","src/sprites/pickup.js","src/managers/worldManager.js","src/managers/reactionManager.js","src/index.js"],"names":["kontra","canvasEl","context","callbacks","on","event","callback","push","off","filter","fn","emit","args","map","getCanvas","getContext","init","canvas","document","getElementById","querySelector","Error","imageSmoothingEnabled","Animation","constructor","spriteSheet","frames","frameRate","loop","width","height","margin","frame","_f","_a","clone","reset","update","dt","length","render","x","y","row","col","drawImage","image","factory","arguments","prototype","class","imageRegex","audioRegex","leadingSlash","trailingSlash","dataMap","WeakMap","imagePath","audioPath","dataPath","getUrl","url","base","URL","href","joinPath","replace","s","join","getExtension","split","pop","getName","name","getCanPlay","audio","wav","canPlayType","mp3","ogg","aac","imageAssets","audioAssets","dataAssets","addGlobal","window","__k","dm","u","d","i","setImagePath","path","setAudioPath","setDataPath","loadImage","Promise","resolve","reject","resolvedUrl","fullUrl","Image","onload","location","onerror","src","loadAudio","_url","audioEl","canPlay","Audio","concat","reduce","playableSource","source","addEventListener","load","loadData","fetch","then","response","ok","json","catch","text","set","urls","all","asset","extension","match","degToRad","deg","Math","PI","radToDeg","rad","angleToTarget","target","atan2","rotatePoint","point","angle","sin","cos","randInt","min","max","floor","random","seedRand","str","h","imul","charCodeAt","seed","rand","lerp","start","end","percent","inverseLerp","value","clamp","setStoreItem","key","undefined","localStorage","removeItem","setItem","JSON","stringify","getStoreItem","getItem","parse","e","collides","obj1","obj2","rotation","obj","getWorldRect","world","anchor","Vector","vec","_c","_b","_d","_e","add","subtract","scale","normalize","dot","hypot","distance","acos","xMin","yMin","xMax","yMax","_x","_y","factory$1","Updatable","properties","position","velocity","acceleration","ttl","Infinity","Object","assign","advance","_pc","dx","dy","ddx","ddy","isAlive","noop","srOnlyStyle","addToDom","node","container","parentNode","setAttribute","insertBefore","nextSibling","body","appendChild","GameObject","draw","children","sx","sy","opacity","scaleX","scaleY","props","_di","_uw","child","addChild","_rf","_uf","filterObjects","save","translate","rotate","anchorX","anchorY","globalAlpha","restore","prop","_w","_h","_wx","_wy","_wo","_wr","_wsx","_wsy","parent","_ww","_wh","absolute","removeChild","index","indexOf","splice","_opa","_rot","setScale","_scx","_scy","factory$2","Sprite","animations","firstAnimation","currentAnimation","playAnimation","color","fillStyle","fillRect","factory$3","fontSizeRegex","parseFont","font","size","unit","computed","Text","textAlign","lineHeight","_p","_fw","_t","_fs","_lh","_s","parts","slice","measureText","includes","alignX","dir","textBaseline","fillText","factory$4","pointers","callbacks$1","pressedButtons","buttonMap","getPointer","get","circleRectCollision","object","pointer","radius","getCurrentObject","renderedObjects","_lf","_cf","collidesWithPointer","getPropValue","style","parseFloat","getPropertyValue","getCanvasOffset","rect","getBoundingClientRect","transform","transformScaleX","transformScaleY","borderWidth","borderHeight","paddingWidth","paddingHeight","offsetX","left","offsetY","top","pointerDownHandler","evt","button","pointerHandler","pointerUpHandler","mouseMoveHandler","blurEventHandler","_oo","eventName","preventDefault","isTouchEvent","type","touches","identifier","id","clientX","clientY","changed","changedTouches","onOut","initPointer","getComputedStyle","_o","track","objects","ReferenceError","_r","untrack","pointerOver","onPointerDown","onDown","onPointerUp","onUp","pointerPressed","Button","padX","padY","textNode","_od","_ou","_dn","createElement","textContent","focus","blur","_kd","_ku","destroy","remove","enable","disabled","onEnable","disable","onDisable","focused","activeElement","onFocus","onBlur","onOver","hovered","pressed","code","factory$5","clear","clearRect","GameLoop","fps","clearCanvas","accumulator","last","rAF","now","delta","step","clearFn","requestAnimationFrame","performance","isStopped","stop","cancelAnimationFrame","_frame","_last","handler","startsWith","Reflect","alignment","rtl","center","Grid","flow","align","justify","colGap","rowGap","numCols","breakpoints","Proxy","breakpoint","metric","call","grid","_g","colWidths","_cw","rowHeights","_rh","_nc","spans","colSpan","numRows","acc","_rtl","reverse","topLeftY","rendered","gridRow","topLeftX","justifySelf","alignSelf","colWidth","pointX","pointY","factory$6","callbacks$2","pressedKeys","keyMap","keydownEventHandler","keyupEventHandler","blurEventHandler$1","initKeys","String","fromCharCode","bindKeys","keys","unbindKeys","keyPressed","getMethod","methodName","methodTitle","substr","search","toLowerCase","removeInterceptor","interceptors","registerPlugin","kontraObj","pluginObj","objectProto","_inc","_bInc","method","before","newArgs","_aInc","result","after","newResult","getOwnPropertyNames","forEach","alteredArgs","unregisterPlugin","extendObject","Pool","create","maxSize","getAliveObjects","doSort","sort","a","b","factory$7","getIndices","bounds","indices","verticalMidpoint","horizontalMidpoint","intersectsTopQuadrants","intersectsBottomQuadrants","Quadtree","maxDepth","maxObjects","subnode","Set","Array","from","isArray","apply","_sp","subWidth","subHeight","factory$8","getAllNodes","nodes","Scene","cullObjects","cullFunction","section","tabIndex","camera","show","hidden","focusableChild","find","onShow","hide","onHide","options","lookAt","factory$9","parseFrames","consecutiveFrames","sequence","SpriteSheet","frameWidth","frameHeight","frameMargin","createAnimations","factory$a","TileEngine","tilewidth","tileheight","tilesets","layers","mapwidth","mapheight","offscreenCanvas","offscreenContext","layerMap","layerCanvases","tileEngine","_sx","_sy","renderLayer","layer","layerCollidesWith","getRow","getCol","endRow","endCol","r","c","data","tileAtLayer","setTileAtLayer","tile","setLayer","addObject","removeObject","tileset","firstgid","offset","cols","columns","prerender","visible","sWidth","sHeight","EV_CONVOSTART","EV_CONVOEND","EV_CONVONEXT","EV_CONVOCHOICE","EV_SCENECHANGE","EV_INTERACTION","EV_UPDATECONVOTRIGGER","EV_GIVEQUEST","registry","allOff","ignoreList","k","some","uniqueId","pre","Number","Date","round","toString","between","v","getNormal","dirLength","sqrt","vmulti","dist","p1","p2","sortByDist","items","circleCollision","collider","targets","destroyOnHit","filtered","console","error","offsets","collisionBodyOptions","getRandomIntInclusive","ceil","Queue","elements","enqueue","dequeue","shift","isEmpty","peek","groupBy","arr","criteria","item","hasOwnProperty","debug","o","info","EV_DEBUGLOG","ENTITY_TYPE","FIXED","NPC","PICKUP","DOOR","PLAYER","Store","resetEntityStates","log","pushProgress","existing","updateProgress","updated","progressData","entryExists","entityId","updateQuestData","currentQuests","updatePickupData","updatedEntity","customProperties","worldId","getMapData","mapKey","getWorldData","worldDataKey","getEntityData","entityDataKey","getProgressDataStore","getEntityDataStore","getQuestDataStore","getAllEntitiesOfType","entityDataStore","ent","getEntityFromStore","customQuery","typeWriter","onStart","onTyped","onFinished","animId","t","charAt","mounted","isTyping","choices","primeGlobals","redraw","callTypewriter","callText","Shell","attrs","oninit","onremove","view","choice","onclick","onChoiceSelected","isBusy","mount","m","unmount","MODES","NOTRUNNING","NEXTNODE","AWAITINGINPUT","JUSTFINISHED","COMPLETED","conversationData","onChatStarted","onChatNext","onChatComplete","lastPositionSaved","onChainProgress","lastNodeId","onChatCancelled","currentNode","isRunning","isComplete","displayNode","queriedNode","queryNode","query","goToExact","mode","currentIndex","goToNext","to","actions","dataActions","action","cb","pushed","startId","onEntry","onExit","dataKey","conversationController","exitId","storyProgress","onDisplayText","actor","dialogue","onInteractionPushed","rest","enter","exit","itemsInStore","itemsInData","groupedItems","remapped","entries","qty","onItemSelected","thumb","description","onInventoryClosed","questsInStore","questsInData","questId","currentSegment","p","questPart","onQuestSelected","onQuestlogClosed","reactionManager","interactionCooldown","origin","collisions","controlledByUser","interactible","reactionData","reactionEvent","onAttackPushed","onAttacked","onInventoryOpened","inventory","itemData","onQuestlogOpened","questlog","questData","ctx","direction","onFadeComplete","alpha","curtainEl","sceneObject","currentScene","loadScene","states","state","currentState","popState","clearStates","moveSprite","sprite","checkCollision","directionNormal","oldPos","collidedWithX","collidesWithTiles","collidedWithY","flipSprite","z","entityData","collisionMethod","entityStateMachine","sheet","manualAnimation","collidesWithPlayer","movementDisabled","instId","onConvoEnter","onConvoExit","isMoving","onUpdate","brainData","behaviours","bootstrap","findPath","aiPathGrid","tx","ty","rx","ry","walkableId","easystar","EasyStar","js","enableDiagonals","enableCornerCutting","setGrid","setAcceptableTiles","calculate","wait","ms","setTimeout","destQueue","walkableTiles","j","randomWalkable","current","tileDest","destination","calculatedPath","vel","talkMode","idleAndRoam","followPath","useScript","scriptList","scr","talkOnly","npcRoam","loadedScript","onBattleEnter","onBattleExit","aiScript","ai","createWorld","areaId","playerStartId","entities","store","aiPathLayer","playerStart","playerEntityData","player","spriteBody","sprites","entity","alreadyCollected","reactions","reaction","resolution","gameCanvas","scaledCanvas","rootElement","gameCanvasCtx","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","oImageSmoothingEnabled","FieldScene","sceneProps","spriteCache","spr","sceneStateMachine","screenEffectsStateMachine","goesTo","actors","interactibleProgressData","triggerConvo","playerCollidingWith","isColliding","assets","sceneManager"],"mappings":"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","file":"src.e28e3671.js","sourceRoot":"..","sourcesContent":["/**\n * A simple event system. Allows you to hook into Kontra lifecycle events or create your own, such as for [Plugins](api/plugin).\n *\n * ```js\n * import { on, off, emit } from 'kontra';\n *\n * function callback(a, b, c) {\n *   console.log({a, b, c});\n * });\n *\n * on('myEvent', callback);\n * emit('myEvent', 1, 2, 3);  //=> {a: 1, b: 2, c: 3}\n * off('myEvent', callback);\n * ```\n * @sectionName Events\n */\n\n// expose for testing\nlet callbacks = {};\n\n/**\n * There are currently only three lifecycle events:\n * - `init` - Emitted after `konta.init()` is called.\n * - `tick` - Emitted every frame of [GameLoop](api/gameLoop) before the loops `update()` and `render()` functions are called.\n * - `assetLoaded` - Emitted after an asset has fully loaded using the asset loader. The callback function is passed the asset and the url of the asset as parameters.\n * @sectionName Lifecycle Events\n */\n\n/**\n * Register a callback for an event to be called whenever the event is emitted. The callback will be passed all arguments used in the `emit` call.\n * @function on\n *\n * @param {String} event - Name of the event.\n * @param {Function} callback - Function that will be called when the event is emitted.\n */\nfunction on(event, callback) {\n  callbacks[event] = callbacks[event] || [];\n  callbacks[event].push(callback);\n}\n\n/**\n * Remove a callback for an event.\n * @function off\n *\n * @param {String} event - Name of the event.\n * @param {Function} callback - The function that was passed during registration.\n */\nfunction off(event, callback) {\n  callbacks[event] = (callbacks[event] || []).filter(fn => fn != callback);\n}\n\n/**\n * Call all callback functions for the event. All arguments will be passed to the callback functions.\n * @function emit\n *\n * @param {String} event - Name of the event.\n * @param {...*} args - Comma separated list of arguments passed to all callbacks.\n */\nfunction emit(event, ...args) {\n  (callbacks[event] || []).map(fn => fn(...args));\n}\n\n/**\n * Functions for initializing the Kontra library and getting the canvas and context\n * objects.\n *\n * ```js\n * import { getCanvas, getContext, init } from 'kontra';\n *\n * let { canvas, context } = init();\n *\n * // or can get canvas and context through functions\n * canvas = getCanvas();\n * context = getContext();\n * ```\n * @sectionName Core\n */\n\nlet canvasEl, context;\n\n/**\n * Return the canvas element.\n * @function getCanvas\n *\n * @returns {HTMLCanvasElement} The canvas element for the game.\n */\nfunction getCanvas() {\n  return canvasEl;\n}\n\n/**\n * Return the context object.\n * @function getContext\n *\n * @returns {CanvasRenderingContext2D} The context object the game draws to.\n */\nfunction getContext() {\n  return context;\n}\n\n/**\n * Initialize the library and set up the canvas. Typically you will call `init()` as the first thing and give it the canvas to use. This will allow all Kontra objects to reference the canvas when created.\n *\n * ```js\n * import { init } from 'kontra';\n *\n * let { canvas, context } = init('game');\n * ```\n * @function init\n *\n * @param {String|HTMLCanvasElement} [canvas] - The canvas for Kontra to use. Can either be the ID of the canvas element or the canvas element itself. Defaults to using the first canvas element on the page.\n *\n * @returns {{canvas: HTMLCanvasElement, context: CanvasRenderingContext2D}} An object with properties `canvas` and `context`. `canvas` it the canvas element for the game and `context` is the context object the game draws to.\n */\nfunction init(canvas) {\n\n  // check if canvas is a string first, an element next, or default to getting\n  // first canvas on page\n  canvasEl = document.getElementById(canvas) ||\n             canvas ||\n             document.querySelector('canvas');\n\n  // @ifdef DEBUG\n  if (!canvasEl) {\n    throw Error('You must provide a canvas element for the game');\n  }\n  // @endif\n\n  context = canvasEl.getContext('2d');\n  context.imageSmoothingEnabled = false;\n\n  emit('init');\n\n  return { canvas: canvasEl, context };\n}\n\n/**\n * An object for drawing sprite sheet animations.\n *\n * An animation defines the sequence of frames to use from a sprite sheet. It also defines at what speed the animation should run using `frameRate`.\n *\n * Typically you don't create an Animation directly, but rather you would create them from a [SpriteSheet](api/spriteSheet) by passing the `animations` argument.\n *\n * ```js\n * import { SpriteSheet, Animation } from 'kontra';\n *\n * let image = new Image();\n * image.src = 'assets/imgs/character_walk_sheet.png';\n * image.onload = function() {\n *   let spriteSheet = SpriteSheet({\n *     image: image,\n *     frameWidth: 72,\n *     frameHeight: 97\n *   });\n *\n *   // you typically wouldn't create an Animation this way\n *   let animation = Animation({\n *     spriteSheet: spriteSheet,\n *     frames: [1,2,3,6],\n *     frameRate: 30\n *   });\n * };\n * ```\n * @class Animation\n *\n * @param {Object} properties - Properties of the animation.\n * @param {SpriteSheet} properties.spriteSheet - Sprite sheet for the animation.\n * @param {Number[]} properties.frames - List of frames of the animation.\n * @param {Number}  properties.frameRate - Number of frames to display in one second.\n * @param {Boolean} [properties.loop=true] - If the animation should loop.\n */\nclass Animation {\n  constructor({spriteSheet, frames, frameRate, loop = true}) {\n\n    /**\n     * The sprite sheet to use for the animation.\n     * @memberof Animation\n     * @property {SpriteSheet} spriteSheet\n     */\n    this.spriteSheet = spriteSheet;\n\n    /**\n     * Sequence of frames to use from the sprite sheet.\n     * @memberof Animation\n     * @property {Number[]} frames\n     */\n    this.frames = frames;\n\n    /**\n     * Number of frames to display per second. Adjusting this value will change the speed of the animation.\n     * @memberof Animation\n     * @property {Number} frameRate\n     */\n    this.frameRate = frameRate;\n\n    /**\n     * If the animation should loop back to the beginning once completed.\n     * @memberof Animation\n     * @property {Boolean} loop\n     */\n    this.loop = loop;\n\n    let { width, height, margin = 0 } = spriteSheet.frame;\n\n    /**\n     * The width of an individual frame. Taken from the [frame width value](api/spriteSheet#frame) of the sprite sheet.\n     * @memberof Animation\n     * @property {Number} width\n     */\n    this.width = width;\n\n    /**\n     * The height of an individual frame. Taken from the [frame height value](api/spriteSheet#frame) of the sprite sheet.\n     * @memberof Animation\n     * @property {Number} height\n     */\n    this.height = height;\n\n    /**\n     * The space between each frame. Taken from the [frame margin value](api/spriteSheet#frame) of the sprite sheet.\n     * @memberof Animation\n     * @property {Number} margin\n     */\n    this.margin = margin;\n\n    // f = frame, a = accumulator\n    this._f = 0;\n    this._a = 0;\n  }\n\n  /**\n   * Clone an animation so it can be used more than once. By default animations passed to [Sprite](api/sprite) will be cloned so no two sprites update the same animation. Otherwise two sprites who shared the same animation would make it update twice as fast.\n   * @memberof Animation\n   * @function clone\n   *\n   * @returns {Animation} A new Animation instance.\n   */\n  clone() {\n    return new Animation(this);\n  }\n\n  /**\n   * Reset an animation to the first frame.\n   * @memberof Animation\n   * @function reset\n   */\n  reset() {\n    this._f = 0;\n    this._a = 0;\n  }\n\n  /**\n   * Update the animation.\n   * @memberof Animation\n   * @function update\n   *\n   * @param {Number} [dt=1/60] - Time since last update.\n   */\n  update(dt = 1/60) {\n\n    // if the animation doesn't loop we stop at the last frame\n    if (!this.loop && this._f == this.frames.length-1) return;\n\n    this._a += dt;\n\n    // update to the next frame if it's time\n    while (this._a * this.frameRate >= 1) {\n      this._f = ++this._f % this.frames.length;\n      this._a -= 1 / this.frameRate;\n    }\n  }\n\n  /**\n   * Draw the current frame of the animation.\n   * @memberof Animation\n   * @function render\n   *\n   * @param {Object} properties - Properties to draw the animation.\n   * @param {Number} properties.x - X position to draw the animation.\n   * @param {Number} properties.y - Y position to draw the animation.\n   * @param {Number} [properties.width] - width of the sprite. Defaults to [Animation.width](api/animation#width).\n   * @param {Number} [properties.height] - height of the sprite. Defaults to [Animation.height](api/animation#height).\n   * @param {CanvasRenderingContext2D} [properties.context] - The context the animation should draw to. Defaults to [core.getContext()](api/core#getContext).\n   */\n  render({x, y, width = this.width, height = this.height, context = getContext()}) {\n\n    // get the row and col of the frame\n    let row = this.frames[this._f] / this.spriteSheet._f | 0;\n    let col = this.frames[this._f] % this.spriteSheet._f | 0;\n\n    context.drawImage(\n      this.spriteSheet.image,\n      col * this.width + (col * 2 + 1) * this.margin,\n      row * this.height + (row * 2 + 1) * this.margin,\n      this.width, this.height,\n      x, y,\n      width, height\n    );\n  }\n}\n\nfunction factory() {\n  return new Animation(...arguments);\n}\nfactory.prototype = Animation.prototype;\nfactory.class = Animation;\n\n/**\n * A promise based asset loader for loading images, audio, and data files. An `assetLoaded` event is emitted after each asset is fully loaded. The callback for the event is passed the asset and the url to the asset as parameters.\n *\n * ```js\n * import { load, on } from 'kontra';\n *\n * let numAssets = 3;\n * let assetsLoaded = 0;\n * on('assetLoaded', (asset, url) => {\n *   assetsLoaded++;\n *\n *   // inform user or update progress bar\n * });\n *\n * load(\n *   'assets/imgs/character.png',\n *   'assets/data/tile_engine_basic.json',\n *   ['/audio/music.ogg', '/audio/music.mp3']\n * ).then(function(assets) {\n *   // all assets have loaded\n * }).catch(function(err) {\n *   // error loading an asset\n * });\n * ```\n * @sectionName Assets\n */\n\nlet imageRegex = /(jpeg|jpg|gif|png)$/;\nlet audioRegex = /(wav|mp3|ogg|aac)$/;\nlet leadingSlash = /^\\//;\nlet trailingSlash = /\\/$/;\nlet dataMap = new WeakMap();\n\nlet imagePath = '';\nlet audioPath = '';\nlet dataPath = '';\n\n/**\n * Get the full URL from the base.\n *\n * @param {String} url - The URL to the asset.\n * @param {String} base - Base URL.\n *\n * @returns {String}\n */\nfunction getUrl(url, base) {\n  return new URL(url, base).href;\n}\n\n/**\n * Join a base path and asset path.\n *\n * @param {String} base - The asset base path.\n * @param {String} url - The URL to the asset.\n *\n * @returns {String}\n */\nfunction joinPath(base, url) {\n  return [base.replace(trailingSlash, ''), base ? url.replace(leadingSlash, '') : url]\n    .filter(s => s)\n    .join('/')\n}\n\n/**\n * Get the extension of an asset.\n *\n * @param {String} url - The URL to the asset.\n *\n * @returns {String}\n */\nfunction getExtension(url) {\n  return url.split('.').pop();\n}\n\n/**\n * Get the name of an asset.\n *\n * @param {String} url - The URL to the asset.\n *\n * @returns {String}\n */\nfunction getName(url) {\n  let name = url.replace('.' + getExtension(url), '');\n\n  // remove leading slash if there is no folder in the path\n  // @see https://stackoverflow.com/a/50592629/2124254\n  return name.split('/').length == 2 ? name.replace(leadingSlash, '') : name;\n}\n\n/**\n * Get browser audio playability.\n * @see https://github.com/Modernizr/Modernizr/blob/master/feature-detects/audio.js\n *\n * @param {HTMLMediaElement} audio - Audio element.\n *\n * @returns {object}\n */\nfunction getCanPlay(audio) {\n  return {\n    wav: audio.canPlayType('audio/wav; codecs=\"1\"'),\n    mp3: audio.canPlayType('audio/mpeg;'),\n    ogg: audio.canPlayType('audio/ogg; codecs=\"vorbis\"'),\n    aac: audio.canPlayType('audio/aac;')\n  };\n}\n\n/**\n * Object of all loaded image assets by both file name and path. If the base [image path](api/assets#setImagePath) was set before the image was loaded, the file name and path will not include the base image path.\n *\n * ```js\n * import { load, setImagePath, imageAssets } from 'kontra';\n *\n * load('assets/imgs/character.png').then(function() {\n *   // Image asset can be accessed by both\n *   // name: imageAssets['assets/imgs/character']\n *   // path: imageAssets['assets/imgs/character.png']\n * });\n *\n * setImagePath('assets/imgs');\n * load('character_walk_sheet.png').then(function() {\n *   // Image asset can be accessed by both\n *   // name: imageAssets['character_walk_sheet']\n *   // path: imageAssets['character_walk_sheet.png']\n * });\n * ```\n * @property {{[name: String]: HTMLImageElement}} imageAssets\n */\nlet imageAssets = {};\n\n/**\n * Object of all loaded audio assets by both file name and path. If the base [audio path](api/assets#setAudioPath) was set before the audio was loaded, the file name and path will not include the base audio path.\n *\n * ```js\n * import { load, setAudioPath, audioAssets } from 'kontra';\n *\n * load('/audio/music.ogg').then(function() {\n *   // Audio asset can be accessed by both\n *   // name: audioAssets['/audio/music']\n *   // path: audioAssets['/audio/music.ogg']\n * });\n *\n * setAudioPath('/audio');\n * load('sound.ogg').then(function() {\n *   // Audio asset can be accessed by both\n *   // name: audioAssets['sound']\n *   // path: audioAssets['sound.ogg']\n * });\n * ```\n * @property {{[name: String]: HTMLAudioElement}} audioAssets\n */\nlet audioAssets = {};\n\n/**\n * Object of all loaded data assets by both file name and path. If the base [data path](api/assets#setDataPath) was set before the data was loaded, the file name and path will not include the base data path.\n *\n * ```js\n * import { load, setDataPath, dataAssets } from 'kontra';\n *\n * load('assets/data/file.txt').then(function() {\n *   // Audio asset can be accessed by both\n *   // name: dataAssets['assets/data/file']\n *   // path: dataAssets['assets/data/file.txt']\n * });\n *\n * setDataPath('assets/data');\n * load('info.json').then(function() {\n *   // Audio asset can be accessed by both\n *   // name: dataAssets['info']\n *   // path: dataAssets['info.json']\n * });\n * ```\n * @property {{[name: String]: any}} dataAssets\n */\nlet dataAssets = {};\n\n/**\n * Add a global kontra object so TileEngine can access information about the\n * loaded assets when kontra is loaded in parts rather than as a whole (e.g.\n * `import { load, TileEngine } from 'kontra';`)\n */\nfunction addGlobal() {\n  if (!window.__k) {\n    window.__k = {\n      dm: dataMap,\n      u: getUrl,\n      d: dataAssets,\n      i: imageAssets\n    };\n  }\n}\n\n/**\n * Sets the base path for all image assets. If a base path is set, all load calls for image assets will prepend the base path to the URL.\n *\n * ```js\n * import { setImagePath, load } from 'kontra';\n *\n * setImagePath('/imgs');\n * load('character.png');  // loads '/imgs/character.png'\n * ```\n * @function setImagePath\n *\n * @param {String} path - Base image path.\n */\nfunction setImagePath(path) {\n  imagePath = path;\n}\n\n/**\n * Sets the base path for all audio assets. If a base path is set, all load calls for audio assets will prepend the base path to the URL.\n *\n * ```js\n * import { setAudioPath, load } from 'kontra';\n *\n * setAudioPath('/audio');\n * load('music.ogg');  // loads '/audio/music.ogg'\n * ```\n * @function setAudioPath\n *\n * @param {String} path - Base audio path.\n */\nfunction setAudioPath(path) {\n  audioPath = path;\n}\n\n/**\n * Sets the base path for all data assets. If a base path is set, all load calls for data assets will prepend the base path to the URL.\n *\n * ```js\n * import { setDataPath, load } from 'kontra';\n *\n * setDataPath('/data');\n * load('file.json');  // loads '/data/file.json'\n * ```\n * @function setDataPath\n *\n * @param {String} path - Base data path.\n */\nfunction setDataPath(path) {\n  dataPath = path;\n}\n\n/**\n * Load a single Image asset. Uses the base [image path](api/assets#setImagePath) to resolve the URL.\n *\n * Once loaded, the asset will be accessible on the the [imageAssets](api/assets#imageAssets) property.\n *\n * ```js\n * import { loadImage } from 'kontra';\n *\n * loadImage('car.png').then(function(image) {\n *   console.log(image.src);  //=> 'car.png'\n * })\n * ```\n * @function loadImage\n *\n * @param {String} url - The URL to the Image file.\n *\n * @returns {Promise<HTMLImageElement>} A deferred promise. Promise resolves with the Image.\n */\nfunction loadImage(url) {\n  addGlobal();\n\n  return new Promise((resolve, reject) => {\n    let resolvedUrl, image, fullUrl;\n\n    resolvedUrl = joinPath(imagePath, url);\n    if (imageAssets[resolvedUrl]) return resolve(imageAssets[resolvedUrl]);\n\n    image = new Image();\n\n    image.onload = function loadImageOnLoad() {\n      fullUrl = getUrl(resolvedUrl, window.location.href);\n      imageAssets[ getName(url) ] = imageAssets[resolvedUrl] = imageAssets[fullUrl] = this;\n      emit('assetLoaded', this, url);\n      resolve(this);\n    };\n\n    image.onerror = function loadImageOnError() {\n      reject(/* @ifdef DEBUG */ 'Unable to load image ' + /* @endif */ resolvedUrl);\n    };\n\n    image.src = resolvedUrl;\n  });\n}\n\n/**\n * Load a single Audio asset. Supports loading multiple audio formats which the loader will use to load the first audio format supported by the browser in the order listed. Uses the base [audio path](api/assets#setAudioPath) to resolve the URL.\n *\n * Once loaded, the asset will be accessible on the the [audioAssets](api/assets#audioAssets) property. Since the loader determines which audio asset to load based on browser support, you should only reference the audio by its name and not by its file path since there's no guarantee which asset was loaded.\n *\n * ```js\n * import { loadAudio, audioAssets } from 'kontra';\n *\n * loadAudio([\n *   '/audio/music.mp3',\n *   '/audio/music.ogg'\n * ]).then(function(audio) {\n *\n *   // access audio by its name only (not by its .mp3 or .ogg path)\n *   audioAssets['/audio/music'].play();\n * })\n * ```\n * @function loadAudio\n *\n * @param {String} url - The URL to the Audio file.\n *\n * @returns {Promise<HTMLAudioElement>} A deferred promise. Promise resolves with the Audio.\n */\nfunction loadAudio(url) {\n  return new Promise((resolve, reject) => {\n    let _url = url, audioEl, canPlay, resolvedUrl, fullUrl;\n\n    audioEl = new Audio();\n    canPlay = getCanPlay(audioEl);\n\n    // determine the first audio format the browser can play\n    url = [].concat(url)\n            .reduce((playableSource, source) => playableSource\n              ? playableSource\n              : canPlay[ getExtension(source) ]\n                ? source\n                : null\n            , 0);  // 0 is the shortest falsy value\n\n    if (!url) {\n      return reject(/* @ifdef DEBUG */ 'cannot play any of the audio formats provided ' + /* @endif */ _url);\n    }\n\n    resolvedUrl = joinPath(audioPath, url);\n    if (audioAssets[resolvedUrl]) return resolve(audioAssets[resolvedUrl]);\n\n    audioEl.addEventListener('canplay', function loadAudioOnLoad() {\n      fullUrl = getUrl(resolvedUrl, window.location.href);\n      audioAssets[ getName(url) ] = audioAssets[resolvedUrl] = audioAssets[fullUrl] = this;\n      emit('assetLoaded', this, url);\n      resolve(this);\n    });\n\n    audioEl.onerror = function loadAudioOnError() {\n      reject(/* @ifdef DEBUG */ 'Unable to load audio ' + /* @endif */ resolvedUrl);\n    };\n\n    audioEl.src = resolvedUrl;\n    audioEl.load();\n  });\n}\n\n/**\n * Load a single Data asset. Uses the base [data path](api/assets#setDataPath) to resolve the URL.\n *\n * Once loaded, the asset will be accessible on the the [dataAssets](api/assets#dataAssets) property.\n *\n * ```js\n * import { loadData } from 'kontra';\n *\n * loadData('assets/data/tile_engine_basic.json').then(function(data) {\n *   // data contains the parsed JSON data\n * })\n * ```\n * @function loadData\n *\n * @param {String} url - The URL to the Data file.\n *\n * @returns {Promise} A deferred promise. Promise resolves with the contents of the file. If the file is a JSON file, the contents will be parsed as JSON.\n */\nfunction loadData(url) {\n  addGlobal();\n  let resolvedUrl, fullUrl;\n\n  resolvedUrl = joinPath(dataPath, url);\n  if (dataAssets[resolvedUrl]) return Promise.resolve(dataAssets[resolvedUrl]);\n\n  return fetch(resolvedUrl).then(response => {\n    if (!response.ok) throw response;\n    return response.clone().json().catch(() => response.text())\n  }).then(response => {\n    fullUrl = getUrl(resolvedUrl, window.location.href);\n    if (typeof response === 'object') {\n      dataMap.set(response, fullUrl);\n    }\n\n    dataAssets[ getName(url) ] = dataAssets[resolvedUrl] = dataAssets[fullUrl] = response;\n    emit('assetLoaded', response, url);\n    return response;\n  });\n}\n\n/**\n * Load Image, Audio, or data files. Uses the [loadImage](api/assets#loadImage), [loadAudio](api/assets#loadAudio), and [loadData](api/assets#loadData) functions to load each asset type.\n *\n * ```js\n * import { load } from 'kontra';\n *\n * load(\n *   'assets/imgs/character.png',\n *   'assets/data/tile_engine_basic.json',\n *   ['/audio/music.ogg', '/audio/music.mp3']\n * ).then(function(assets) {\n *   // all assets have loaded\n * }).catch(function(err) {\n *   // error loading an asset\n * });\n * ```\n * @function load\n *\n * @param {...String[]} urls - Comma separated list of asset urls to load.\n *\n * @returns {Promise<any[]>} A deferred promise. Resolves with all the loaded assets.\n */\nfunction load(...urls) {\n  addGlobal();\n\n  return Promise.all(\n    urls.map(asset => {\n      // account for a string or an array for the url\n      let extension = getExtension( [].concat(asset)[0] );\n\n      return extension.match(imageRegex)\n        ? loadImage(asset)\n        : extension.match(audioRegex)\n          ? loadAudio(asset)\n          : loadData(asset);\n    })\n  );\n}\n\n/**\n * A group of helpful functions that are commonly used for game development. Includes things such as converting between radians and degrees and getting random integers.\n *\n * ```js\n * import { degToRad } from 'kontra';\n *\n * let radians = degToRad(180);  // => 3.14\n * ```\n * @sectionName Helpers\n */\n\n/**\n * Convert degrees to radians.\n * @function degToRad\n *\n * @param {Number} deg - Degrees to convert.\n *\n * @returns {Number} The value in radians.\n */\nfunction degToRad(deg) {\n  return deg * Math.PI / 180;\n}\n\n/**\n * Convert radians to degrees.\n * @function radToDeg\n *\n * @param {Number} rad - Radians to convert.\n *\n * @returns {Number} The value in degrees.\n */\nfunction radToDeg(rad) {\n  return rad * 180 / Math.PI;\n}\n\n/**\n * Return the angle in radians from one point to another point.\n *\n * ```js\n * import { angleToTarget, Sprite } from 'kontra';\n *\n * let sprite = Sprite({\n *   x: 10,\n *   y: 10,\n *   width: 20,\n *   height: 40,\n *   color: 'blue'\n * });\n *\n * sprite.rotation = angleToTarget(sprite, {x: 100, y: 30});\n *\n * let sprite2 = Sprite({\n *   x: 100,\n *   y: 30,\n *   width: 20,\n *   height: 40,\n *   color: 'red',\n * });\n *\n * sprite2.rotation = angleToTarget(sprite2, sprite);\n * ```\n * @function angleToTarget\n *\n * @param {{x: Number, y: Number}} source - The source point.\n * @param {{x: Number, y: Number}} target - The target point.\n *\n * @returns {Number} Angle (in radians) from the source point to the target point.\n */\nfunction angleToTarget(source, target) {\n\n  // atan2 returns the counter-clockwise angle in respect to the x-axis, but\n  // the canvas rotation system is based on the y-axis (rotation of 0 = up).\n  // so we need to add a quarter rotation to return a counter-clockwise\n  // rotation in respect to the y-axis\n  return Math.atan2(target.y - source.y, target.x - source.x) + Math.PI / 2;\n}\n\n/**\n * Rotate a point by an angle.\n * @function rotatePoint\n *\n * @param {{x: Number, y: Number}} point - The point to rotate.\n * @param {Number} angle - Angle (in radians) to rotate.\n *\n * @returns {{x: Number, y: Number}} The new x and y coordinates after rotation.\n */\nfunction rotatePoint(point, angle) {\n  let sin = Math.sin(angle);\n  let cos = Math.cos(angle);\n  let x = point.x * cos - point.y * sin;\n  let y = point.x * sin + point.y * cos;\n\n  return {x, y};\n}\n\n/**\n * Return a random integer between a minimum (inclusive) and maximum (inclusive) integer.\n * @see https://stackoverflow.com/a/1527820/2124254\n * @function randInt\n *\n * @param {Number} min - Min integer.\n * @param {Number} max - Max integer.\n *\n * @returns {Number} Random integer between min and max values.\n */\nfunction randInt(min, max) {\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\n/**\n * Create a seeded random number generator.\n *\n * ```js\n * import { seedRand } from 'kontra';\n *\n * let rand = seedRand('kontra');\n * console.log(rand());  // => always 0.33761959057301283\n * ```\n * @see https://stackoverflow.com/a/47593316/2124254\n * @see https://github.com/bryc/code/blob/master/jshash/PRNGs.md\n *\n * @function seedRand\n *\n * @param {String} str - String to seed the random number generator.\n *\n * @returns {() => Number} Seeded random number generator function.\n */\n function seedRand(str) {\n  // based on the above references, this was the smallest code yet decent\n  // quality seed random function\n\n  // first create a suitable hash of the seed string using xfnv1a\n  // @see https://github.com/bryc/code/blob/master/jshash/PRNGs.md#addendum-a-seed-generating-functions\n  for(var i = 0, h = 2166136261 >>> 0; i < str.length; i++) {\n    h = Math.imul(h ^ str.charCodeAt(i), 16777619);\n  }\n  h += h << 13; h ^= h >>> 7;\n  h += h << 3;  h ^= h >>> 17;\n  let seed = (h += h << 5) >>> 0;\n\n  // then return the seed function and discard the first result\n  // @see https://github.com/bryc/code/blob/master/jshash/PRNGs.md#lcg-lehmer-rng\n  let rand = () => (2 ** 31 - 1 & (seed = Math.imul(48271, seed))) / 2 ** 31;\n  rand();\n  return rand;\n}\n\n/**\n * Linearly interpolate between two values. The function calculates the number between two values based on a percent. Great for smooth transitions.\n *\n * ```js\n * import { lerp } from 'kontra';\n *\n * console.log( lerp(10, 20, 0.5) );  // => 15\n * console.log( lerp(10, 20, 2) );  // => 30\n * ```\n * @function lerp\n *\n * @param {Number} start - Start value.\n * @param {Number} end - End value.\n * @param {Number} percent - Percent to interpolate.\n *\n * @returns {Number} Interpolated number between the start and end values\n */\nfunction lerp(start, end, percent) {\n  return start * (1 - percent) + end * percent;\n}\n\n/**\n * Return the linear interpolation percent between two values. The function calculates the percent between two values of a given value.\n *\n * ```js\n * import { inverseLerp } from 'kontra';\n *\n * console.log( inverseLerp(10, 20, 15) );  // => 0.5\n * console.log( inverseLerp(10, 20, 30) );  // => 2\n * ```\n * @function inverseLerp\n *\n * @param {Number} start - Start value.\n * @param {Number} end - End value.\n * @param {Number} value - Value between start and end.\n *\n * @returns {Number} Percent difference between the start and end values.\n */\nfunction inverseLerp(start, end, value) {\n  return (value - start) / (end - start);\n}\n\n/**\n * Clamp a number between two values, preventing it from going below or above the minimum and maximum values.\n * @function clamp\n *\n * @param {Number} min - Min value.\n * @param {Number} max - Max value.\n * @param {Number} value - Value to clamp.\n *\n * @returns {Number} Value clamped between min and max.\n */\nfunction clamp(min, max, value) {\n  return Math.min( Math.max(min, value), max );\n}\n\n/**\n * Save an item to localStorage. A value of `undefined` will remove the item from localStorage.\n * @function setStoreItem\n *\n * @param {String} key - The name of the key.\n * @param {*} value - The value to store.\n */\nfunction setStoreItem(key, value) {\n  if (value === undefined) {\n    localStorage.removeItem(key);\n  }\n  else {\n    localStorage.setItem(key, JSON.stringify(value));\n  }\n}\n\n/**\n * Retrieve an item from localStorage and convert it back to its original type.\n *\n * Normally when you save a value to LocalStorage it converts it into a string. So if you were to save a number, it would be saved as `\"12\"` instead of `12`. This function enables the value to be returned as `12`.\n * @function getStoreItem\n *\n * @param {String} key - Name of the key of the item to retrieve.\n *\n * @returns {*} The retrieved item.\n */\nfunction getStoreItem(key) {\n  let value = localStorage.getItem(key);\n\n  try {\n    value = JSON.parse(value);\n  }\n  catch(e) {}\n\n  return value;\n}\n\n/**\n * Check if a two objects collide. Uses a simple [Axis-Aligned Bounding Box (AABB) collision check](https://developer.mozilla.org/en-US/docs/Games/Techniques/2D_collision_detection#Axis-Aligned_Bounding_Box). Takes into account the sprites [anchor](api/gameObject#anchor) and [scale](api/gameObject#scale).\n *\n * **NOTE:** Does not take into account object rotation. If you need collision detection between rotated objects you will need to implement your own `collides()` function. I suggest looking at the Separate Axis Theorem.\n *\n *\n * ```js\n * import { Sprite, collides } from 'kontra';\n *\n * let sprite = Sprite({\n *   x: 100,\n *   y: 200,\n *   width: 20,\n *   height: 40\n * });\n *\n * let sprite2 = Sprite({\n *   x: 150,\n *   y: 200,\n *   width: 20,\n *   height: 20\n * });\n *\n * collides(sprite, sprite2);  //=> false\n *\n * sprite2.x = 115;\n *\n * collides(sprite, sprite2);  //=> true\n * ```\n * @function collides\n *\n * @param {Object} obj1 - Object reference.\n * @param {Object} obj2 - Object to check collision against.\n *\n * @returns {Boolean|null} `true` if the objects collide, `false` otherwise. Will return `null` if the either of the two objects are rotated.\n */\nfunction collides(obj1, obj2) {\n  if (obj1.rotation || obj2.rotation) return null;\n\n  // @ifdef GAMEOBJECT_SCALE||GAMEOBJECT_ANCHOR\n  // destructure results to obj1 and obj2\n  [obj1, obj2] = [obj1, obj2].map(obj => getWorldRect(obj));\n  // @endif\n\n  return obj1.x < obj2.x + obj2.width &&\n         obj1.x + obj1.width > obj2.x &&\n         obj1.y < obj2.y + obj2.height &&\n         obj1.y + obj1.height > obj2.y;\n}\n\n/**\n * Return the world rect of an object. The rect is the world position of the top-left corner of the object and its size. Takes into account the objects anchor and scale.\n * @function getWorldRect\n *\n * @param {Object} obj - Object to get world rect of.\n *\n * @returns {{x: number, y: number, width: number, height: number}} The world `x`, `y`, `width`, and `height` of the object.\n */\nfunction getWorldRect(obj) {\n  let { x, y, width, height } = obj.world || obj;\n\n  // @ifdef GAMEOBJECT_ANCHOR\n  // account for anchor\n  if (obj.anchor) {\n    x -= width * obj.anchor.x;\n    y -= height * obj.anchor.y;\n  }\n  // @endif\n\n  // @ifdef GAMEOBJECT_SCALE\n  // account for negative scales\n  if (width < 0) {\n    x += width;\n    width *= -1;\n  }\n  if (height < 0) {\n    y += height;\n    height *= -1;\n  }\n  // @endif\n\n  return {\n    x,\n    y,\n    width,\n    height\n  };\n}\n\n/**\n * A simple 2d vector object.\n *\n * ```js\n * import { Vector } from 'kontra';\n *\n * let vector = Vector(100, 200);\n * ```\n * @class Vector\n *\n * @param {Number} [x=0] - X coordinate of the vector.\n * @param {Number} [y=0] - Y coordinate of the vector.\n */\nclass Vector {\n  constructor(x = 0, y = 0, vec = {}) {\n    this.x = x;\n    this.y = y;\n\n    // @ifdef VECTOR_CLAMP\n    // preserve vector clamping when creating new vectors\n    if (vec._c) {\n      this.clamp(vec._a, vec._b, vec._d, vec._e);\n\n      // reset x and y so clamping takes effect\n      this.x = x;\n      this.y = y;\n    }\n    // @endif\n  }\n\n  /**\n   * Calculate the addition of the current vector with the given vector.\n   * @memberof Vector\n   * @function add\n   *\n   * @param {Vector|{x: number, y: number}} vector - Vector to add to the current Vector.\n   *\n   * @returns {Vector} A new Vector instance whose value is the addition of the two vectors.\n   */\n  add(vec) {\n    return new Vector(\n      this.x + vec.x,\n      this.y + vec.y,\n      this\n    );\n  }\n\n  // @ifdef VECTOR_SUBTRACT\n  /**\n   * Calculate the subtraction of the current vector with the given vector.\n   * @memberof Vector\n   * @function subtract\n   *\n   * @param {Vector|{x: number, y: number}} vector - Vector to subtract from the current Vector.\n   *\n   * @returns {Vector} A new Vector instance whose value is the subtraction of the two vectors.\n   */\n   subtract(vec) {\n    return new Vector(\n      this.x - vec.x,\n      this.y - vec.y,\n      this\n    );\n  }\n  // @endif\n\n  // @ifdef VECTOR_SCALE\n  /**\n   * Calculate the multiple of the current vector by a value.\n   * @memberof Vector\n   * @function scale\n   *\n   * @param {Number} value - Value to scale the current Vector.\n   *\n   * @returns {Vector} A new Vector instance whose value is multiplied by the scalar.\n   */\n  scale(value) {\n    return new Vector(\n      this.x * value,\n      this.y * value\n    );\n  }\n  // @endif\n\n  // @ifdef VECTOR_NORMALIZE\n  /**\n   * Calculate the normalized value of the current vector. Requires the Vector [length](api/vector#length) function.\n   * @memberof Vector\n   * @function normalize\n   *\n   * @returns {Vector} A new Vector instance whose value is the normalized vector.\n   */\n  // @see https://github.com/jed/140bytes/wiki/Byte-saving-techniques#use-placeholder-arguments-instead-of-var\n  normalize(length = this.length()) {\n    return new Vector(\n      this.x / length,\n      this.y / length\n    );\n  }\n  // @endif\n\n  // @ifdef VECTOR_DOT||VECTOR_ANGLE\n  /**\n   * Calculate the dot product of the current vector with the given vector.\n   * @memberof Vector\n   * @function dot\n   *\n   * @param {Vector|{x: number, y: number}} vector - Vector to dot product against.\n   *\n   * @returns {Number} The dot product of the vectors.\n   */\n  dot(vec) {\n    return this.x * vec.x + this.y * vec.y;\n  }\n  // @endif\n\n  // @ifdef VECTOR_LENGTH||VECTOR_NORMALIZE||VECTOR_ANGLE\n  /**\n   * Calculate the length (magnitude) of the Vector.\n   * @memberof Vector\n   * @function length\n   *\n   * @returns {Number} The length of the vector.\n   */\n  length() {\n    return Math.hypot(this.x, this.y);\n  }\n  // @endif\n\n  // @ifdef VECTOR_DISTANCE\n  /**\n   * Calculate the distance between the current vector and the given vector.\n   * @memberof Vector\n   * @function distance\n   *\n   * @param {Vector|{x: number, y: number}} vector - Vector to calculate the distance between.\n   *\n   * @returns {Number} The distance between the two vectors.\n   */\n  distance(vec) {\n    return Math.hypot(this.x - vec.x, this.y - vec.y);\n  }\n  // @endif\n\n  // @ifdef VECTOR_ANGLE\n  /**\n   * Calculate the angle (in radians) between the current vector and the given vector. Requires the Vector [dot](api/vector#dot) and [length](api/vector#length) functions.\n   * @memberof Vector\n   * @function angle\n   *\n   * @param {Vector} vector - Vector to calculate the angle between.\n   *\n   * @returns {Number} The angle (in radians) between the two vectors.\n   */\n  angle(vec) {\n    return Math.acos(this.dot(vec) / (this.length() * vec.length()));\n  }\n  // @endif\n\n  // @ifdef VECTOR_CLAMP\n  /**\n   * Clamp the Vector between two points, preventing `x` and `y` from going below or above the minimum and maximum values. Perfect for keeping a sprite from going outside the game boundaries.\n   *\n   * ```js\n   * import { Vector } from 'kontra';\n   *\n   * let vector = Vector(100, 200);\n   * vector.clamp(0, 0, 200, 300);\n   *\n   * vector.x += 200;\n   * console.log(vector.x);  //=> 200\n   *\n   * vector.y -= 300;\n   * console.log(vector.y);  //=> 0\n   *\n   * vector.add({x: -500, y: 500});\n   * console.log(vector);    //=> {x: 0, y: 300}\n   * ```\n   * @memberof Vector\n   * @function clamp\n   *\n   * @param {Number} xMin - Minimum x value.\n   * @param {Number} yMin - Minimum y value.\n   * @param {Number} xMax - Maximum x value.\n   * @param {Number} yMax - Maximum y value.\n   */\n  clamp(xMin, yMin, xMax, yMax) {\n    this._c = true;\n    this._a = xMin;\n    this._b = yMin;\n    this._d = xMax;\n    this._e = yMax;\n  }\n\n  /**\n   * X coordinate of the vector.\n   * @memberof Vector\n   * @property {Number} x\n   */\n  get x() {\n    return this._x;\n  }\n\n  /**\n   * Y coordinate of the vector.\n   * @memberof Vector\n   * @property {Number} y\n   */\n  get y() {\n    return this._y;\n  }\n\n  set x(value) {\n    this._x = (this._c ? clamp(this._a, this._d, value) : value);\n  }\n\n  set y(value) {\n    this._y = (this._c ? clamp(this._b, this._e, value) : value);\n  }\n  // @endif\n}\n\nfunction factory$1() {\n  return new Vector(...arguments);\n}\nfactory$1.prototype = Vector.prototype;\nfactory$1.class = Vector;\n\n/**\n * This is a private class that is used just to help make the GameObject class more manageable and smaller.\n *\n * It maintains everything that can be changed in the update function:\n * position\n * velocity\n * acceleration\n * ttl\n */\nclass Updatable {\n\n  constructor(properties) {\n    return this.init(properties);\n  }\n\n  init(properties = {}) {\n\n    // --------------------------------------------------\n    // defaults\n    // --------------------------------------------------\n\n    /**\n     * The game objects position vector. Represents the local position of the object as opposed to the [world](api/gameObject#world) position.\n     * @property {Vector} position\n     * @memberof GameObject\n     * @page GameObject\n     */\n    this.position = factory$1();\n\n    // --------------------------------------------------\n    // optionals\n    // --------------------------------------------------\n\n    // @ifdef GAMEOBJECT_VELOCITY\n    /**\n     * The game objects velocity vector.\n     * @memberof GameObject\n     * @property {Vector} velocity\n     * @page GameObject\n     */\n    this.velocity = factory$1();\n    // @endif\n\n    // @ifdef GAMEOBJECT_ACCELERATION\n    /**\n     * The game objects acceleration vector.\n     * @memberof GameObject\n     * @property {Vector} acceleration\n     * @page GameObject\n     */\n    this.acceleration = factory$1();\n    // @endif\n\n    // @ifdef GAMEOBJECT_TTL\n    /**\n     * How may frames the game object should be alive.\n     * @memberof GameObject\n     * @property {Number} ttl\n     * @page GameObject\n     */\n    this.ttl = Infinity;\n    // @endif\n\n    // add all properties to the object, overriding any defaults\n    Object.assign(this, properties);\n  }\n\n  /**\n   * Update the game objects position based on its velocity and acceleration. Calls the game objects [advance()](api/gameObject#advance) function.\n   * @memberof GameObject\n   * @function update\n   * @page GameObject\n   *\n   * @param {Number} [dt] - Time since last update.\n   */\n  update(dt) {\n    this.advance(dt);\n  }\n\n  /**\n   * Move the game object by its acceleration and velocity. If you pass `dt` it will multiply the vector and acceleration by that number. This means the `dx`, `dy`, `ddx` and `ddy` should be the how far you want the object to move in 1 second rather than in 1 frame.\n   *\n   * If you override the game objects [update()](api/gameObject#update) function with your own update function, you can call this function to move the game object normally.\n   *\n   * ```js\n   * import { GameObject } from 'kontra';\n   *\n   * let gameObject = GameObject({\n   *   x: 100,\n   *   y: 200,\n   *   width: 20,\n   *   height: 40,\n   *   dx: 5,\n   *   dy: 2,\n   *   update: function() {\n   *     // move the game object normally\n   *     this.advance();\n   *\n   *     // change the velocity at the edges of the canvas\n   *     if (this.x < 0 ||\n   *         this.x + this.width > this.context.canvas.width) {\n   *       this.dx = -this.dx;\n   *     }\n   *     if (this.y < 0 ||\n   *         this.y + this.height > this.context.canvas.height) {\n   *       this.dy = -this.dy;\n   *     }\n   *   }\n   * });\n   * ```\n   * @memberof GameObject\n   * @function advance\n   * @page GameObject\n   *\n   * @param {Number} [dt] - Time since last update.\n   *\n   */\n  advance(dt) {\n    // @ifdef GAMEOBJECT_VELOCITY\n    // @ifdef GAMEOBJECT_ACCELERATION\n    let acceleration = this.acceleration;\n\n    // @ifdef VECTOR_SCALE\n    if (dt) {\n      acceleration = acceleration.scale(dt);\n    }\n    // @endif\n\n    this.velocity = this.velocity.add(acceleration);\n    // @endif\n    // @endif\n\n    // @ifdef GAMEOBJECT_VELOCITY\n    let velocity = this.velocity;\n\n    // @ifdef VECTOR_SCALE\n    if (dt) {\n      velocity = velocity.scale(dt);\n    }\n    // @endif\n\n    this.position = this.position.add(velocity);\n    this._pc();\n    // @endif\n\n    // @ifdef GAMEOBJECT_TTL\n    this.ttl--;\n    // @endif\n  }\n\n  // --------------------------------------------------\n  // velocity\n  // --------------------------------------------------\n\n  // @ifdef GAMEOBJECT_VELOCITY\n  /**\n   * X coordinate of the velocity vector.\n   * @memberof GameObject\n   * @property {Number} dx\n   * @page GameObject\n   */\n  get dx() {\n    return this.velocity.x;\n  }\n\n  /**\n   * Y coordinate of the velocity vector.\n   * @memberof GameObject\n   * @property {Number} dy\n   * @page GameObject\n   */\n  get dy() {\n    return this.velocity.y;\n  }\n\n  set dx(value) {\n    this.velocity.x = value;\n  }\n\n  set dy(value) {\n    this.velocity.y = value;\n  }\n  // @endif\n\n  // --------------------------------------------------\n  // acceleration\n  // --------------------------------------------------\n\n  // @ifdef GAMEOBJECT_ACCELERATION\n  /**\n   * X coordinate of the acceleration vector.\n   * @memberof GameObject\n   * @property {Number} ddx\n   * @page GameObject\n   */\n  get ddx() {\n    return this.acceleration.x;\n  }\n\n  /**\n   * Y coordinate of the acceleration vector.\n   * @memberof GameObject\n   * @property {Number} ddy\n   * @page GameObject\n   */\n  get ddy() {\n    return this.acceleration.y;\n  }\n\n  set ddx(value) {\n    this.acceleration.x = value;\n  }\n\n  set ddy(value) {\n    this.acceleration.y = value;\n  }\n  // @endif\n\n  // --------------------------------------------------\n  // ttl\n  // --------------------------------------------------\n\n  // @ifdef GAMEOBJECT_TTL\n  /**\n   * Check if the game object is alive.\n   * @memberof GameObject\n   * @function isAlive\n   * @page GameObject\n   *\n   * @returns {Boolean} `true` if the game objects [ttl](api/gameObject#ttl) property is above `0`, `false` otherwise.\n   */\n  isAlive() {\n    return this.ttl > 0;\n  }\n  // @endif\n\n  _pc() {}\n}\n\n// noop function\nconst noop = () => {};\n\n// style used for DOM nodes needed for screen readers\nconst srOnlyStyle = 'position:absolute;left:-9999px';\n\n// append a node directly after the canvas and as the last\n// element of other kontra nodes\nfunction addToDom(node, canvas) {\n  let container = canvas.parentNode;\n\n  node.setAttribute('data-kontra', '');\n  if (container) {\n    let target = container.querySelector('[data-kontra]:last-of-type') || canvas;\n    container.insertBefore(node, target.nextSibling);\n  }\n  else {\n    document.body.appendChild(node);\n  }\n}\n\n/**\n * The base class of most renderable classes. Handles things such as position, rotation, anchor, and the update and render life cycle.\n *\n * Typically you don't create a GameObject directly, but rather extend it for new classes.\n * @class GameObject\n *\n * @param {Object} [properties] - Properties of the game object.\n * @param {Number} [properties.x] - X coordinate of the position vector.\n * @param {Number} [properties.y] - Y coordinate of the position vector.\n * @param {Number} [properties.width] - Width of the game object.\n * @param {Number} [properties.height] - Height of the game object.\n *\n * @param {CanvasRenderingContext2D} [properties.context] - The context the game object should draw to. Defaults to [core.getContext()](api/core#getContext).\n *\n * @param {Number} [properties.dx] - X coordinate of the velocity vector.\n * @param {Number} [properties.dy] - Y coordinate of the velocity vector.\n * @param {Number} [properties.ddx] - X coordinate of the acceleration vector.\n * @param {Number} [properties.ddy] - Y coordinate of the acceleration vector.\n * @param {Number} [properties.ttl=Infinity] - How many frames the game object should be alive. Used by [Pool](api/pool).\n *\n * @param {{x: number, y: number}} [properties.anchor={x:0,y:0}] - The x and y origin of the game object. {x:0, y:0} is the top left corner of the game object, {x:1, y:1} is the bottom right corner.\n * @param {Number} [properties.sx=0] - The x camera position.\n * @param {Number} [properties.sy=0] - The y camera position.\n * @param {GameObject[]} [properties.children] - Children to add to the game object.\n * @param {Number} [properties.opacity=1] - The opacity of the game object.\n * @param {Number} [properties.rotation=0] - The rotation around the anchor in radians.\n * @param {Number} [properties.scaleX=1] - The x scale of the game object.\n * @param {Number} [properties.scaleY=1] - The y scale of the game object.\n *\n * @param {(dt?: number) => void} [properties.update] - Function called every frame to update the game object.\n * @param {Function} [properties.render] - Function called every frame to render the game object.\n *\n * @param {...*} properties.props - Any additional properties you need added to the game object. For example, if you pass `gameObject({type: 'player'})` then the game object will also have a property of the same name and value. You can pass as many additional properties as you want.\n */\nclass GameObject extends Updatable {\n  /**\n   * @docs docs/api_docs/gameObject.js\n   */\n\n  /**\n   * Use this function to reinitialize a game object. It takes the same properties object as the constructor. Useful it you want to repurpose a game object.\n   * @memberof GameObject\n   * @function init\n   *\n   * @param {Object} properties - Properties of the game object.\n   */\n  init({\n\n    // --------------------------------------------------\n    // defaults\n    // --------------------------------------------------\n\n    /**\n     * The width of the game object. Represents the local width of the object as opposed to the [world](api/gameObject#world) width.\n     * @memberof GameObject\n     * @property {Number} width\n     */\n    width = 0,\n\n    /**\n     * The height of the game object. Represents the local height of the object as opposed to the [world](api/gameObject#world) height.\n     * @memberof GameObject\n     * @property {Number} height\n     */\n    height = 0,\n\n    /**\n     * The context the game object will draw to.\n     * @memberof GameObject\n     * @property {CanvasRenderingContext2D} context\n     */\n    context = getContext(),\n\n    render = this.draw,\n    update = this.advance,\n\n    // --------------------------------------------------\n    // optionals\n    // --------------------------------------------------\n\n    // @ifdef GAMEOBJECT_GROUP\n    /**\n     * The game objects parent object.\n     * @memberof GameObject\n     * @property {GameObject|null} parent\n     */\n\n    /**\n     * The game objects children objects.\n     * @memberof GameObject\n     * @property {GameObject[]} children\n     */\n    children = [],\n    // @endif\n\n    // @ifdef GAMEOBJECT_ANCHOR\n    /**\n     * The x and y origin of the game object. {x:0, y:0} is the top left corner of the game object, {x:1, y:1} is the bottom right corner.\n     * @memberof GameObject\n     * @property {{x: number, y: number}} anchor\n     *\n     * @example\n     * // exclude-code:start\n     * let { GameObject } = kontra;\n     * // exclude-code:end\n     * // exclude-script:start\n     * import { GameObject } from 'kontra';\n     * // exclude-script:end\n     *\n     * let gameObject = GameObject({\n     *   x: 150,\n     *   y: 100,\n     *   width: 50,\n     *   height: 50,\n     *   color: 'red',\n     *   // exclude-code:start\n     *   context: context,\n     *   // exclude-code:end\n     *   render: function() {\n     *     this.context.fillStyle = this.color;\n     *     this.context.fillRect(0, 0, this.height, this.width);\n     *   }\n     * });\n     *\n     * function drawOrigin(gameObject) {\n     *   gameObject.context.fillStyle = 'yellow';\n     *   gameObject.context.beginPath();\n     *   gameObject.context.arc(gameObject.x, gameObject.y, 3, 0, 2*Math.PI);\n     *   gameObject.context.fill();\n     * }\n     *\n     * gameObject.render();\n     * drawOrigin(gameObject);\n     *\n     * gameObject.anchor = {x: 0.5, y: 0.5};\n     * gameObject.x = 300;\n     * gameObject.render();\n     * drawOrigin(gameObject);\n     *\n     * gameObject.anchor = {x: 1, y: 1};\n     * gameObject.x = 450;\n     * gameObject.render();\n     * drawOrigin(gameObject);\n     */\n    anchor = {x: 0, y: 0},\n    // @endif\n\n    // @ifdef GAMEOBJECT_CAMERA\n    /**\n     * The X coordinate of the camera.\n     * @memberof GameObject\n     * @property {Number} sx\n     */\n    sx = 0,\n\n    /**\n     * The Y coordinate of the camera.\n     * @memberof GameObject\n     * @property {Number} sy\n     */\n    sy = 0,\n    // @endif\n\n    // @ifdef GAMEOBJECT_OPACITY\n    /**\n     * The opacity of the object. Represents the local opacity of the object as opposed to the [world](api/gameObject#world) opacity.\n     * @memberof GameObject\n     * @property {Number} opacity\n     */\n    opacity = 1,\n    // @endif\n\n    // @ifdef GAMEOBJECT_ROTATION\n    /**\n     * The rotation of the game object around the anchor in radians. . Represents the local rotation of the object as opposed to the [world](api/gameObject#world) rotation.\n     * @memberof GameObject\n     * @property {Number} rotation\n     */\n    rotation = 0,\n    // @endif\n\n    // @ifdef GAMEOBJECT_SCALE\n    /**\n     * The x scale of the object. Represents the local x scale of the object as opposed to the [world](api/gameObject#world) x scale.\n     * @memberof GameObject\n     * @property {Number} scaleX\n     */\n    scaleX = 1,\n\n    /**\n     * The y scale of the object. Represents the local y scale of the object as opposed to the [world](api/gameObject#world) y scale.\n     * @memberof GameObject\n     * @property {Number} scaleY\n     */\n    scaleY = 1,\n    // @endif\n\n    ...props\n  } = {}) {\n\n    // @ifdef GAMEOBJECT_GROUP\n    this.children = [];\n    // @endif\n\n    // by setting defaults to the parameters and passing them into\n    // the init, we can ensure that a parent class can set overriding\n    // defaults and the GameObject won't undo it (if we set\n    // `this.width` then no parent could provide a default value for\n    // width)\n    super.init({\n      width,\n      height,\n      context,\n\n      // @ifdef GAMEOBJECT_ANCHOR\n      anchor,\n      // @endif\n\n      // @ifdef GAMEOBJECT_CAMERA\n      sx,\n      sy,\n      // @endif\n\n      // @ifdef GAMEOBJECT_OPACITY\n      opacity,\n      // @endif\n\n      // @ifdef GAMEOBJECT_ROTATION\n      rotation,\n      // @endif\n\n      // @ifdef GAMEOBJECT_SCALE\n      scaleX,\n      scaleY,\n      // @endif\n\n      ...props\n    });\n\n    // di = done init\n    this._di = true;\n    this._uw();\n\n    // @ifdef GAMEOBJECT_GROUP\n    children.map(child => this.addChild(child));\n    // @endif\n\n    // rf = render function\n    this._rf = render;\n\n    // uf = update function\n    this._uf = update;\n  }\n\n  /**\n   * Update all children\n   */\n  update(dt) {\n    this._uf(dt);\n\n    // @ifdef GAMEOBJECT_GROUP\n    this.children.map(child => child.update && child.update());\n    // @endif\n  }\n\n  /**\n   * Render the game object. Calls the game objects [draw()](api/gameObject#draw) function.\n   * @memberof GameObject\n   * @function render\n   *\n   * @param {Function} [filterObjects] - [Array.prototype.filter()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter) function which is used to filter which children to render.\n   */\n  render(filterObjects) {\n    let context = this.context;\n    context.save();\n\n    // 1) translate to position\n    //\n    // it's faster to only translate if one of the values is non-zero\n    // rather than always translating\n    // @see https://jsperf.com/translate-or-if-statement/2\n    if (this.x || this.y) {\n      context.translate(this.x, this.y);\n    }\n\n    // @ifdef GAMEOBJECT_ROTATION\n    // 2) rotate around the anchor\n    //\n    // it's faster to only rotate when set rather than always rotating\n    // @see https://jsperf.com/rotate-or-if-statement/2\n    if (this.rotation) {\n      context.rotate(this.rotation);\n    }\n    // @endif\n\n    // @ifdef GAMEOBJECT_CAMERA\n    // 3) translate to the camera position after rotation so camera\n    // values are in the direction of the rotation rather than always\n    // along the x/y axis\n    if (this.sx || this.sy) {\n      context.translate(-this.sx, -this.sy);\n    }\n    // @endif\n\n    // @ifdef GAMEOBJECT_SCALE\n    // 4) scale after translation to position so object can be\n    // scaled in place (rather than scaling position as well).\n    //\n    // it's faster to only scale if one of the values is not 1\n    // rather than always scaling\n    // @see https://jsperf.com/scale-or-if-statement/4\n    if (this.scaleX != 1 || this.scaleY != 1) {\n      context.scale(this.scaleX, this.scaleY);\n    }\n    // @endif\n\n    // @ifdef GAMEOBJECT_ANCHOR\n    // 5) translate to the anchor so (0,0) is the top left corner\n    // for the render function\n    let anchorX = -this.width * this.anchor.x;\n    let anchorY = -this.height * this.anchor.y;\n\n    if (anchorX || anchorY) {\n      context.translate(anchorX, anchorY);\n    }\n    // @endif\n\n    // @ifdef GAMEOBJECT_OPACITY\n    // it's not really any faster to gate the global alpha\n    // @see https://jsperf.com/global-alpha-or-if-statement/1\n    this.context.globalAlpha = this.opacity;\n    // @endif\n\n    this._rf();\n\n    // @ifdef GAMEOBJECT_ANCHOR\n    // 7) translate back to the anchor so children use the correct\n    // x/y value from the anchor\n    if (anchorX || anchorY) {\n      context.translate(-anchorX, -anchorY);\n    }\n    // @endif\n\n    // @ifdef GAMEOBJECT_GROUP\n    // perform all transforms on the parent before rendering the children\n    let children = this.children;\n    if (filterObjects) {\n      children = children.filter(filterObjects);\n    }\n    children.map(child => child.render && child.render());\n    // @endif\n\n    context.restore();\n  }\n\n  /**\n   * Draw the game object at its X and Y position, taking into account rotation, scale, and anchor.\n   *\n   * Do note that the canvas has been rotated and translated to the objects position (taking into account anchor), so {0,0} will be the top-left corner of the game object when drawing.\n   *\n   * If you override the game objects `render()` function with your own render function, you can call this function to draw the game object normally.\n   *\n   * ```js\n   * let { GameObject } = kontra;\n   *\n   * let gameObject = GameObject({\n   *  x: 290,\n   *  y: 80,\n   *  width: 20,\n   *  height: 40,\n   *\n   *  render: function() {\n   *    // draw the game object normally (perform rotation and other transforms)\n   *    this.draw();\n   *\n   *    // outline the game object\n   *    this.context.strokeStyle = 'yellow';\n   *    this.context.lineWidth = 2;\n   *    this.context.strokeRect(0, 0, this.width, this.height);\n   *  }\n   * });\n   *\n   * gameObject.render();\n   * ```\n   * @memberof GameObject\n   * @function draw\n   */\n  draw() {}\n\n  /**\n   * Sync property changes from the parent to the child\n   */\n  _pc(prop, value) {\n    this._uw();\n\n    // @ifdef GAMEOBJECT_GROUP\n    this.children.map(child => child._pc());\n    // @endif\n  }\n\n  /**\n   * X coordinate of the position vector.\n   * @memberof GameObject\n   * @property {Number} x\n   */\n  get x() {\n    return this.position.x;\n  }\n\n  /**\n   * Y coordinate of the position vector.\n   * @memberof GameObject\n   * @property {Number} y\n   */\n  get y() {\n    return this.position.y;\n  }\n\n  set x(value) {\n    this.position.x = value;\n\n    // pc = property changed\n    this._pc();\n  }\n\n  set y(value) {\n    this.position.y = value;\n    this._pc();\n  }\n\n  get width() {\n    // w = width\n    return this._w;\n  }\n\n  set width(value) {\n    this._w = value;\n    this._pc();\n  }\n\n  get height() {\n    // h = height\n    return this._h;\n  }\n\n  set height(value) {\n    this._h = value;\n    this._pc();\n  }\n\n  /**\n   * Update world properties\n   */\n  _uw() {\n    // don't update world properties until after the init has finished\n    if (!this._di) return;\n\n    // @ifdef GAMEOBJECT_GROUP||GAMEOBJECT_OPACITY||GAMEOBJECT_ROTATION||GAMEOBJECT_SCALE\n    let {\n      _wx = 0,\n      _wy = 0,\n\n      // @ifdef GAMEOBJECT_OPACITY\n      _wo = 1,\n      // @endif\n\n      // @ifdef GAMEOBJECT_ROTATION\n      _wr = 0,\n      // @endif\n\n      // @ifdef GAMEOBJECT_SCALE\n      _wsx = 1,\n      _wsy = 1\n      // @endif\n    } = (this.parent || {});\n    // @endif\n\n    // wx = world x, wy = world y\n    this._wx = this.x;\n    this._wy = this.y;\n\n    // ww = world width, wh = world height\n    this._ww = this.width;\n    this._wh = this.height;\n\n    // @ifdef GAMEOBJECT_OPACITY\n    // wo = world opacity\n    this._wo = _wo * this.opacity;\n    // @endif\n\n    // @ifdef GAMEOBJECT_ROTATION\n    // wr = world rotation\n    this._wr = _wr + this.rotation;\n\n    let {x, y} = rotatePoint({x: this.x, y: this.y}, _wr);\n    this._wx = x;\n    this._wy = y;\n    // @endif\n\n    // @ifdef GAMEOBJECT_SCALE\n    // wsx = world scale x, wsy = world scale y\n    this._wsx = _wsx * this.scaleX;\n    this._wsy = _wsy * this.scaleY;\n\n    this._wx = this.x * _wsx;\n    this._wy = this.y * _wsy;\n    this._ww = this.width * this._wsx;\n    this._wh = this.height * this._wsy;\n    // @endif\n\n    // @ifdef GAMEOBJECT_GROUP\n    this._wx += _wx;\n    this._wy += _wy;\n    // @endif\n  }\n\n  /**\n   * The world position, width, height, opacity, rotation, and scale. The world property is the true position, width, height, etc. of the object, taking into account all parents.\n   *\n   * The world property does not adjust for anchor or scale, so if you set a negative scale the world width or height could be negative. Use [getWorldRect](/api/helpers#getWorldRect) to get the world position and size adjusted for anchor and scale.\n   * @property {{x: number, y: number, width: number, height: number, opacity: number, rotation: number, scaleX: number, scaleY: number}} world\n   * @memberof GameObject\n   */\n  get world() {\n    return {\n      x: this._wx,\n      y: this._wy,\n      width: this._ww,\n      height: this._wh,\n\n      // @ifdef GAMEOBJECT_OPACITY\n      opacity: this._wo,\n      // @endif\n\n      // @ifdef GAMEOBJECT_ROTATION\n      rotation: this._wr,\n      // @endif\n\n      // @ifdef GAMEOBJECT_SCALE\n      scaleX: this._wsx,\n      scaleY: this._wsy\n      // @endif\n    }\n  }\n\n  // --------------------------------------------------\n  // group\n  // --------------------------------------------------\n\n  // @ifdef GAMEOBJECT_GROUP\n  /**\n   * Add an object as a child to this object. The childs [world](api/gameObject#world) property will be updated to take into account this object and all of its parents.\n   * @memberof GameObject\n   * @function addChild\n   *\n   * @param {GameObject} child - Object to add as a child.\n   *\n   * @example\n   * // exclude-code:start\n   * let { GameObject } = kontra;\n   * // exclude-code:end\n   * // exclude-script:start\n   * import { GameObject } from 'kontra';\n   * // exclude-script:end\n   *\n   * function createObject(x, y, color, size = 1) {\n   *   return GameObject({\n   *     x,\n   *     y,\n   *     width: 50 / size,\n   *     height: 50 / size,\n   *     anchor: {x: 0.5, y: 0.5},\n   *     color,\n   *     // exclude-code:start\n   *     context: context,\n   *     // exclude-code:end\n   *     render: function() {\n   *       this.context.fillStyle = this.color;\n   *       this.context.fillRect(0, 0, this.height, this.width);\n   *     }\n   *   });\n   * }\n   *\n   * let parent = createObject(300, 100, 'red');\n   * let child = createObject(25, 25, 'yellow', 2);\n   *\n   * parent.addChild(child);\n   *\n   * parent.render();\n   */\n  addChild(child, { absolute = false } = {}) {\n    this.children.push(child);\n    child.parent = this;\n    child._pc = child._pc || noop;\n    child._pc();\n  }\n\n  /**\n   * Remove an object as a child of this object. The removed objects [world](api/gameObject#world) property will be updated to not take into account this object and all of its parents.\n   * @memberof GameObject\n   * @function removeChild\n   *\n   * @param {GameObject} child - Object to remove as a child.\n   */\n  removeChild(child) {\n    let index = this.children.indexOf(child);\n    if (index !== -1) {\n      this.children.splice(index, 1);\n      child.parent = null;\n      child._pc();\n    }\n  }\n  // @endif\n\n  // --------------------------------------------------\n  // opacity\n  // --------------------------------------------------\n\n  // @ifdef GAMEOBJECT_OPACITY\n  get opacity() {\n    return this._opa;\n  }\n\n  set opacity(value) {\n    this._opa = value;\n    this._pc();\n  }\n  // @endif\n\n  // --------------------------------------------------\n  // rotation\n  // --------------------------------------------------\n\n  // @ifdef GAMEOBJECT_ROTATION\n  get rotation() {\n    return this._rot;\n  }\n\n  set rotation(value) {\n    this._rot = value;\n    this._pc();\n  }\n  // @endif\n\n  // --------------------------------------------------\n  // scale\n  // --------------------------------------------------\n\n  // @ifdef GAMEOBJECT_SCALE\n  /**\n   * Set the x and y scale of the object. If only one value is passed, both are set to the same value.\n   * @memberof GameObject\n   * @function setScale\n   *\n   * @param {Number} x - X scale value.\n   * @param {Number} [y=x] - Y scale value.\n   */\n  setScale(x, y = x) {\n    this.scaleX = x;\n    this.scaleY = y;\n  }\n\n  get scaleX() {\n    return this._scx;\n  }\n\n  set scaleX(value) {\n    this._scx = value;\n    this._pc();\n  }\n\n  get scaleY() {\n    return this._scy;\n  }\n\n  set scaleY(value) {\n    this._scy = value;\n    this._pc();\n  }\n  // @endif\n}\n\nfunction factory$2() {\n  return new GameObject(...arguments);\n}\nfactory$2.prototype = GameObject.prototype;\nfactory$2.class = GameObject;\n\n/**\n * A versatile way to update and draw your sprites. It can handle simple rectangles, images, and sprite sheet animations. It can be used for your main player object as well as tiny particles in a particle engine.\n * @class Sprite\n * @extends GameObject\n *\n * @param {Object} [properties] - Properties of the sprite.\n * @param {String} [properties.color] - Fill color for the game object if no image or animation is provided.\n * @param {HTMLImageElement|HTMLCanvasElement} [properties.image] - Use an image to draw the sprite.\n * @param {Object} [properties.animations] - An object of [Animations](api/animation) from a [Spritesheet](api/spriteSheet) to animate the sprite.\n */\nclass Sprite extends factory$2.class {\n  /**\n   * @docs docs/api_docs/sprite.js\n   */\n\n  init({\n    /**\n     * The color of the game object if it was passed as an argument.\n     * @memberof Sprite\n     * @property {String} color\n     */\n\n    // @ifdef SPRITE_IMAGE\n    /**\n     * The image the sprite will use when drawn if passed as an argument.\n     * @memberof Sprite\n     * @property {HTMLImageElement|HTMLCanvasElement} image\n     */\n    image,\n\n    /**\n     * The width of the sprite. If the sprite is a [rectangle sprite](api/sprite#rectangle-sprite), it uses the passed in value. For an [image sprite](api/sprite#image-sprite) it is the width of the image. And for an [animation sprite](api/sprite#animation-sprite) it is the width of a single frame of the animation.\n     * @memberof Sprite\n     * @property {Number} width\n     */\n    width = image ? image.width : undefined,\n\n    /**\n     * The height of the sprite. If the sprite is a [rectangle sprite](api/sprite#rectangle-sprite), it uses the passed in value. For an [image sprite](api/sprite#image-sprite) it is the height of the image. And for an [animation sprite](api/sprite#animation-sprite) it is the height of a single frame of the animation.\n     * @memberof Sprite\n     * @property {Number} height\n     */\n    height = image ? image.height : undefined,\n    // @endif\n\n    ...props\n  } = {}) {\n    super.init({\n      // @ifdef SPRITE_IMAGE\n      image,\n      width,\n      height,\n      // @endif\n      ...props\n    });\n  }\n\n  // @ifdef SPRITE_ANIMATION\n  /**\n   * An object of [Animations](api/animation) from a [SpriteSheet](api/spriteSheet) to animate the sprite. Each animation is named so that it can can be used by name for the sprites [playAnimation()](api/sprite#playAnimation) function.\n   *\n   * ```js\n   * import { Sprite, SpriteSheet } from 'kontra';\n   *\n   * let spriteSheet = SpriteSheet({\n   *   // ...\n   *   animations: {\n   *     idle: {\n   *       frames: 1,\n   *       loop: false,\n   *     },\n   *     walk: {\n   *       frames: [1,2,3]\n   *     }\n   *   }\n   * });\n   *\n   * let sprite = Sprite({\n   *   x: 100,\n   *   y: 200,\n   *   animations: spriteSheet.animations\n   * });\n   *\n   * sprite.playAnimation('idle');\n   * ```\n   * @memberof Sprite\n   * @property {Object} animations\n   */\n  get animations() {\n    return this._a;\n  }\n\n  set animations(value) {\n    let prop, firstAnimation;\n    // a = animations\n    this._a = {};\n\n    // clone each animation so no sprite shares an animation\n    for (prop in value) {\n      this._a[prop] = value[prop].clone();\n\n      // default the current animation to the first one in the list\n      firstAnimation = firstAnimation || this._a[prop];\n    }\n\n    /**\n     * The currently playing Animation object if `animations` was passed as an argument.\n     * @memberof Sprite\n     * @property {Animation} currentAnimation\n     */\n    this.currentAnimation = firstAnimation;\n    this.width = this.width || firstAnimation.width;\n    this.height = this.height || firstAnimation.height;\n  }\n\n  /**\n   * Set the currently playing animation of an animation sprite.\n   *\n   * ```js\n   * import { Sprite, SpriteSheet } from 'kontra';\n   *\n   * let spriteSheet = SpriteSheet({\n   *   // ...\n   *   animations: {\n   *     idle: {\n   *       frames: 1\n   *     },\n   *     walk: {\n   *       frames: [1,2,3]\n   *     }\n   *   }\n   * });\n   *\n   * let sprite = Sprite({\n   *   x: 100,\n   *   y: 200,\n   *   animations: spriteSheet.animations\n   * });\n   *\n   * sprite.playAnimation('idle');\n   * ```\n   * @memberof Sprite\n   * @function playAnimation\n   *\n   * @param {String} name - Name of the animation to play.\n   */\n  playAnimation(name) {\n    this.currentAnimation = this.animations[name];\n\n    if (!this.currentAnimation.loop) {\n      this.currentAnimation.reset();\n    }\n  }\n\n  advance(dt) {\n    super.advance(dt);\n\n    if (this.currentAnimation) {\n      this.currentAnimation.update(dt);\n    }\n  }\n  // @endif\n\n  draw() {\n    // @ifdef SPRITE_IMAGE\n    if (this.image) {\n      this.context.drawImage(\n        this.image,\n        0, 0, this.image.width, this.image.height\n      );\n    }\n    // @endif\n\n    // @ifdef SPRITE_ANIMATION\n    if (this.currentAnimation) {\n      this.currentAnimation.render({\n        x: 0,\n        y: 0,\n        width: this.width,\n        height: this.height,\n        context: this.context\n      });\n    }\n    // @endif\n\n    if (this.color) {\n      this.context.fillStyle = this.color;\n      this.context.fillRect(0, 0, this.width, this.height);\n    }\n  }\n}\n\nfunction factory$3() {\n  return new Sprite(...arguments);\n}\nfactory$3.prototype = Sprite.prototype;\nfactory$3.class = Sprite;\n\nlet fontSizeRegex = /(\\d+)(\\w+)/;\n\nfunction parseFont(font) {\n  let match = font.match(fontSizeRegex);\n\n  // coerce string to number\n  // @see https://github.com/jed/140bytes/wiki/Byte-saving-techniques#coercion-to-test-for-types\n  let size = +match[1];\n  let unit = match[2];\n  let computed = size;\n\n  // compute font size\n  // switch(unit) {\n  //   // px defaults to the size\n\n  //   // em uses the size of the canvas when declared (but won't keep in sync with\n  //   // changes to the canvas font-size)\n  //   case 'em': {\n  //     let fontSize = window.getComputedStyle(getCanvas()).fontSize;\n  //     let parsedSize = parseFont(fontSize).size;\n  //     computed = size * parsedSize;\n  //   }\n\n  //   // rem uses the size of the HTML element when declared (but won't keep in\n  //   // sync with changes to the HTML element font-size)\n  //   case 'rem': {\n  //     let fontSize = window.getComputedStyle(document.documentElement).fontSize;\n  //     let parsedSize = parseFont(fontSize).size;\n  //     computed = size * parsedSize;\n  //   }\n  // }\n\n  return {\n    size,\n    unit,\n    computed\n  };\n}\n\n/**\n * An object for drawing text to the screen. Supports newline characters as well as automatic new lines when setting the `width` property.\n *\n * You can also display RTL languages by setting the attribute `dir=\"rtl\"` on the main canvas element. Due to the limited browser support for individual text to have RTL settings, it must be set globally for the entire game.\n *\n * @example\n * // exclude-code:start\n * let { Text } = kontra;\n * // exclude-code:end\n * // exclude-script:start\n * import { Text } from 'kontra';\n * // exclude-script:end\n *\n * let text = Text({\n *   text: 'Hello World!\\nI can even be multiline!',\n *   font: '32px Arial',\n *   color: 'white',\n *   x: 300,\n *   y: 100,\n *   anchor: {x: 0.5, y: 0.5},\n *   textAlign: 'center'\n * });\n * // exclude-code:start\n * text.context = context;\n * // exclude-code:end\n *\n * text.render();\n * @class Text\n * @extends GameObject\n *\n * @param {Object} properties - Properties of the text.\n * @param {String} properties.text - The text to display.\n * @param {String} [properties.font] - The [font](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/font) style. Defaults to the main context font.\n * @param {String} [properties.color] - Fill color for the text. Defaults to the main context fillStyle.\n * @param {Number} [properties.width] - Set a fixed width for the text. If set, the text will automatically be split into new lines that will fit the size when possible.\n * @param {String} [properties.textAlign='left'] - The [textAlign](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/textAlign) for the context. If the `dir` attribute is set to `rtl` on the main canvas, the text will automatically be aligned to the right, but you can override that by setting this property.\n * @param {Number} [properties.lineHeight=1] - The distance between two lines of text.\n */\nclass Text extends factory$2.class {\n\n  init({\n\n    // --------------------------------------------------\n    // defaults\n    // --------------------------------------------------\n\n    /**\n     * The string of text. Use newline characters to create multi-line strings.\n     * @memberof Text\n     * @property {String} text\n     */\n    text = '',\n\n    /**\n     * The text alignment.\n     * @memberof Text\n     * @property {String} textAlign\n     */\n    textAlign = '',\n\n    /**\n     * The distance between two lines of text. The value is multiplied by the texts font size.\n     * @memberof Text\n     * @property {Number} lineHeight\n     */\n    lineHeight = 1,\n\n   /**\n    * The font style.\n    * @memberof Text\n    * @property {String} font\n    */\n    font = getContext().font,\n\n    /**\n     * The color of the text.\n     * @memberof Text\n     * @property {String} color\n     */\n\n     ...props\n  } = {}) {\n    super.init({\n      text,\n      textAlign,\n      lineHeight,\n      font,\n      ...props\n    });\n\n    // p = prerender\n    this._p();\n  }\n\n  // keep width and height getters/settings so we can set _w and _h and not\n  // trigger infinite call loops\n  get width() {\n    // w = width\n    return this._w;\n  }\n\n  set width(value) {\n    // d = dirty\n    this._d = true;\n    this._w = value;\n\n    // fw = fixed width\n    this._fw = value;\n  }\n\n  get text() {\n    return this._t;\n  }\n\n  set text(value) {\n    this._d = true;\n    this._t = value;\n  }\n\n  get font() {\n    return this._f;\n  }\n\n  set font(value) {\n    this._d = true;\n    this._f = value;\n    this._fs = parseFont(value).computed;\n  }\n\n  get lineHeight() {\n    // lh = line height\n    return this._lh;\n  }\n\n  set lineHeight(value) {\n    this._d = true;\n    this._lh = value;\n  }\n\n  render() {\n    if (this._d) {\n      this._p();\n    }\n    super.render();\n  }\n\n  /**\n   * Calculate the font width, height, and text strings before rendering.\n   */\n  _p() {\n    // s = strings\n    this._s = [];\n    this._d = false;\n    let context = this.context;\n\n    context.font = this.font;\n\n    // @ifdef TEXT_AUTONEWLINE\n    if (!this._s.length && this._fw) {\n      let parts = this.text.split(' ');\n      let start = 0;\n      let i = 2;\n\n      // split the string into lines that all fit within the fixed width\n      for (; i <= parts.length; i++) {\n        let str = parts.slice(start, i).join(' ');\n        let width = context.measureText(str).width;\n\n        if (width > this._fw) {\n          this._s.push(parts.slice(start, i - 1).join(' '));\n          start = i - 1;\n        }\n      }\n\n      this._s.push(parts.slice(start, i).join(' '));\n    }\n    // @endif\n\n    // @ifdef TEXT_NEWLINE\n    if (!this._s.length && this.text.includes('\\n')) {\n      let width = 0;\n      this.text.split('\\n').map(str => {\n        this._s.push(str);\n        width = Math.max(width, context.measureText(str).width);\n      });\n\n      this._w = this._fw || width;\n    }\n    // @endif\n\n    if (!this._s.length) {\n      this._s.push(this.text);\n      this._w = this._fw || context.measureText(this.text).width;\n    }\n\n    this.height = this._fs + ((this._s.length - 1) * this._fs * this.lineHeight);\n    this._uw();\n  }\n\n  draw() {\n    let alignX = 0;\n    let textAlign = this.textAlign;\n    let context = this.context;\n\n    // @ifdef TEXT_RTL\n    textAlign = this.textAlign || (context.canvas.dir === 'rtl' ? 'right' : 'left');\n    // @endif\n\n    // @ifdef TEXT_ALIGN||TEXT_RTL\n    alignX = textAlign === 'right'\n      ? this.width\n      : textAlign === 'center'\n        ? this.width / 2 | 0\n        : 0;\n    // @endif\n\n    this._s.map((str, index) => {\n      context.textBaseline = 'top';\n      context.textAlign = textAlign;\n      context.fillStyle = this.color;\n      context.font = this.font;\n      context.fillText(str, alignX, this._fs * this.lineHeight * index);\n    });\n  }\n}\n\nfunction factory$4() {\n  return new Text(...arguments);\n}\nfactory$4.prototype = Text.prototype;\nfactory$4.class = Text;\n\n/**\n * A simple pointer API. You can use it move the main sprite or respond to a pointer event. Works with both mouse and touch events.\n *\n * Pointer events can be added on a global level or on individual sprites or objects. Before an object can receive pointer events, you must tell the pointer which objects to track and the object must haven been rendered to the canvas using `object.render()`.\n *\n * After an object is tracked and rendered, you can assign it an `onDown()`, `onUp()`, `onOver()`, or `onOut()` functions which will be called whenever a pointer down, up, over, or out event happens on the object.\n *\n * ```js\n * import { initPointer, track, Sprite } from 'kontra';\n *\n * // this function must be called first before pointer\n * // functions will work\n * initPointer();\n *\n * let sprite = Sprite({\n *   onDown: function() {\n *     // handle on down events on the sprite\n *   },\n *   onUp: function() {\n *     // handle on up events on the sprite\n *   },\n *   onOver: function() {\n *     // handle on over events on the sprite\n *   },\n *   onOut: function() {\n *     // handle on out events on the sprite\n *   }\n * });\n *\n * track(sprite);\n * sprite.render();\n * ```\n *\n * By default, the pointer is treated as a circle and will check for collisions against objects assuming they are rectangular (have a width and height property).\n *\n * If you need to perform a different type of collision detection, assign the object a `collidesWithPointer()` function and it will be called instead. The function is passed the pointer object. Use this function to determine how the pointer circle should collide with the object.\n *\n * ```js\n * import { Sprite } from 'kontra';\n\n * let sprite = Srite({\n *   x: 10,\n *   y: 10,\n *   radius: 10\n *   collidesWithPointer: function(pointer) {\n *     // perform a circle v circle collision test\n *     let dx = pointer.x - this.x;\n *     let dy = pointer.y - this.y;\n *     return Math.sqrt(dx * dx + dy * dy) < this.radius;\n *   }\n * });\n * ```\n * @sectionName Pointer\n */\n\n// save each object as they are rendered to determine which object\n// is on top when multiple objects are the target of an event.\n// we'll always use the last frame's object order so we know\n// the finalized order of all objects, otherwise an object could ask\n// if it's being hovered when it's rendered first even if other objects\n// would block it later in the render order\nlet pointers = new WeakMap();\nlet callbacks$1 = {};\nlet pressedButtons = {};\n\n/**\n * Below is a list of buttons that you can use.\n *\n * - left, middle, right\n * @sectionName Available Buttons\n */\nlet buttonMap = {\n  0: 'left',\n  1: 'middle',\n  2: 'right'\n};\n\n/**\n * Get the pointer object which contains the `radius`, current `x` and `y` position of the pointer relative to the top-left corner of the canvas, and which `canvas` the pointer applies to.\n *\n * ```js\n * import { initPointer, getPointer } from 'kontra';\n *\n * initPointer();\n *\n * console.log(getPointer());  //=> { x: 100, y: 200, radius: 5, canvas: <canvas> };\n * ```\n *\n * @function getPointer\n *\n * @param {HTMLCanvasElement} [canvas] - The canvas which maintains the pointer. Defaults to [core.getCanvas()](api/core#getCanvas).\n *\n * @returns {{x: Number, y: Number, radius: Number, canvas: HTMLCanvasElement, touches: Object}} pointer with properties `x`, `y`, and `radius`. If using touch events, also has a `touches` object with keys of the touch identifier and the x/y position of the touch as the value.\n */\nfunction getPointer(canvas = getCanvas()) {\n  return pointers.get(canvas);\n}\n\n/**\n * Detection collision between a rectangle and a circle.\n * @see https://yal.cc/rectangle-circle-intersection-test/\n *\n * @param {Object} object - Object to check collision against.\n */\nfunction circleRectCollision(object, pointer) {\n  let { x, y, width, height } = getWorldRect(object);\n\n  // account for camera\n  do {\n    x -= object.sx || 0;\n    y -= object.sy || 0;\n  } while ((object = object.parent));\n\n  let dx = pointer.x - Math.max(x, Math.min(pointer.x, x + width));\n  let dy = pointer.y - Math.max(y, Math.min(pointer.y, y + height));\n  return (dx * dx + dy * dy) < (pointer.radius * pointer.radius);\n}\n\n/**\n * Get the first on top object that the pointer collides with.\n *\n * @param {Object} pointer - The pointer object\n *\n * @returns {Object} First object to collide with the pointer.\n */\nfunction getCurrentObject(pointer) {\n\n  // if pointer events are required on the very first frame or\n  // without a game loop, use the current frame\n  let renderedObjects = pointer._lf.length ?\n    pointer._lf :\n    pointer._cf;\n\n  for (let i = renderedObjects.length - 1; i >= 0; i--) {\n    let object = renderedObjects[i];\n    let collides = object.collidesWithPointer ?\n      object.collidesWithPointer(pointer) :\n      circleRectCollision(object, pointer);\n\n    if (collides) {\n      return object;\n    }\n  }\n}\n\n/**\n * Get the style property value.\n */\nfunction getPropValue(style, value) {\n  return parseFloat(style.getPropertyValue(value)) || 0;\n}\n\n/**\n * Calculate the canvas size, scale, and offset.\n *\n * @param {Object} The pointer object\n *\n * @returns {Object} The scale and offset of the canvas\n */\nfunction getCanvasOffset(pointer) {\n  // we need to account for CSS scale, transform, border, padding,\n  // and margin in order to get the correct scale and offset of the\n  // canvas\n  let { canvas, _s } = pointer;\n  let rect = canvas.getBoundingClientRect();\n\n  // @see https://stackoverflow.com/a/53405390/2124254\n  let transform = _s.transform !== 'none'\n    ? _s.transform.replace('matrix(', '').split(',')\n    : [1,1,1,1];\n  let transformScaleX = parseFloat(transform[0]);\n  let transformScaleY = parseFloat(transform[3]);\n\n  // scale transform applies to the border and padding of the element\n  let borderWidth = (getPropValue(_s, 'border-left-width') + getPropValue(_s, 'border-right-width')) * transformScaleX;\n  let borderHeight = (getPropValue(_s, 'border-top-width') + getPropValue(_s, 'border-bottom-width')) * transformScaleY;\n\n  let paddingWidth = (getPropValue(_s, 'padding-left') + getPropValue(_s, 'padding-right')) * transformScaleX;\n  let paddingHeight = (getPropValue(_s, 'padding-top') + getPropValue(_s, 'padding-bottom')) * transformScaleY;\n\n  return {\n    scaleX: (rect.width - borderWidth - paddingWidth) / canvas.width,\n    scaleY: (rect.height - borderHeight - paddingHeight) / canvas.height,\n    offsetX: rect.left + (getPropValue(_s, 'border-left-width') + getPropValue(_s, 'padding-left')) * transformScaleX,\n    offsetY: rect.top + (getPropValue(_s, 'border-top-width') + getPropValue(_s, 'padding-top')) * transformScaleY\n  };\n}\n\n/**\n * Execute the onDown callback for an object.\n *\n * @param {MouseEvent|TouchEvent} evt\n */\nfunction pointerDownHandler(evt) {\n\n  // touchstart should be treated like a left mouse button\n  let button = evt.button !== undefined ? buttonMap[evt.button] : 'left';\n  pressedButtons[button] = true;\n  pointerHandler(evt, 'onDown');\n}\n\n/**\n * Execute the onUp callback for an object.\n *\n * @param {MouseEvent|TouchEvent} evt\n */\nfunction pointerUpHandler(evt) {\n  let button = evt.button !== undefined ? buttonMap[evt.button] : 'left';\n  pressedButtons[button] = false;\n  pointerHandler(evt, 'onUp');\n}\n\n/**\n * Track the position of the mousevt.\n *\n * @param {MouseEvent|TouchEvent} evt\n */\nfunction mouseMoveHandler(evt) {\n  pointerHandler(evt, 'onOver');\n}\n\n/**\n * Reset pressed buttons.\n *\n * @param {MouseEvent|TouchEvent} evt\n */\nfunction blurEventHandler(evt) {\n  let pointer = pointers.get(evt.target);\n  pointer._oo = null;\n  pressedButtons = {};\n}\n\n/**\n * Find the first object for the event and execute it's callback function\n *\n * @param {MouseEvent|TouchEvent} evt\n * @param {string} eventName - Which event was called.\n */\nfunction pointerHandler(evt, eventName) {\n  evt.preventDefault();\n\n  let canvas = evt.target;\n  let pointer = pointers.get(canvas);\n  let {\n    scaleX,\n    scaleY,\n    offsetX,\n    offsetY\n  } = getCanvasOffset(pointer);\n\n  let isTouchEvent = ['touchstart', 'touchmove', 'touchend'].indexOf(evt.type) !== -1;\n\n  if (isTouchEvent) {\n\n    // update pointer.touches\n    pointer.touches = {};\n    for (var i = 0; i < evt.touches.length; i++) {\n      pointer.touches[evt.touches[i].identifier] = {\n        id: evt.touches[i].identifier,\n        x: (evt.touches[i].clientX - offsetX) / scaleX,\n        y: (evt.touches[i].clientY - offsetY) / scaleY,\n        changed: false\n      };\n    }\n\n    // handle all touches\n    for (var i = evt.changedTouches.length; i--;) {\n      const id = evt.changedTouches[i].identifier;\n      if (typeof pointer.touches[id] !== \"undefined\") {\n        pointer.touches[id].changed = true;\n      }\n\n      let clientX = evt.changedTouches[i].clientX;\n      let clientY = evt.changedTouches[i].clientY;\n      pointer.x = (clientX - offsetX) / scaleX;\n      pointer.y = (clientY - offsetY) / scaleY;\n\n      // Trigger events\n      let object = getCurrentObject(pointer);\n      if (object && object[eventName]) {\n        object[eventName](evt);\n      }\n\n      if (callbacks$1[eventName]) {\n        callbacks$1[eventName](evt, object);\n      }\n    }\n  }\n  else {\n\n    // translate the scaled size back as if the canvas was at a\n    // 1:1 scale\n    pointer.x = (evt.clientX - offsetX) / scaleX;\n    pointer.y = (evt.clientY - offsetY) / scaleY;\n\n    let object = getCurrentObject(pointer);\n    if (object && object[eventName]) {\n      object[eventName](evt);\n    }\n\n    if (callbacks$1[eventName]) {\n      callbacks$1[eventName](evt, object);\n    }\n\n    // handle onOut events\n    if (eventName == 'onOver') {\n      if (object != pointer._oo && pointer._oo && pointer._oo.onOut) {\n        pointer._oo.onOut(evt);\n      }\n\n      pointer._oo = object;\n    }\n  }\n}\n\n/**\n * Initialize pointer event listeners. This function must be called before using other pointer functions.\n *\n * If you need to use multiple canvas, you'll have to initialize the pointer for each one individually as each canvas maintains its own pointer object.\n * @function initPointer\n *\n * @param {HTMLCanvasElement} [canvas] - The canvas that event listeners will be attached to. Defaults to [core.getCanvas()](api/core#getCanvas).\n *\n * @returns {{x: Number, y: Number, radius: Number, canvas: HTMLCanvasElement, touches: Object}} The pointer object for the canvas.\n */\nfunction initPointer(canvas = getCanvas()) {\n  let pointer = pointers.get(canvas);\n  if (!pointer) {\n    let style = window.getComputedStyle(canvas);\n\n    pointer = {\n      x: 0,\n      y: 0,\n      radius: 5, // arbitrary size\n      touches: {},\n      canvas,\n\n      // cf = current frame, lf = last frame, o = objects,\n      // oo = over object, _s = style\n      _cf: [],\n      _lf: [],\n      _o: [],\n      _oo: null,\n      _s: style\n    };\n    pointers.set(canvas, pointer);\n  }\n\n  // if this function is called multiple times, the same event\n  // won't be added multiple times\n  // @see https://stackoverflow.com/questions/28056716/check-if-an-element-has-event-listener-on-it-no-jquery/41137585#41137585\n  canvas.addEventListener('mousedown', pointerDownHandler);\n  canvas.addEventListener('touchstart', pointerDownHandler);\n  canvas.addEventListener('mouseup', pointerUpHandler);\n  canvas.addEventListener('touchend', pointerUpHandler);\n  canvas.addEventListener('touchcancel', pointerUpHandler);\n  canvas.addEventListener('blur', blurEventHandler);\n  canvas.addEventListener('mousemove', mouseMoveHandler);\n  canvas.addEventListener('touchmove', mouseMoveHandler);\n\n  // however, the tick event should only be registered once\n  // otherwise it completely destroys pointer events\n  if (!pointer._t) {\n    pointer._t = true;\n\n    // reset object render order on every new frame\n    on('tick', () => {\n      pointer._lf.length = 0;\n\n      pointer._cf.map(object => {\n        pointer._lf.push(object);\n      });\n\n      pointer._cf.length = 0;\n    });\n  }\n\n  return pointer;\n}\n\n/**\n * Begin tracking pointer events for a set of objects. Takes a single object or an array of objects.\n *\n * ```js\n * import { initPointer, track } from 'kontra';\n *\n * initPointer();\n *\n * track(obj);\n * track(obj1, obj2);\n * ```\n * @function track\n *\n * @param {...Object[]} objects - Objects to track.\n */\nfunction track(...objects) {\n  objects.map(object => {\n    let canvas = object.context ? object.context.canvas : getCanvas();\n    let pointer = pointers.get(canvas);\n\n    // @ifdef DEBUG\n    if (!pointer) {\n      throw new ReferenceError('Pointer events not initialized for the objects canvas');\n    }    // @endif\n\n    // override the objects render function to keep track of render\n    // order\n    if (!object._r) {\n      object._r = object.render;\n\n      object.render = function() {\n        pointer._cf.push(this);\n        this._r();\n      };\n\n      pointer._o.push(object);\n    }\n  });\n}\n\n/**\n* Remove the callback function for a bound set of objects.\n *\n * ```js\n * import { untrack } from 'kontra';\n *\n * untrack(obj);\n * untrack(obj1, obj2);\n * ```\n * @function untrack\n *\n * @param {...Object[]} objects - Object or objects to stop tracking.\n */\nfunction untrack(...objects) {\n  objects.map(object => {\n    let canvas = object.context ? object.context.canvas : getCanvas();\n    let pointer = pointers.get(canvas);\n\n    // @ifdef DEBUG\n    if (!pointer) {\n      throw new ReferenceError('Pointer events not initialized for the objects canvas');\n    }    // @endif\n\n    // restore original render function to no longer track render order\n    object.render = object._r;\n    object._r = 0;  // 0 is the shortest falsy value\n\n    let index = pointer._o.indexOf(object);\n    if (index !== -1) {\n      pointer._o.splice(index, 1);\n    }\n  });\n}\n\n/**\n * Check to see if the pointer is currently over the object. Since multiple objects may be rendered on top of one another, only the top most object under the pointer will return true.\n *\n * ```js\n * import { initPointer, track, pointer, pointerOver, Sprite } from 'kontra';\n *\n * initPointer();\n *\n * let sprite1 = Sprite({\n *   x: 10,\n *   y: 10,\n *   width: 10,\n *   height: 10\n * });\n * let sprite2 = Sprite({\n *   x: 15,\n *   y: 10,\n *   width: 10,\n *   height: 10\n * });\n *\n * track(sprite1, sprite2);\n *\n * sprite1.render();\n * sprite2.render();\n *\n * pointer.x = 14;\n * pointer.y = 15;\n *\n * console.log(pointerOver(sprite1));  //=> false\n * console.log(pointerOver(sprite2));  //=> true\n * ```\n * @function pointerOver\n *\n * @param {Object} object - The object to check if the pointer is over.\n *\n * @returns {Boolean} `true` if the pointer is currently over the object, `false` otherwise.\n */\nfunction pointerOver(object) {\n  let canvas = object.context ? object.context.canvas : getCanvas();\n  let pointer = pointers.get(canvas);\n\n  // @ifdef DEBUG\n  if (!pointer) {\n    throw new ReferenceError('Pointer events not initialized for the objects canvas');\n  }  // @endif\n\n  return pointer._o.includes(object) && getCurrentObject(pointer) === object;\n}\n\n/**\n * Register a function to be called on all pointer down events. Is passed the original Event and the target object (if there is one).\n *\n * ```js\n * import { initPointer, onPointerDown } from 'kontra';\n *\n * initPointer();\n *\n * onPointerDown(function(e, object) {\n *   // handle pointer down\n * })\n * ```\n * @function onPointerDown\n *\n * @param {(evt: MouseEvent|TouchEvent, object?: Object) => void} callback - Function to call on pointer down.\n */\nfunction onPointerDown(callback) {\n  callbacks$1.onDown = callback;\n}\n\n/**\n* Register a function to be called on all pointer up events. Is passed the original Event and the target object (if there is one).\n *\n * ```js\n * import { initPointer, onPointerUp } from 'kontra';\n *\n * initPointer();\n *\n * onPointerUp(function(e, object) {\n *   // handle pointer up\n * })\n * ```\n * @function onPointerUp\n *\n * @param {(evt: MouseEvent|TouchEvent, object?: Object) => void} callback - Function to call on pointer up.\n */\nfunction onPointerUp(callback) {\n  callbacks$1.onUp = callback;\n}\n\n/**\n * Check if a button is currently pressed. Use during an `update()` function to perform actions each frame.\n *\n * ```js\n * import { initPointer, pointerPressed } from 'kontra';\n *\n * initPointer();\n *\n * Sprite({\n *   update: function() {\n *     if (pointerPressed('left')){\n *       // left mouse button pressed\n *     }\n *     else if (pointerPressed('right')) {\n *       // right mouse button pressed\n *     }\n *   }\n * });\n * ```\n * @function pointerPressed\n *\n * @param {String} button - Button to check for pressed state.\n *\n * @returns {Boolean} `true` if the button is pressed, `false` otherwise.\n */\nfunction pointerPressed(button) {\n  return !!pressedButtons[button]\n}\n\n/**\n * An accessible button. Supports screen readers and keyboard navigation using the <kbd>Tab</kbd> key. The button is automatically [tracked](api/pointer#track) by the pointer and accepts all pointer functions, but you will still need to call [initPointer](api/pointer#initPointer) to have pointer events enabled.\n * @class Button\n * @extends Sprite\n *\n * @param {Object} [properties] - Properties of the button (in addition to all Sprite properties).\n * @param {Object} [properties.text] - Properties of [Text](api/text) which are used to create the [textNode](api/button#textNode).\n * @param {Number} [properties.padX=0] - The horizontal padding.\n * @param {Number} [properties.padY=0] - The vertical padding.\n * @param {Function} [properties.onEnable] - Function called when the button is enabled.\n * @param {Function} [properties.onDisable] - Function called when the button is disabled.\n * @param {Function} [properties.onFocus] - Function called when the button is focused by the keyboard.\n * @param {Function} [properties.onBlur] - Function called when the button losses focus either by the pointer or keyboard.\n */\nclass Button extends factory$3.class {\n  /**\n   * @docs docs/api_docs/button.js\n   */\n\n  init({\n    /**\n     * The horizontal padding. This will be added to the width to give the final width of the button.\n     * @memberof Button\n     * @property {Number} padX\n     */\n    padX = 0,\n\n    /**\n     * The vertical padding. This will be added to the height to give the final height of the button.\n     * @memberof Button\n     * @property {Number} padY\n     */\n    padY = 0,\n\n    text,\n    onDown,\n    onUp,\n    ...props\n  } = {}) {\n    super.init({\n      padX,\n      padY,\n      ...props\n    });\n\n    /**\n     * Each Button creates a Text object and adds it as a child. The `text` of the Text object is used as the accessible name of the HTMLButtonElement.\n     * @memberof Button\n     * @property {Text} textNode\n     */\n    this.textNode = factory$4({\n      ...text,\n\n      // ensure the text uses the same context as the button\n      context: this.context\n    });\n\n    // if the user didn't set a width/height or use an image\n    // default to the textNode dimensions\n    if (!this.width) {\n      this.width = this.textNode.width;\n      this.height = this.textNode.height;\n    }\n\n    track(this);\n    this.addChild(this.textNode);\n\n    // od = on down\n    this._od = onDown || noop;\n\n    // ou = on up\n    this._ou = onUp || noop;\n\n    // create an accessible DOM node for screen readers\n    // dn = dom node\n    const button = this._dn = document.createElement('button');\n    button.style = srOnlyStyle;\n    button.textContent = this.text;\n\n    // sync events between the button element and the class\n    button.addEventListener('focus', () => this.focus());\n    button.addEventListener('blur', () => this.blur());\n    button.addEventListener('keydown', (evt) => this._kd(evt));\n    button.addEventListener('keyup', (evt) => this._ku(evt));\n\n    addToDom(button, this.context.canvas);\n\n    this._uw();\n    this._p();\n  }\n\n  /**\n   * The text property of the Text object.\n   * @memberof Button\n   * @property {String} text\n   */\n  get text() {\n    return this.textNode.text;\n  }\n\n  set text(value) {\n    // d = dirty\n    this._d = true;\n    this.textNode.text = value;\n  }\n\n  /**\n   * Clean up the button by removing the HTMLButtonElement from the DOM.\n   * @memberof Button\n   * @function destroy\n   */\n  destroy() {\n    this._dn.remove();\n  }\n\n  _p() {\n    // update DOM node text if it has changed\n    if (this.text !== this._dn.textContent) {\n      this._dn.textContent = this.text;\n    }\n\n    // update width and height (need to prerender the button\n    // first)\n    this.textNode._p();\n\n    let width = this.textNode.width + this.padX * 2;\n    let height = this.textNode.height + this.padY * 2;\n\n    this.width = Math.max(width, this.width);\n    this.height = Math.max(height, this.height);\n    this._uw();\n  }\n\n  render() {\n    if (this._d) {\n      this._p();\n    }\n\n    super.render();\n  }\n\n  /**\n   * Enable the button. Calls [onEnable](api/button#onEnable) if passed.\n   * @memberof Button\n   * @function enable\n   */\n  enable() {\n\n    /**\n     * If the button is disabled.\n     * @memberof Button\n     * @property {Boolean} disabled\n     */\n    this.disabled = this._dn.disabled = false;\n    this.onEnable();\n  }\n\n  /**\n   * Disable the button. A disabled button will not longer render nor respond to pointer and keyboard events. Calls [onDisable](api/button#onDisable) if passed.\n   * @memberof Button\n   * @function disable\n   */\n  disable() {\n    this.disabled = this._dn.disabled = true;\n    this.onDisable();\n  }\n\n  /**\n   * Focus the button. Calls [onFocus](api/button#onFocus) if passed.\n   * @memberof Button\n   * @function focus\n   */\n  focus() {\n    if (!this.disabled) {\n\n      /**\n       * If the button is focused.\n       * @memberof Button\n       * @property {Boolean} focused\n       */\n      this.focused = true;\n      // prevent infinite loop\n      if (document.activeElement != this._dn) this._dn.focus();\n\n      this.onFocus();\n    }\n  }\n\n  /**\n   * Blur the button. Calls [onBlur](api/button#onBlur) if passed.\n   * @memberof Button\n   * @function blur\n   */\n  blur() {\n    this.focused = false;\n    // prevent infinite loop\n    if (document.activeElement == this._dn) this._dn.blur();\n\n    this.onBlur();\n  }\n\n  onOver() {\n    if (!this.disabled) {\n\n      /**\n       * If the button is hovered.\n       * @memberof Button\n       * @property {Boolean} hovered\n       */\n      this.hovered = true;\n    }\n  }\n\n  onOut() {\n    this.hovered = false;\n  }\n\n  /**\n   * Function called when then button is enabled. Override this function to have the button do something when enabled.\n   * @memberof Button\n   * @function onEnable\n   */\n  onEnable() {}\n\n  /**\n   * Function called when then button is disabled. Override this function to have the button do something when disabled.\n   * @memberof Button\n   * @function onDisable\n   */\n  onDisable() {}\n\n  /**\n   * Function called when then button is focused. Override this function to have the button do something when focused.\n   * @memberof Button\n   * @function onFocus\n   */\n  onFocus() {}\n\n  /**\n   * Function called when then button is blurred. Override this function to have the button do something when blurred.\n   * @memberof Button\n   * @function onBlur\n   */\n  onBlur() {}\n\n  onDown() {\n    if (!this.disabled) {\n\n      /**\n       * If the button is pressed.\n       * @memberof Button\n       * @property {Boolean} pressed\n       */\n      this.pressed = true;\n      this._od();\n    }\n  }\n\n  onUp() {\n    if (!this.disabled) {\n      this.pressed = false;\n      this._ou();\n    }\n  }\n\n  // kd = keydown\n  _kd(evt) {\n    // activate button on enter or space\n    if (evt.code == 'Enter' || evt.code == 'Space') {\n      this.onDown();\n    }\n  }\n\n  // kd = keydown\n  _ku(evt) {\n    // activate button on enter or space\n    if (evt.code == 'Enter' || evt.code == 'Space') {\n      this.onUp();\n    }\n  }\n}\n\nfunction factory$5() {\n  return new Button(...arguments);\n}\nfactory$5.prototype = Button.prototype;\nfactory$5.class = Button;\n\n/**\n * Clear the canvas.\n */\nfunction clear(context) {\n  let canvas = context.canvas;\n  context.clearRect(0, 0, canvas.width, canvas.height);\n}\n\n/**\n * The game loop updates and renders the game every frame. The game loop is stopped by default and will not start until the loops `start()` function is called.\n *\n * The game loop uses a time-based animation with a fixed `dt` to [avoid frame rate issues](http://blog.sklambert.com/using-time-based-animation-implement/). Each update call is guaranteed to equal 1/60 of a second.\n *\n * This means that you can avoid having to do time based calculations in your update functions and instead do fixed updates.\n *\n * ```js\n * import { Sprite, GameLoop } from 'kontra';\n *\n * let sprite = Sprite({\n *   x: 100,\n *   y: 200,\n *   width: 20,\n *   height: 40,\n *   color: 'red'\n * });\n *\n * let loop = GameLoop({\n *   update: function(dt) {\n *     // no need to determine how many pixels you want to\n *     // move every second and multiple by dt\n *     // sprite.x += 180 * dt;\n *\n *     // instead just update by how many pixels you want\n *     // to move every frame and the loop will ensure 60FPS\n *     sprite.x += 3;\n *   },\n *   render: function() {\n *     sprite.render();\n *   }\n * });\n *\n * loop.start();\n * ```\n * @class GameLoop\n *\n * @param {Object} properties - Properties of the game loop.\n * @param {(dt?: Number) => void} [properties.update] - Function called every frame to update the game. Is passed the fixed `dt` as a parameter.\n * @param {Function} properties.render - Function called every frame to render the game.\n * @param {Number}   [properties.fps=60] - Desired frame rate.\n * @param {Boolean}  [properties.clearCanvas=true] - Clear the canvas every frame before the `render()` function is called.\n * @param {CanvasRenderingContext2D} [properties.context] - The context that should be cleared each frame if `clearContext` is not set to `false`. Defaults to [core.getContext()](api/core#getContext).\n */\nfunction GameLoop({\n  fps = 60,\n  clearCanvas = true,\n  update = noop,\n  render,\n  context = getContext()\n} = {}) {\n  // check for required functions\n  // @ifdef DEBUG\n  if (!render) {\n    throw Error('You must provide a render() function');\n  }\n  // @endif\n\n  // animation variables\n  let accumulator = 0;\n  let delta = 1E3 / fps;  // delta between performance.now timings (in ms)\n  let step = 1 / fps;\n  let clearFn = clearCanvas ? clear : noop;\n  let last, rAF, now, dt, loop;\n\n  /**\n   * Called every frame of the game loop.\n   */\n  function frame() {\n    rAF = requestAnimationFrame(frame);\n\n    now = performance.now();\n    dt = now - last;\n    last = now;\n\n    // prevent updating the game with a very large dt if the game were to lose focus\n    // and then regain focus later\n    if (dt > 1E3) {\n      return;\n    }\n\n    emit('tick');\n    accumulator += dt;\n\n    while (accumulator >= delta) {\n      loop.update(step);\n\n      accumulator -= delta;\n    }\n\n    clearFn(context);\n    loop.render();\n  }\n\n  // game loop object\n  loop = {\n    /**\n     * Called every frame to update the game. Put all of your games update logic here.\n     * @memberof GameLoop\n     * @function update\n     *\n     * @param {Number} [dt] - The fixed dt time of 1/60 of a frame.\n     */\n    update,\n\n    /**\n     * Called every frame to render the game. Put all of your games render logic here.\n     * @memberof GameLoop\n     * @function render\n     */\n    render,\n\n    /**\n     * If the game loop is currently stopped.\n     *\n     * ```js\n     * import { GameLoop } from 'kontra';\n     *\n     * let loop = GameLoop({\n     *   // ...\n     * });\n     * console.log(loop.isStopped);  //=> true\n     *\n     * loop.start();\n     * console.log(loop.isStopped);  //=> false\n     *\n     * loop.stop();\n     * console.log(loop.isStopped);  //=> true\n     * ```\n     * @memberof GameLoop\n     * @property {Boolean} isStopped\n     */\n    isStopped: true,\n\n    /**\n     * Start the game loop.\n     * @memberof GameLoop\n     * @function start\n     */\n    start() {\n      last = performance.now();\n      this.isStopped = false;\n      requestAnimationFrame(frame);\n    },\n\n    /**\n     * Stop the game loop.\n     * @memberof GameLoop\n     * @function stop\n     */\n    stop() {\n      this.isStopped = true;\n      cancelAnimationFrame(rAF);\n    },\n\n    // expose properties for testing\n    // @ifdef DEBUG\n    _frame: frame,\n    set _last(value) {\n      last = value;\n    }\n    // @endif\n  };\n\n  return loop;\n}\n\nlet handler = {\n  set(obj, prop, value) {\n\n    // don't set dirty for private properties\n    if (!prop.startsWith('_')) {\n      obj._d = true;\n    }\n\n    return Reflect.set(obj, prop, value);\n  }\n};\n\nlet alignment = {\n  start(rtl) {\n    return rtl ? 1 : 0;\n  },\n  center() {\n    return 0.5;\n  },\n  end(rtl) {\n    return rtl ? 0 : 1;\n  }\n};\n\n/**\n * Quickly and easily organize your UI elements into a grid. Works great for auto placing menu options without having to figure out the position for each one. Based on the concept of CSS Grid Layout.\n * @class Grid\n * @extends GameObject\n *\n * @param {Object} [properties] - Properties of the grid manager.\n * @param {String} [properties.flow='column'] - The flow of the grid.\n * @param {String} [properties.align='start'] - The vertical alignment of the grid.\n * @param {String} [properties.justify='start'] - The horizontal alignment of the grid.\n * @param {Number|Number[]} [properties.colGap=0] - The horizontal gap between each column in the grid.\n * @param {Number|Number[]} [properties.rowGap=0] - The vertical gap between each row in the grid.\n * @param {Number} [properties.numCols=1] - The number of columns in the grid. Only applies if the `flow` property is set to `grid`.\n * @param {String} [properties.dir=''] - The direction of the grid.\n * @param {{metric: Function, callback: Function}[]} [properties.breakpoints=[]] - How the grid should change based on different metrics.\n */\nclass Grid extends factory$2.class {\n  /**\n   * @docs docs/api_docs/grid.js\n   */\n\n  init({\n    /**\n     * How to organize all objects in the grid. Valid values are:\n     *\n     * - `column` - organize into a single column\n     * - `row` - organize into a single row\n     * - `grid` - organize into a grid with [numCols](api/grid#numCols) number of columns\n     * @memberof Grid\n     * @property {String} flow\n     */\n    flow = 'column',\n\n    /**\n     * The vertical alignment of the grid. Valid values are:\n     *\n     * - `start` - align to the top of row\n     * - `center` - align to the center of the row\n     * - `end` - align to the the bottom of the row\n     *\n     * Additionally, each child of the grid can use the `alignSelf` property to change it's alignment in the grid.\n     * @memberof Grid\n     * @property {String} align\n     */\n    align = 'start',\n\n    /**\n     * The horizontal alignment of the grid. Valid values are:\n     *\n     * - `start` - align to the left of column\n     * - `center` - align to the center of the column\n     * - `end` - align to the the right of the column\n     *\n     * If the [dir](api/grid#dir) property is set to `rtl`, then `start` and `end` are reversed.\n     *\n     * Additionally, each child of the grid can use the `justifySelf` property to change it's alignment in the grid.\n     * @memberof Grid\n     * @property {String} justify\n     */\n    justify = 'start',\n\n    /**\n     * The horizontal gap between each column in the grid.\n     *\n     * An array of numbers means the grid will set the gap between columns using the order of the array. For example, if the gap is set to be `[10, 5]`, then every odd column gap with use 10 and every even column gap will use 5.\n     * @memberof Grid\n     * @property {Number|Number[]} colGap\n     */\n    colGap = 0,\n\n     /**\n     * The vertical gap between each row in the grid.\n     *\n     * An array of numbers means the grid will set the gap between rows using the order of the array. For example, if the gap is set to be `[10, 5]`, then every odd row gap with use 10 and every even row gap will use 5.\n     * @memberof Grid\n     * @property {Number|Number[]} rowGap\n     */\n    rowGap = 0,\n\n    /**\n     * The number of columns in the grid. Only applies if the [flow](api/grid#flow) property is set to `grid`.\n     * @memberof Grid\n     * @property {Number} numCols\n     */\n    numCols = 1,\n\n    /**\n     * The direction of the grid. Defaults to organizing the grid objects left-to-right, but if set to `rtl` then the grid is organized right-to-left.\n     * @memberof Grid\n     * @property {String} dir\n     */\n    dir = '',\n\n    /**\n     * How the grid should change based on different metrics. Based on the concept of CSS Media Queries so you can update how the grid organizes the objects when things change (such as the scale).\n     *\n     * Each object in the array uses the `metric()` function to determine when the breakpoint applies and the `callback()` function is called to change any properties of the grid.\n     *\n     * ```js\n     * let { Grid } = kontra;\n     *\n     * let grid = Grid({\n     *   breakpoints: [{\n     *     metric() {\n     *       return this.scaleX < 1\n     *     },\n     *     callback() {\n     *       this.numCols = 1;\n     *     }\n     *   },\n     *   {\n     *     metric() {\n     *       return this.scaleX >= 1\n     *     },\n     *     callback() {\n     *       this.numCols = 2;\n     *     }\n     *   }]\n     * });\n     * ```\n     * @memberof Grid\n     * @property {{metric: Function, callback: Function}[]} breakpoints\n     */\n    breakpoints = [],\n\n    ...props\n  } = {}) {\n    super.init({\n      flow,\n      align,\n      justify,\n      colGap,\n      rowGap,\n      numCols,\n      dir,\n      breakpoints,\n      ...props\n    });\n\n    this._p();\n    return new Proxy(this, handler);\n  }\n\n  addChild(child) {\n    this._d = true;\n    super.addChild(child);\n  }\n\n  removeChild(child) {\n    this._d = true;\n    super.removeChild(child);\n  }\n\n  render() {\n    if (this._d) {\n      this._p();\n    }\n    super.render();\n  }\n\n  /**\n   * Call `destroy()` on all children.\n   * @memberof Grid\n   * @function destroy\n   */\n  destroy() {\n    this.children.map(child => child.destroy && child.destroy());\n  }\n\n  /**\n   * Build the grid and calculate its width and height\n   */\n  _p() {\n    this._d = false;\n\n    this.breakpoints.map(breakpoint => {\n      // b = breakpoint\n      if (breakpoint.metric.call(this) && this._b !== breakpoint) {\n        this._b = breakpoint;\n        breakpoint.callback.call(this);\n      }\n    });\n\n    // g = grid, cw = colWidths, rh = rowHeights\n    let grid = this._g = [];\n    let colWidths = this._cw = [];\n    let rowHeights = this._rh = [];\n    let children = this.children;\n\n    // nc = numCols\n    let numCols = this._nc = this.flow === 'column'\n      ? 1\n      : this.flow === 'row'\n        ? children.length\n        : this.numCols;\n\n    let row = 0;\n    let col = 0;\n    for (let i = 0, child; child = children[i]; i++) {\n      grid[row] = grid[row] || [];\n\n      // prerender child to get current width/height\n      if (child._p) {\n        child._p();\n      }\n\n      rowHeights[row] = Math.max(rowHeights[row] || 0, child.height);\n\n      let spans = child.colSpan || 1;\n      let colSpan = spans;\n      do {\n        colWidths[col] = Math.max(colWidths[col] || 0, child.width / colSpan);\n        grid[row][col] = child;\n      } while (colSpan + col++ <= numCols && --spans);\n\n      if (col >= numCols) {\n        col = 0;\n        row++;\n      }\n    }\n\n    // fill remaining row\n    while (col > 0 && col < numCols) {\n      // add empty array item so we can reverse a row even when it\n      // contains less items than another row\n      grid[row][col++] = false;\n    }\n    let numRows = grid.length;\n\n    let colGap = [].concat(this.colGap);\n    let rowGap = [].concat(this.rowGap);\n\n    this._w = colWidths.reduce((acc, width) => acc += width, 0);\n    for (let i = 0; i < numCols - 1; i++) {\n      this._w += colGap[i % colGap.length];\n    }\n\n    this._h = rowHeights.reduce((acc, height) => acc += height, 0);\n    for (let i = 0; i < numRows - 1; i++) {\n      this._h += rowGap[i % rowGap.length];\n    }\n\n    this._uw();\n\n    // reverse columns. direction property overrides canvas dir\n    let dir = this.context.canvas.dir;\n    let rtl = (dir === 'rtl' && !this.dir) || this.dir === 'rtl';\n    this._rtl = rtl;\n    if (rtl) {\n      this._g = grid.map(row => row.reverse());\n      this._cw = colWidths.reverse();\n    }\n\n    let topLeftY = -this.anchor.y * this.height;\n    let rendered = [];\n\n    this._g.map((gridRow, row) => {\n      let topLeftX = -this.anchor.x * this.width;\n\n      gridRow.map((child, col) => {\n        // don't render the same child multiple times if it uses colSpan\n        if (child && !rendered.includes(child)) {\n          rendered.push(child);\n\n          let justify = alignment[child.justifySelf || this.justify](this._rtl);\n          let align = alignment[child.alignSelf || this.align]();\n\n          let colSpan = child.colSpan || 1;\n          let colWidth = colWidths[col];\n          if (colSpan > 1 && col + colSpan <= this._nc) {\n            for (let i = 1; i < colSpan; i++) {\n              colWidth += colWidths[col + i] + colGap[(col + i) % colGap.length];\n            }\n          }\n\n          let pointX = colWidth * justify;\n          let pointY = rowHeights[row] * align;\n          let anchorX = 0;\n          let anchorY = 0;\n          let { width, height } = child;\n\n          if (child.anchor) {\n            anchorX = child.anchor.x;\n            anchorY = child.anchor.y;\n          }\n\n          // calculate the x position based on the alignment and\n          // anchor of the object\n          if (justify === 0) {\n            pointX = pointX + width * anchorX;\n          }\n          else if (justify === 0.5) {\n            let sign = anchorX < 0.5 ? -1 : anchorX === 0.5 ? 0 : 1;\n            pointX = pointX + sign * width * justify;\n          }\n          else {\n            pointX = pointX - (width * (1 - anchorX));\n          }\n\n          // calculate the y position based on the justification and\n          // anchor of the object\n          if (align === 0) {\n            pointY = pointY + height * anchorY;\n          }\n          else if (align === 0.5) {\n            let sign = anchorY < 0.5 ? -1 : anchorY === 0.5 ? 0 : 1;\n            pointY = pointY + sign * height * align;\n          }\n          else {\n            pointY = pointY - (height * (1 - anchorY));\n          }\n\n          child.x = topLeftX + pointX;\n          child.y = topLeftY + pointY;\n        }\n\n        topLeftX += colWidths[col] + colGap[col % colGap.length];\n      });\n\n      topLeftY += rowHeights[row] + rowGap[row % rowGap.length];\n    });\n  }\n}\n\nfunction factory$6() {\n  return new Grid(...arguments);\n}\nfactory$6.prototype = Grid.prototype;\nfactory$6.class = Grid;\n\n/**\n * A minimalistic keyboard API. You can use it move the main sprite or respond to a key press.\n *\n * ```js\n * import { initKeys, keyPressed } from 'kontra';\n *\n * // this function must be called first before keyboard\n * // functions will work\n * initKeys();\n *\n * function update() {\n *   if (keyPressed('left')) {\n *     // move left\n *   }\n * }\n * ```\n * @sectionName Keyboard\n */\n\n/**\n * Below is a list of keys that are provided by default. If you need to extend this list, you can use the [keyMap](api/keyboard#keyMap) property.\n *\n * - a-z\n * - 0-9\n * - enter, esc, space, left, up, right, down\n * @sectionName Available Keys\n */\n\nlet callbacks$2 = {};\nlet pressedKeys = {};\n\n/**\n * A map of [KeyboardEvent code values](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/code/code_values) to key names. Add to this object to expand the list of [available keys](api/keyboard#available-keys).\n *\n * ```js\n * import { keyMap, bindKeys } from 'kontra';\n *\n * keyMap['ControlRight'] = 'ctrl';\n *\n * bindKeys('ctrl', function(e) {\n *   // handle ctrl key\n * });\n * ```\n * @property {{[key in (String|Number)]: string}} keyMap\n */\nlet keyMap = {\n  // named keys\n  'Enter': 'enter',\n  'Escape': 'esc',\n  'Space': 'space',\n  'ArrowLeft': 'left',\n  'ArrowUp': 'up',\n  'ArrowRight': 'right',\n  'ArrowDown': 'down'\n};\n\n/**\n * Execute a function that corresponds to a keyboard key.\n *\n * @param {KeyboardEvent} evt\n */\nfunction keydownEventHandler(evt) {\n  let key = keyMap[evt.code];\n  pressedKeys[key] = true;\n\n  if (callbacks$2[key]) {\n    callbacks$2[key](evt);\n  }\n}\n\n/**\n * Set the released key to not being pressed.\n *\n * @param {KeyboardEvent} evt\n */\nfunction keyupEventHandler(evt) {\n  pressedKeys[ keyMap[evt.code] ] = false;\n}\n\n/**\n * Reset pressed keys.\n */\nfunction blurEventHandler$1() {\n  pressedKeys = {};\n}\n\n/**\n * Initialize keyboard event listeners. This function must be called before using other keyboard functions.\n * @function initKeys\n */\nfunction initKeys() {\n  let i;\n\n  // alpha keys\n  // @see https://stackoverflow.com/a/43095772/2124254\n  for (i = 0; i < 26; i++) {\n    // rollupjs considers this a side-effect (for now), so we'll do it in the\n    // initKeys function\n    keyMap[i + 65] = keyMap['Key' + String.fromCharCode(i + 65)] = String.fromCharCode(i + 97);\n  }\n\n  // numeric keys\n  for (i = 0; i < 10; i++) {\n    keyMap[48+i] = keyMap['Digit'+i] = ''+i;\n  }\n\n  window.addEventListener('keydown', keydownEventHandler);\n  window.addEventListener('keyup', keyupEventHandler);\n  window.addEventListener('blur', blurEventHandler$1);\n}\n\n/**\n * Bind a set of keys that will call the callback function when they are pressed. Takes a single key or an array of keys. Is passed the original KeyboardEvent as a parameter.\n *\n * ```js\n * import { initKeys, bindKeys } from 'kontra';\n *\n * initKeys();\n *\n * bindKeys('p', function(e) {\n *   // pause the game\n * });\n * bindKeys(['enter', 'space'], function(e) {\n *   e.preventDefault();\n *   // fire gun\n * });\n * ```\n * @function bindKeys\n *\n * @param {String|String[]} keys - Key or keys to bind.\n * @param {(evt: KeyboardEvent) => void} callback - The function to be called when the key is pressed.\n */\nfunction bindKeys(keys, callback) {\n  // smaller than doing `Array.isArray(keys) ? keys : [keys]`\n  [].concat(keys).map(key => callbacks$2[key] = callback);\n}\n\n/**\n * Remove the callback function for a bound set of keys. Takes a single key or an array of keys.\n *\n * ```js\n * import { unbindKeys } from 'kontra';\n *\n * unbindKeys('left');\n * unbindKeys(['enter', 'space']);\n * ```\n * @function unbindKeys\n *\n * @param {String|String[]} keys - Key or keys to unbind.\n */\nfunction unbindKeys(keys) {\n  // 0 is the smallest falsy value\n  [].concat(keys).map(key => callbacks$2[key] = 0);\n}\n\n/**\n * Check if a key is currently pressed. Use during an `update()` function to perform actions each frame.\n *\n * ```js\n * import { Sprite, initKeys, keyPressed } from 'kontra';\n *\n * initKeys();\n *\n * let sprite = Sprite({\n *   update: function() {\n *     if (keyPressed('left')){\n *       // left arrow pressed\n *     }\n *     else if (keyPressed('right')) {\n *       // right arrow pressed\n *     }\n *\n *     if (keyPressed('up')) {\n *       // up arrow pressed\n *     }\n *     else if (keyPressed('down')) {\n *       // down arrow pressed\n *     }\n *   }\n * });\n * ```\n * @function keyPressed\n *\n * @param {String} key - Key to check for pressed state.\n *\n * @returns {Boolean} `true` if the key is pressed, `false` otherwise.\n */\nfunction keyPressed(key) {\n  return !!pressedKeys[key];\n}\n\n/**\n * A plugin system based on the [interceptor pattern](https://en.wikipedia.org/wiki/Interceptor_pattern), designed to share reusable code such as more advance collision detection or a 2D physics engine.\n *\n * ```js\n * import { registerPlugin, Sprite } from 'kontra';\n * import loggingPlugin from 'path/to/plugin/code.js'\n *\n * // register a plugin that adds logging to all Sprites\n * registerPlugin(Sprite, loggingPlugin);\n * ```\n * @sectionName Plugin\n */\n\n/**\n * @docs docs/api_docs/plugin.js\n */\n\n/**\n * Get the kontra object method name from the plugin.\n *\n * @param {String} methodName - Before/After function name\n *\n * @returns {String}\n */\nfunction getMethod(methodName) {\n  let methodTitle = methodName.substr( methodName.search(/[A-Z]/) );\n  return methodTitle[0].toLowerCase() + methodTitle.substr(1);\n}\n\n/**\n * Remove an interceptor.\n *\n * @param {function[]} interceptors - Before/After interceptor list\n * @param {function} fn - Interceptor function\n */\nfunction removeInterceptor(interceptors, fn) {\n  let index = interceptors.indexOf(fn);\n  if (index !== -1) {\n    interceptors.splice(index, 1);\n  }\n}\n\n/**\n * Register a plugin to run a set of functions before or after the Kontra object functions.\n * @function registerPlugin\n *\n * @param {Object} kontraObj - Kontra object to attach the plugin to.\n * @param {Object} pluginObj - Plugin object with before and after intercept functions.\n */\nfunction registerPlugin(kontraObj, pluginObj) {\n  let objectProto = kontraObj.prototype;\n\n  if (!objectProto) return;\n\n  // create interceptor list and functions\n  if (!objectProto._inc) {\n    objectProto._inc = {};\n    objectProto._bInc = function beforePlugins(context, method, ...args) {\n      return this._inc[method].before.reduce((acc, fn) => {\n        let newArgs = fn(context, ...acc);\n        return newArgs ? newArgs : acc;\n      }, args);\n    };\n    objectProto._aInc = function afterPlugins(context, method, result, ...args) {\n      return this._inc[method].after.reduce((acc, fn) => {\n        let newResult = fn(context, acc, ...args);\n        return newResult ? newResult : acc;\n      }, result);\n    };\n  }\n\n  // add plugin to interceptors\n  Object.getOwnPropertyNames(pluginObj).forEach(methodName => {\n    let method = getMethod(methodName);\n\n    if (!objectProto[method]) return;\n\n    // override original method\n    if (!objectProto['_o' + method]) {\n      objectProto['_o' + method] = objectProto[method];\n\n      objectProto[method] = function interceptedFn(...args) {\n\n        // call before interceptors\n        let alteredArgs = this._bInc(this, method, ...args);\n\n        let result = objectProto['_o' + method].call(this, ...alteredArgs);\n\n        // call after interceptors\n        return this._aInc(this, method, result, ...args);\n      };\n    }\n\n    // create interceptors for the method\n    if (!objectProto._inc[method]) {\n      objectProto._inc[method] = {\n        before: [],\n        after: []\n      };\n    }\n\n    if (methodName.startsWith('before')) {\n      objectProto._inc[method].before.push(pluginObj[methodName]);\n    }\n    else if (methodName.startsWith('after')) {\n      objectProto._inc[method].after.push(pluginObj[methodName]);\n    }\n  });\n}\n\n/**\n * Unregister a plugin from a Kontra object.\n * @function unregisterPlugin\n *\n * @param {Object} kontraObj - Kontra object to detach plugin from.\n * @param {Object} pluginObj - The plugin object that was passed during registration.\n */\nfunction unregisterPlugin(kontraObj, pluginObj) {\n  let objectProto = kontraObj.prototype;\n\n  if (!objectProto || !objectProto._inc) return;\n\n  // remove plugin from interceptors\n  Object.getOwnPropertyNames(pluginObj).forEach(methodName => {\n    let method = getMethod(methodName);\n\n    if (methodName.startsWith('before')) {\n      removeInterceptor(objectProto._inc[method].before, pluginObj[methodName]);\n    }\n    else if (methodName.startsWith('after')) {\n      removeInterceptor(objectProto._inc[method].after, pluginObj[methodName]);\n    }\n  });\n}\n\n/**\n * Safely extend the functionality of a Kontra object. Any properties that already exist on the Kontra object will not be added.\n *\n * ```js\n * import { extendObject, Vector } from 'kontra';\n *\n * // add a subtract function to all Vectors\n * extendObject(Vector, {\n *   subtract(vec) {\n *     return Vector(this.x - vec.x, this.y - vec.y);\n *   }\n * });\n * ```\n * @function extendObject\n *\n * @param {Object} kontraObj - Kontra object to extend\n * @param {Object} properties - Properties to add.\n */\nfunction extendObject(kontraObj, properties) {\n  let objectProto = kontraObj.prototype;\n\n  if (!objectProto) return;\n\n  Object.getOwnPropertyNames(properties).forEach(prop => {\n    if (!objectProto[prop]) {\n      objectProto[prop] = properties[prop];\n    }\n  });\n}\n\n/**\n * A fast and memory efficient [object pool](https://gameprogrammingpatterns.com/object-pool.html) for sprite reuse. Perfect for particle systems or SHUMPs. The pool starts out with just one object, but will grow in size to accommodate as many objects as are needed.\n *\n * <canvas width=\"600\" height=\"200\" id=\"pool-example\"></canvas>\n * <script src=\"assets/js/pool.js\"></script>\n * @class Pool\n *\n * @param {Object} properties - Properties of the pool.\n * @param {() => {update: (dt?: number) => void, render: Function, init: (properties?: object) => void, isAlive: () => boolean}} properties.create - Function that returns a new object to be added to the pool when there are no more alive objects.\n * @param {Number} [properties.maxSize=1024] - The maximum number of objects allowed in the pool. The pool will never grow beyond this size.\n */\nclass Pool {\n  /**\n   * @docs docs/api_docs/pool.js\n   */\n\n  constructor({create, maxSize = 1024} = {}) {\n\n    // check for the correct structure of the objects added to pools so we know that the\n    // rest of the pool code will work without errors\n    // @ifdef DEBUG\n    let obj;\n    if (!create ||\n        ( !( obj = create() ) ||\n          !( obj.update && obj.init &&\n             obj.isAlive && obj.render)\n       )) {\n      throw Error('Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions');\n    }\n    // @endif\n\n    // c = create\n    this._c = create;\n\n    /**\n     * All objects currently in the pool, both alive and not alive.\n     * @memberof Pool\n     * @property {Object[]} objects\n     */\n    this.objects = [create()]; // start the pool with an object\n\n    /**\n     * The number of alive objects.\n     * @memberof Pool\n     * @property {Number} size\n     */\n    this.size = 0;\n\n    /**\n     * The maximum number of objects allowed in the pool. The pool will never grow beyond this size.\n     * @memberof Pool\n     * @property {Number} maxSize\n     */\n    this.maxSize = maxSize;\n  }\n\n  /**\n   * Get and return an object from the pool. The properties parameter will be passed directly to the objects `init()` function. If you're using a [Sprite](api/sprite), you should also pass the `ttl` property to designate how many frames you want the object to be alive for.\n   *\n   * If you want to control when the sprite is ready for reuse, pass `Infinity` for `ttl`. You'll need to set the sprites `ttl` to `0` when you're ready for the sprite to be reused.\n   *\n   * ```js\n   * // exclude-tablist\n   * let sprite = pool.get({\n   *   // the object will get these properties and values\n   *   x: 100,\n   *   y: 200,\n   *   width: 20,\n   *   height: 40,\n   *   color: 'red',\n   *\n   *   // pass Infinity for ttl to prevent the object from being reused\n   *   // until you set it back to 0\n   *   ttl: Infinity\n   * });\n   * ```\n   * @memberof Pool\n   * @function get\n   *\n   * @param {Object} [properties] - Properties to pass to the objects `init()` function.\n   *\n   * @returns {Object} The newly initialized object.\n   */\n  get(properties = {}) {\n    // the pool is out of objects if the first object is in use and it can't grow\n    if (this.size === this.objects.length) {\n      if (this.size === this.maxSize) {\n        return;\n      }\n      // double the size of the array by adding twice as many new objects to the end\n      else {\n        for (let i = 0; i < this.size && this.objects.length < this.maxSize; i++) {\n          this.objects.push(this._c());\n        }\n      }\n    }\n\n    // save off first object in pool to reassign to last object after unshift\n    let obj = this.objects[this.size];\n    this.size++;\n    obj.init(properties);\n    return obj;\n  }\n\n  /**\n   * Returns an array of all alive objects. Useful if you need to do special processing on all alive objects outside of the pool, such as to add all alive objects to a [Quadtree](api/quadtree).\n   * @memberof Pool\n   * @function getAliveObjects\n   *\n   * @returns {Object[]} An Array of all alive objects.\n   */\n  getAliveObjects() {\n    return this.objects.slice(0, this.size);\n  }\n\n  /**\n   * Clear the object pool. Removes all objects from the pool and resets its [size](api/pool#size) to 1.\n   * @memberof Pool\n   * @function clear\n   */\n  clear() {\n    this.size = this.objects.length = 0;\n    this.objects.push(this._c());\n  }\n\n  /**\n   * Update all alive objects in the pool by calling the objects `update()` function. This function also manages when each object should be recycled, so it is recommended that you do not call the objects `update()` function outside of this function.\n   * @memberof Pool\n   * @function update\n   *\n   * @param {Number} [dt] - Time since last update.\n   */\n  update(dt) {\n    let obj;\n    let doSort = false;\n    for (let i = this.size; i--; ) {\n      obj = this.objects[i];\n\n      obj.update(dt);\n\n      if (!obj.isAlive()) {\n        doSort = true;\n        this.size--;\n      }\n    }\n    // sort all dead elements to the end of the pool\n    if (doSort) {\n      this.objects.sort((a, b) => b.isAlive() - a.isAlive());\n    }\n  }\n\n  /**\n   * Render all alive objects in the pool by calling the objects `render()` function.\n   * @memberof Pool\n   * @function render\n   */\n  render() {\n    for (let i = this.size; i--; ) {\n      this.objects[i].render();\n    }\n  }\n}\n\nfunction factory$7() {\n  return new Pool(...arguments);\n}\nfactory$7.prototype = Pool.prototype;\nfactory$7.class = Pool;\n\n/**\n * Determine which subnodes the object intersects with\n *\n * @param {Object} object - Object to check.\n * @param {Object} bounds - Bounds of the quadtree.\n *\n * @returns {Number[]} List of all subnodes object intersects.\n */\nfunction getIndices(object, bounds) {\n  let indices = [];\n\n  let verticalMidpoint = bounds.x + bounds.width / 2;\n  let horizontalMidpoint = bounds.y + bounds.height / 2;\n\n  let { x, y, width, height } = getWorldRect(object);\n\n  // save off quadrant checks for reuse\n  let intersectsTopQuadrants = object.y < horizontalMidpoint;\n  let intersectsBottomQuadrants = object.y + object.height >= horizontalMidpoint;\n\n  // object intersects with the left quadrants\n  if (object.x < verticalMidpoint) {\n    if (intersectsTopQuadrants) {  // top left\n      indices.push(0);\n    }\n\n    if (intersectsBottomQuadrants) {  // bottom left\n      indices.push(2);\n    }\n  }\n\n  // object intersects with the right quadrants\n  if (object.x + object.width >= verticalMidpoint) {\n    if (intersectsTopQuadrants) {  // top right\n      indices.push(1);\n    }\n\n    if (intersectsBottomQuadrants) {  // bottom right\n      indices.push(3);\n    }\n  }\n\n  return indices;\n}\n\n/*\nThe quadtree acts like an object pool in that it will create subnodes as objects are needed but it won't clean up the subnodes when it collapses to avoid garbage collection.\n\nThe quadrant indices are numbered as follows (following a z-order curve):\n     |\n  0  |  1\n ----+----\n  2  |  3\n     |\n*/\n\n\n/**\n * A 2D [spatial partitioning](https://gameprogrammingpatterns.com/spatial-partition.html) data structure. Use it to quickly group objects by their position for faster access and collision checking.\n *\n * <canvas width=\"600\" height=\"200\" id=\"quadtree-example\"></canvas>\n * <script src=\"assets/js/quadtree.js\"></script>\n * @class Quadtree\n *\n * @param {Object} [properties] - Properties of the quadtree.\n * @param {Number} [properties.maxDepth=3] - Maximum node depth of the quadtree.\n * @param {Number} [properties.maxObjects=25] - Maximum number of objects a node can have before splitting.\n * @param {{x: Number, y: Number, width: Number, height: Number}} [properties.bounds] - The 2D space (x, y, width, height) the quadtree occupies. Defaults to the entire canvas width and height.\n */\nclass Quadtree {\n  /**\n   * @docs docs/api_docs/quadtree.js\n   */\n\n  constructor({maxDepth = 3, maxObjects = 25, bounds} = {}) {\n\n    /**\n     * Maximum node depth of the quadtree.\n     * @memberof Quadtree\n     * @property {Number} maxDepth\n     */\n    this.maxDepth = maxDepth;\n\n    /**\n     * Maximum number of objects a node can have before splitting.\n     * @memberof Quadtree\n     * @property {Number} maxObjects\n     */\n    this.maxObjects = maxObjects;\n\n    /**\n     * The 2D space (x, y, width, height) the quadtree occupies.\n     * @memberof Quadtree\n     * @property {{x: Number, y: Number, width: Number, height: Number}} bounds\n     */\n    let canvas = getCanvas();\n    this.bounds = bounds || {\n      x: 0,\n      y: 0,\n      width: canvas.width,\n      height: canvas.height\n    };\n\n    // since we won't clean up any subnodes, we need to keep track of which nodes are\n    // currently the leaf node so we know which nodes to add objects to\n    // b = branch, d = depth, o = objects, s = subnodes, p = parent\n    this._b = false;\n    this._d = 0;\n    this._o = [];\n    this._s = [];\n    this._p = null;\n  }\n\n  /**\n   * Removes all objects from the quadtree. You should clear the quadtree every frame before adding all objects back into it.\n   * @memberof Quadtree\n   * @function clear\n   */\n  clear() {\n    this._s.map(function(subnode) {\n      subnode.clear();\n    });\n\n    this._b = false;\n    this._o.length = 0;\n  }\n\n  /**\n   * Get an array of all objects that belong to the same node as the passed in object.\n   *\n   * **Note:** if the passed in object is also part of the quadtree, it will not be returned in the results.\n   *\n   * ```js\n   * import { Sprite, Quadtree } from 'kontra';\n   *\n   * let quadtree = Quadtree();\n   * let player = Sprite({\n   *   // ...\n   * });\n   * let enemy1 = Sprite({\n   *   // ...\n   * });\n   * let enemy2 = Sprite({\n   *   // ...\n   * });\n   *\n   * quadtree.add(player, enemy1, enemy2);\n   * quadtree.get(player);  //=> [enemy1]\n   * ```\n   * @memberof Quadtree\n   * @function get\n   *\n   * @param {{x: Number, y: Number, width: Number, height: Number}} object - Object to use for finding other objects. The object must have the properties `x`, `y`, `width`, and `height` so that its position in the quadtree can be calculated.\n   *\n   * @returns {Object[]} A list of objects in the same node as the object, not including the object itself.\n   */\n  get(object) {\n    // since an object can belong to multiple nodes we should not add it multiple times\n    let objects = new Set();\n\n    // traverse the tree until we get to a leaf node\n    while (this._s.length && this._b) {\n      getIndices(object, this.bounds).map(index => {\n        this._s[index].get(object).map(obj => objects.add(obj));\n      });\n\n      return Array.from(objects);\n    }\n\n    // don't add the object to the return list\n    return this._o.filter(obj => obj !== object);\n  }\n\n  /**\n   * Add objects to the quadtree and group them by their position. Can take a single object, a list of objects, and an array of objects.\n   *\n   * ```js\n   * import { Quadtree, Sprite, Pool, GameLoop } from 'kontra';\n   *\n   * let quadtree = Quadtree();\n   * let bulletPool = Pool({\n   *   create: Sprite\n   * });\n   *\n   * let player = Sprite({\n   *   // ...\n   * });\n   * let enemy = Sprite({\n   *   // ...\n   * });\n   *\n   * // create some bullets\n   * for (let i = 0; i < 100; i++) {\n   *   bulletPool.get({\n   *     // ...\n   *   });\n   * }\n   *\n   * let loop = GameLoop({\n   *   update: function() {\n   *     quadtree.clear();\n   *     quadtree.add(player, enemy, bulletPool.getAliveObjects());\n   *   }\n   * });\n   * ```\n   * @memberof Quadtree\n   * @function add\n   *\n   * @param {...Object[]} objects - Objects to add to the quadtree.\n   */\n  add(...objects) {\n    objects.map(object => {\n      // add a group of objects separately\n      if (Array.isArray(object)) {\n        this.add.apply(this, object);\n        return;\n      }\n\n      // current node has subnodes, so we need to add this object into a subnode\n      if (this._b) {\n        this._a(object);\n        return;\n      }\n\n      // this node is a leaf node so add the object to it\n      this._o.push(object);\n\n      // split the node if there are too many objects\n      if (this._o.length > this.maxObjects && this._d < this.maxDepth) {\n        this._sp();\n\n        // move all objects to their corresponding subnodes\n        this._o.map(obj => this._a(obj));\n        this._o.length = 0;\n      }\n    });\n  }\n\n  /**\n   * Add an object to a subnode.\n   *\n   * @param {Object} object - Object to add into a subnode\n   */\n  _a(object) {\n    // add the object to all subnodes it intersects\n    getIndices(object, this.bounds).map(index => {\n      this._s[index].add(object);\n    });\n  }\n\n  /**\n   * Split the node into four subnodes.\n   */\n  // @see https://github.com/jed/140bytes/wiki/Byte-saving-techniques#use-placeholder-arguments-instead-of-var\n  _sp(subWidth, subHeight, i) {\n    this._b = true;\n\n    // only split if we haven't split before\n    if (this._s.length) {\n      return;\n    }\n\n    subWidth = this.bounds.width / 2 | 0;\n    subHeight = this.bounds.height / 2 | 0;\n\n    for (i = 0; i < 4; i++) {\n      this._s[i] = new Quadtree({\n        bounds: {\n          x: this.bounds.x + (i % 2 === 1 ? subWidth : 0),  // nodes 1 and 3\n          y: this.bounds.y + (i >= 2 ? subHeight : 0),      // nodes 2 and 3\n          width: subWidth,\n          height: subHeight\n        },\n        maxDepth: this.maxDepth,\n        maxObjects: this.maxObjects,\n      });\n\n      // d = depth, p = parent\n      this._s[i]._d = this._d+1;\n      /* @ifdef VISUAL_DEBUG */\n      this._s[i]._p = this;\n      /* @endif */\n    }\n  }\n\n  /**\n   * Draw the quadtree. Useful for visual debugging.\n   */\n   /* @ifdef VISUAL_DEBUG **\n   render() {\n     // don't draw empty leaf nodes, always draw branch nodes and the first node\n     if (this._o.length || this._d === 0 ||\n         (this._p && this._p._b)) {\n\n       context.strokeStyle = 'red';\n       context.strokeRect(this.bounds.x, this.bounds.y, this.bounds.width, this.bounds.height);\n\n       if (this._s.length) {\n         for (let i = 0; i < 4; i++) {\n           this._s[i].render();\n         }\n       }\n     }\n   }\n   /* @endif */\n}\n\nfunction factory$8() {\n  return new Quadtree(...arguments);\n}\nfactory$8.prototype = Quadtree.prototype;\nfactory$8.class = Quadtree;\n\nfunction getAllNodes(object) {\n  let nodes = [];\n\n  if (object._dn) {\n    nodes.push(object._dn);\n  }\n  else if (object.children) {\n    object.children.map(child => {\n      nodes = nodes.concat(getAllNodes(child));\n    });\n  }\n\n  return nodes;\n}\n\n/**\n * A scene object for organizing a group of objects that will update and render together.\n *\n * ```js\n * import { Scene, Sprite } from 'kontra';\n *\n * sprite = Sprite({\n *   x: 100,\n *   y: 200,\n *   width: 20,\n *   height: 40,\n *   color: 'red'\n * });\n *\n * scene = Scene({\n *   id: 'game',\n *   children: [sprite]\n * });\n *\n * scene.render();\n * ```\n *\n * @class Scene\n * @extends GameObject\n *\n * @param {Object} properties - Properties of the scene.\n * @param {String} properties.id - The id of the scene.\n * @param {String} [properties.name=properties.id] - The name of the scene. Used by screen readers to identify each scene. Use this property to give the scene a human friendly name.\n * @param {Boolean} [properties.cullObjects=true] - If the scene should not render objects outside the camera bounds.\n * @param {Function} [properties.cullFunction] - The function used to filter objects to render. Defaults to [helpers.collides](api/helpers#collides).\n * @param {Function} [properties.onShow] - Function called when the scene is shown.\n * @param {Function} [properties.onHide] - Function called when the scene is hidden.\n */\nclass Scene extends factory$2.class {\n\n  init({\n    /**\n     * The id of the scene.\n     * @memberof Scene\n     * @property {String} id\n     */\n    id,\n\n    /**\n     * The name of the scene. Used by screen readers to identify each scene. Use this property to give the scene a human friendly name.\n     * @memberof Scene\n     * @property {String} name\n     */\n     name = id,\n\n    /**\n     * If the camera should cull objects outside the camera bounds. Not rendering objects which can't be seen greatly improves the performance.\n     * @memberof Scene\n     * @property {Boolean} cullObjects\n     */\n    cullObjects = true,\n\n     /**\n     * Camera culling function which prevents objects outside the camera screen from rendering. Is passed as the `filterFunction` to the [render](api/gameObject#render) function.\n     * @memberof Scene\n     * @property {Function} cullFunction\n     */\n    cullFunction = collides,\n\n    ...props\n  }) {\n    // create an accessible DOM node for screen readers (do this first\n    // so we can move DOM nodes in addChild)\n    // dn = dom node\n    const section = this._dn = document.createElement('section');\n    section.tabIndex = -1;\n    section.style = srOnlyStyle;\n    section.id = id;\n    section.setAttribute('aria-label', name);\n\n    super.init({\n      id,\n      name,\n      cullObjects,\n      cullFunction,\n      ...props\n    });\n\n    addToDom(section, this.context.canvas);\n\n    let canvas = this.context.canvas;\n\n    /**\n     * The camera object which is used as the focal point for the scene. The scene will not render objects that are outside the bounds of the camera.\n     *\n     * Additionally, the camera can be used to [lookAt](api/scene#lookAt) an object which will center the camera to that object. This allows you to zoom the scene in and out while the camera remains centered on the object.\n     * @memberof Scene\n     * @property {GameObject} camera\n     */\n    this.camera = factory$2({\n      x: canvas.width / 2,\n      y: canvas.height / 2,\n      width: canvas.width,\n      height: canvas.height,\n      anchor: { x: 0.5, y: 0.5 }\n    });\n\n    // can call super here only by using lexical scope\n    this.camera._pc = () => {\n      super._pc.call(this.camera);\n\n      // only set the cameras position based on scale\n      // but not the width/height\n      let canvas = this.context.canvas;\n      this.camera._wx = this.camera.x * this.scaleX;\n      this.camera._wy = this.camera.y * this.scaleY;\n    };\n  }\n\n  /**\n   * Show the scene and resume update and render. Calls [onShow](api/scene#onShow) if passed.\n   * @memberof Scene\n   * @function show\n   */\n  show() {\n\n    /**\n     * If the scene is hidden.\n     * @memberof Scene\n     * @property {Boolean} hidden\n     */\n    this.hidden = this._dn.hidden = false;\n\n    // find first focusable child\n    let focusableChild = this.children.find(child => child.focus);\n    if (focusableChild) {\n      focusableChild.focus();\n    }\n    else {\n      this._dn.focus();\n    }\n\n    this.onShow();\n  }\n\n  /**\n   * Hide the scene. A hidden scene will not update or render. Calls [onHide](api/scene#onHide) if passed.\n   * @memberof Scene\n   * @function hide\n   */\n  hide() {\n    this.hidden = this._dn.hidden = true;\n    this.onHide();\n  }\n\n  addChild(object, options) {\n    super.addChild(object, options);\n\n    // move all children to be in the scenes DOM node so we can\n    // hide and show the DOM node and thus hide and show all the\n    // children\n    getAllNodes(object).map(node => {\n      this._dn.appendChild(node);\n    });\n  }\n\n  removeChild(object) {\n    super.removeChild(object);\n\n    getAllNodes(object).map(node => {\n      addToDom(node, this.context.canvas);\n    });\n  }\n\n  /**\n   * Clean up the scene and call `destroy()` on all children.\n   * @memberof Scene\n   * @function destroy\n   */\n  destroy() {\n    this._dn.remove();\n    this.children.map(child => child.destroy && child.destroy());\n  }\n\n  update(dt) {\n    if (!this.hidden) {\n      super.update(dt);\n    }\n  }\n\n  /**\n   * Focus the camera to the object or x/y position. As the scene is scaled the focal point will keep to the position.\n   * @memberof Scene\n   * @function lookAt\n   *\n   * @param {{x: number, y: number}} object - Object with x/y properties.\n   */\n  lookAt(object) {\n\n    // don't call getWorldRect so we can ignore the objects anchor\n    object = object.world || object;\n    let x = object.x;\n    let y = object.y;\n\n    if (object.scaleX) {\n      x /= object.scaleX;\n      y /= object.scaleY;\n    }\n\n    this.camera.x = x;\n    this.camera.y = y;\n    this._pc();\n  }\n\n  _pc() {\n    super._pc();\n\n    // this can be called before the camera is initialized so we\n    // need to guard it\n    this.camera && this.camera._pc();\n  }\n\n  render() {\n    let { x, y, width, height } = this.camera;\n\n    this.sx = x * this.scaleX - width / 2;\n    this.sy = y * this.scaleY - height / 2;\n\n    if (!this.hidden) {\n      super.render(child => this.cullObjects ? this.cullFunction(child, this.camera) : true);\n    }\n  }\n\n  /**\n   * Function called when the scene is shown. Override this function to have the scene do something when shown.\n   * @memberof Scene\n   * @function onShow\n   */\n  onShow() {}\n\n  /**\n   * Function called when the scene is hidden. Override this function to have the scene do something when hidden.\n   * @memberof Scene\n   * @function onHide\n   */\n  onHide() {}\n}\n\nfunction factory$9() {\n  return new Scene(...arguments);\n}\nfactory$9.prototype = Scene.prototype;\nfactory$9.class = Scene;\n\n/**\n * Parse a string of consecutive frames.\n *\n * @param {Number|String} frames - Start and end frame.\n *\n * @returns {Number|Number[]} List of frames.\n */\nfunction parseFrames(consecutiveFrames) {\n  // return a single number frame\n  // @see https://github.com/jed/140bytes/wiki/Byte-saving-techniques#coercion-to-test-for-types\n  if (+consecutiveFrames === consecutiveFrames) {\n    return consecutiveFrames;\n  }\n\n  let sequence = [];\n  let frames = consecutiveFrames.split('..');\n\n  // coerce string to number\n  // @see https://github.com/jed/140bytes/wiki/Byte-saving-techniques#coercion-to-test-for-types\n  let start = +frames[0];\n  let end = +frames[1];\n  let i = start;\n\n  // ascending frame order\n  if (start < end) {\n    for (; i <= end; i++) {\n      sequence.push(i);\n    }\n  }\n  // descending order\n  else {\n    for (; i >= end; i--) {\n      sequence.push(i);\n    }\n  }\n\n  return sequence;\n}\n\n/**\n * A sprite sheet to animate a sequence of images. Used to create [animation sprites](api/sprite#animation-sprite).\n *\n * <figure>\n *   <a href=\"assets/imgs/character_walk_sheet.png\">\n *     <img src=\"assets/imgs/character_walk_sheet.png\" width=\"266\" height=\"512\" alt=\"11 frames of a walking pill-like alien wearing a space helmet.\">\n *   </a>\n *   <figcaption>Sprite sheet image courtesy of <a href=\"https://kenney.nl/assets\">Kenney</a>.</figcaption>\n * </figure>\n *\n * Typically you create a sprite sheet just to create animations and then use the animations for your sprite.\n *\n * ```js\n * import { Sprite, SpriteSheet } from 'kontra';\n *\n * let image = new Image();\n * image.src = 'assets/imgs/character_walk_sheet.png';\n * image.onload = function() {\n *   let spriteSheet = SpriteSheet({\n *     image: image,\n *     frameWidth: 72,\n *     frameHeight: 97,\n *     animations: {\n *       // create a named animation: walk\n *       walk: {\n *         frames: '0..9',  // frames 0 through 9\n *         frameRate: 30\n *       }\n *     }\n *   });\n *\n *   let sprite = Sprite({\n *     x: 200,\n *     y: 100,\n *\n *     // use the sprite sheet animations for the sprite\n *     animations: spriteSheet.animations\n *   });\n * };\n * ```\n * @class SpriteSheet\n *\n * @param {Object} properties - Properties of the sprite sheet.\n * @param {HTMLImageElement|HTMLCanvasElement} properties.image - The sprite sheet image.\n * @param {Number} properties.frameWidth - The width of a single frame.\n * @param {Number} properties.frameHeight - The height of a single frame.\n * @param {Number} [properties.frameMargin=0] - The amount of whitespace between each frame.\n * @param {Object} [properties.animations] - Animations to create from the sprite sheet using [Animation](api/animation). Passed directly into the sprite sheets [createAnimations()](api/spriteSheet#createAnimations) function.\n */\nclass SpriteSheet {\n  constructor({image, frameWidth, frameHeight, frameMargin, animations} = {}) {\n    // @ifdef DEBUG\n    if (!image) {\n      throw Error('You must provide an Image for the SpriteSheet');\n    }\n    // @endif\n\n    /**\n     * An object of named [Animation](api/animation) objects. Typically you pass this object into [Sprite](api/sprite) to create an [animation sprites](api/spriteSheet#animation-sprite).\n     * @memberof SpriteSheet\n     * @property {Object} animations\n     */\n    this.animations = {};\n\n    /**\n     * The sprite sheet image.\n     * @memberof SpriteSheet\n     * @property {HTMLImageElement|HTMLCanvasElement} image\n     */\n    this.image = image;\n\n    /**\n     * An object that defines properties of a single frame in the sprite sheet. It has properties of `width`, `height`, and `margin`.\n     *\n     * `width` and `height` are the width of a single frame, while `margin` defines the amount of whitespace between each frame.\n     * @memberof SpriteSheet\n     * @property {Object} frame\n     */\n    this.frame = {\n      width: frameWidth,\n      height: frameHeight,\n      margin: frameMargin\n    };\n\n    // f = framesPerRow\n    this._f = image.width / frameWidth | 0;\n\n    this.createAnimations(animations);\n  }\n\n  /**\n   * Create named animations from the sprite sheet. Called from the constructor if the `animations` argument is passed.\n   *\n   * This function populates the sprite sheets `animations` property with [Animation](api/animation) objects. Each animation is accessible by its name.\n   *\n   * ```js\n   * import { Sprite, SpriteSheet } from 'kontra';\n   *\n   * let image = new Image();\n   * image.src = 'assets/imgs/character_walk_sheet.png';\n   * image.onload = function() {\n   *\n   *   let spriteSheet = SpriteSheet({\n   *     image: image,\n   *     frameWidth: 72,\n   *     frameHeight: 97,\n   *\n   *     // this will also call createAnimations()\n   *     animations: {\n   *       // create 1 animation: idle\n   *       idle: {\n   *         // a single frame\n   *         frames: 1\n   *       }\n   *     }\n   *   });\n   *\n   *   spriteSheet.createAnimations({\n   *     // create 4 animations: jump, walk, moonWalk, attack\n   *     jump: {\n   *       // sequence of frames (can be non-consecutive)\n   *       frames: [1, 10, 1],\n   *       frameRate: 10,\n   *       loop: false,\n   *     },\n   *     walk: {\n   *       // ascending consecutive frame animation (frames 2-6, inclusive)\n   *       frames: '2..6',\n   *       frameRate: 20\n   *     },\n   *     moonWalk: {\n   *       // descending consecutive frame animation (frames 6-2, inclusive)\n   *       frames: '6..2',\n   *       frameRate: 20\n   *     },\n   *     attack: {\n   *       // you can also mix and match, in this case frames [8,9,10,13,10,9,8]\n   *       frames: ['8..10', 13, '10..8'],\n   *       frameRate: 10,\n   *       loop: false,\n   *     }\n   *   });\n   * };\n   * ```\n   * @memberof SpriteSheet\n   * @function createAnimations\n   *\n   * @param {Object} animations - Object of named animations to create from the sprite sheet.\n   * @param {Number|String|Number[]|String[]} animations.<name>.frames - The sequence of frames to use from the sprite sheet. It can either be a single frame (`1`), a sequence of frames (`[1,2,3,4]`), or a consecutive frame notation (`'1..4'`). Sprite sheet frames are `0` indexed.\n   * @param {Number} animations.<name>.frameRate - The number frames to display per second.\n   * @param {Boolean} [animations.<name>.loop=true] - If the animation should loop back to the beginning once completed.\n   */\n  createAnimations(animations) {\n    let sequence, name;\n\n    for (name in animations) {\n      let { frames, frameRate, loop } = animations[name];\n\n      // array that holds the order of the animation\n      sequence = [];\n\n      // @ifdef DEBUG\n      if (frames === undefined) {\n        throw Error('Animation ' + name + ' must provide a frames property');\n      }\n      // @endif\n\n      // add new frames to the end of the array\n      [].concat(frames).map(frame => {\n        sequence = sequence.concat(parseFrames(frame));\n      });\n\n      this.animations[name] = factory({\n        spriteSheet: this,\n        frames: sequence,\n        frameRate,\n        loop\n      });\n    }\n  }\n}\n\nfunction factory$a() {\n  return new SpriteSheet(...arguments);\n}\nfactory$a.prototype = SpriteSheet.prototype;\nfactory$a.class = SpriteSheet;\n\n/**\n * A tile engine for managing and drawing tilesets.\n *\n * <figure>\n *   <a href=\"assets/imgs/mapPack_tilesheet.png\">\n *     <img src=\"assets/imgs/mapPack_tilesheet.png\" width=\"1088\" height=\"768\" alt=\"Tileset to create an overworld map in various seasons.\">\n *   </a>\n *   <figcaption>Tileset image courtesy of <a href=\"https://kenney.nl/assets\">Kenney</a>.</figcaption>\n * </figure>\n * @class TileEngine\n *\n * @param {Object} properties - Properties of the tile engine.\n * @param {Number} properties.width - Width of the tile map (in number of tiles).\n * @param {Number} properties.height - Height of the tile map (in number of tiles).\n * @param {Number} properties.tilewidth - Width of a single tile (in pixels).\n * @param {Number} properties.tileheight - Height of a single tile (in pixels).\n * @param {CanvasRenderingContext2D} [properties.context] - The context the tile engine should draw to. Defaults to [core.getContext()](api/core#getContext)\n *\n * @param {Object[]} properties.tilesets - Array of tileset objects.\n * @param {Number} properties.tilesetN.firstgid - First tile index of the tileset. The first tileset will have a firstgid of 1 as 0 represents an empty tile.\n * @param {String|HTMLImageElement} properties.tilesetN.image - Relative path to the HTMLImageElement or an HTMLImageElement. If passing a relative path, the image file must have been [loaded](api/assets#load) first.\n * @param {Number} [properties.tilesetN.margin=0] - The amount of whitespace between each tile (in pixels).\n * @param {Number} [properties.tilesetN.tilewidth] - Width of the tileset (in pixels). Defaults to properties.tilewidth.\n * @param {Number} [properties.tilesetN.tileheight] - Height of the tileset (in pixels). Defaults to properties.tileheight.\n * @param {String} [properties.tilesetN.source] - Relative path to the source JSON file. The source JSON file must have been [loaded](api/assets#load) first.\n * @param {Number} [properties.tilesetN.columns] - Number of columns in the tileset image.\n *\n * @param {Object[]} properties.layers - Array of layer objects.\n * @param {String} properties.layerN.name - Unique name of the layer.\n * @param {Number[]} properties.layerN.data - 1D array of tile indices.\n * @param {Boolean} [properties.layerN.visible=true] - If the layer should be drawn or not.\n * @param {Number} [properties.layerN.opacity=1] - Percent opacity of the layer.\n */\n\n/**\n * @docs docs/api_docs/tileEngine.js\n */\n\nfunction TileEngine(properties) {\n  let {\n    width,\n    height,\n    tilewidth,\n    tileheight,\n    context = getContext(),\n    tilesets,\n    layers\n  } = properties;\n\n  let mapwidth = width * tilewidth;\n  let mapheight = height * tileheight;\n\n  // create an off-screen canvas for pre-rendering the map\n  // @see http://jsperf.com/render-vs-prerender\n  let offscreenCanvas = document.createElement('canvas');\n  let offscreenContext = offscreenCanvas.getContext('2d');\n  offscreenCanvas.width = mapwidth;\n  offscreenCanvas.height = mapheight;\n\n  // map layer names to data\n  let layerMap = {};\n  let layerCanvases = {};\n\n  // objects added to tile engine to sync with the camera\n  let objects = [];\n\n  /**\n   * The width of tile map (in tiles).\n   * @memberof TileEngine\n   * @property {Number} width\n   */\n\n  /**\n   * The height of tile map (in tiles).\n   * @memberof TileEngine\n   * @property {Number} height\n   */\n\n  /**\n   * The width a tile (in pixels).\n   * @memberof TileEngine\n   * @property {Number} tilewidth\n   */\n\n  /**\n   * The height of a tile (in pixels).\n   * @memberof TileEngine\n   * @property {Number} tileheight\n   */\n\n  /**\n   * Array of all layers of the tile engine.\n   * @memberof TileEngine\n   * @property {Object[]} layers\n   */\n\n  /**\n   * Array of all tilesets of the tile engine.\n   * @memberof TileEngine\n   * @property {Object[]} tilesets\n   */\n\n  let tileEngine = Object.assign({\n\n    /**\n     * The context the tile engine will draw to.\n     * @memberof TileEngine\n     * @property {CanvasRenderingContext2D} context\n     */\n    context: context,\n\n    /**\n     * The width of the tile map (in pixels).\n     * @memberof TileEngine\n     * @property {Number} mapwidth\n     */\n    mapwidth: mapwidth,\n\n    /**\n     * The height of the tile map (in pixels).\n     * @memberof TileEngine\n     * @property {Number} mapheight\n     */\n    mapheight: mapheight,\n    _sx: 0,\n    _sy: 0,\n\n    // d = dirty\n    _d: false,\n\n    /**\n     * X coordinate of the tile map camera.\n     * @memberof TileEngine\n     * @property {Number} sx\n     */\n    get sx() {\n      return this._sx;\n    },\n\n    /**\n     * Y coordinate of the tile map camera.\n     * @memberof TileEngine\n     * @property {Number} sy\n     */\n    get sy() {\n      return this._sy;\n    },\n\n    // when clipping an image, sx and sy must within the image region, otherwise\n    // Firefox and Safari won't draw it.\n    // @see http://stackoverflow.com/questions/19338032/canvas-indexsizeerror-index-or-size-is-negative-or-greater-than-the-allowed-a\n    set sx(value) {\n      this._sx = clamp(0, mapwidth - getCanvas().width, value);\n      objects.forEach(obj => obj.sx = this._sx);\n    },\n\n    set sy(value) {\n      this._sy = clamp(0, mapheight - getCanvas().height, value);\n      objects.forEach(obj => obj.sy = this._sy);\n    },\n\n    /**\n     * Render all visible layers.\n     * @memberof TileEngine\n     * @function render\n     */\n    render() {\n      if (this._d) {\n        this._d = false;\n        this._p();\n      }\n\n      render(offscreenCanvas);\n    },\n\n    /**\n     * Render a specific layer by name.\n     * @memberof TileEngine\n     * @function renderLayer\n     *\n     * @param {String} name - Name of the layer to render.\n     */\n    renderLayer(name) {\n      let canvas = layerCanvases[name];\n      let layer = layerMap[name];\n\n      if (!canvas) {\n        // cache the rendered layer so we can render it again without redrawing\n        // all tiles\n        canvas = document.createElement('canvas');\n        canvas.width = mapwidth;\n        canvas.height = mapheight;\n\n        layerCanvases[name] = canvas;\n        tileEngine._r(layer, canvas.getContext('2d'));\n      }\n\n      if (layer._d) {\n        layer._d = false;\n        canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);\n        tileEngine._r(layer, canvas.getContext('2d'));\n      }\n\n      render(canvas);\n    },\n\n    /**\n     * Check if the object collides with the layer (shares a gird coordinate with any positive tile index in layers data). The object being checked must have the properties `x`, `y`, `width`, and `height` so that its position in the grid can be calculated. [Sprite](api/sprite) defines these properties for you.\n     *\n     * ```js\n     * import { TileEngine, Sprite } from 'kontra';\n     *\n     * let tileEngine = TileEngine({\n     *   tilewidth: 32,\n     *   tileheight: 32,\n     *   width: 4,\n     *   height: 4,\n     *   tilesets: [{\n     *     // ...\n     *   }],\n     *   layers: [{\n     *     name: 'collision',\n     *     data: [ 0,0,0,0,\n     *             0,1,4,0,\n     *             0,2,5,0,\n     *             0,0,0,0 ]\n     *   }]\n     * });\n     *\n     * let sprite = Sprite({\n     *   x: 50,\n     *   y: 20,\n     *   width: 5,\n     *   height: 5\n     * });\n     *\n     * tileEngine.layerCollidesWith('collision', sprite);  //=> false\n     *\n     * sprite.y = 28;\n     *\n     * tileEngine.layerCollidesWith('collision', sprite);  //=> true\n     * ```\n     * @memberof TileEngine\n     * @function layerCollidesWith\n     *\n     * @param {String} name - The name of the layer to check for collision.\n     * @param {Object} object - Object to check collision against.\n     *\n     * @returns {boolean} `true` if the object collides with a tile, `false` otherwise.\n     */\n    layerCollidesWith(name, object) {\n      let { x, y, width, height } = getWorldRect(object);\n\n      let row = getRow(y);\n      let col = getCol(x);\n      let endRow = getRow(y + height);\n      let endCol = getCol(x + width);\n\n      let layer = layerMap[name];\n\n      // check all tiles\n      for (let r = row; r <= endRow; r++) {\n        for (let c = col; c <= endCol; c++) {\n          if (layer.data[c + r * this.width]) {\n            return true;\n          }\n        }\n      }\n\n      return false;\n    },\n\n    /**\n     * Get the tile at the specified layer using either x and y coordinates or row and column coordinates.\n     *\n     * ```js\n     * import { TileEngine } from 'kontra';\n     *\n     * let tileEngine = TileEngine({\n     *   tilewidth: 32,\n     *   tileheight: 32,\n     *   width: 4,\n     *   height: 4,\n     *   tilesets: [{\n     *     // ...\n     *   }],\n     *   layers: [{\n     *     name: 'collision',\n     *     data: [ 0,0,0,0,\n     *             0,1,4,0,\n     *             0,2,5,0,\n     *             0,0,0,0 ]\n     *   }]\n     * });\n     *\n     * tileEngine.tileAtLayer('collision', {x: 50, y: 50});  //=> 1\n     * tileEngine.tileAtLayer('collision', {row: 2, col: 1});  //=> 2\n     * ```\n     * @memberof TileEngine\n     * @function tileAtLayer\n     *\n     * @param {String} name - Name of the layer.\n     * @param {{x: Number, y: Number}|{row: Number, col: Number}} position - Position of the tile in either {x, y} or {row, col} coordinates.\n     *\n     * @returns {Number} The tile index. Will return `-1` if no layer exists by the provided name.\n     */\n    tileAtLayer(name, position) {\n      let row = position.row || getRow(position.y);\n      let col = position.col || getCol(position.x);\n\n      if (layerMap[name]) {\n        return layerMap[name].data[col + row * tileEngine.width];\n      }\n\n      return -1;\n    },\n\n    /**\n     * Set the tile at the specified layer using either x and y coordinates or row and column coordinates.\n     *\n     * ```js\n     * import { TileEngine } from 'kontra';\n     *\n     * let tileEngine = TileEngine({\n     *   tilewidth: 32,\n     *   tileheight: 32,\n     *   width: 4,\n     *   height: 4,\n     *   tilesets: [{\n     *     // ...\n     *   }],\n     *   layers: [{\n     *     name: 'collision',\n     *     data: [ 0,0,0,0,\n     *             0,1,4,0,\n     *             0,2,5,0,\n     *             0,0,0,0 ]\n     *   }]\n     * });\n     *\n     * tileEngine.setTileAtLayer('collision', {row: 2, col: 1}, 10);\n     * tileEngine.tileAtLayer('collision', {row: 2, col: 1});  //=> 10\n     * ```\n     * @memberof TileEngine\n     * @function setTileAtLayer\n     *\n     * @param {String} name - Name of the layer.\n     * @param {{x: Number, y: Number}|{row: Number, col: Number}} position - Position of the tile in either {x, y} or {row, col} coordinates.\n     * @param {Number} tile - Tile index to set.\n     */\n    setTileAtLayer(name, position, tile) {\n      let row = position.row || getRow(position.y);\n      let col = position.col || getCol(position.x);\n\n      if (layerMap[name]) {\n        this._d = true;\n        layerMap[name]._d = true;\n        layerMap[name].data[col + row * tileEngine.width] = tile;\n      }\n    },\n\n    /**\n    *Setthedataatthespecifiedlayer.\n    *\n    *```js\n    *import{TileEngine}from'kontra';\n    *\n    *lettileEngine=TileEngine({\n    *tilewidth:32,\n    *tileheight:32,\n    *width:2,\n    *height:2,\n    *tilesets:[{\n    *//...\n    *}],\n    *layers:[{\n    *name:'collision',\n    *data:[0,1,\n    *2,3]\n    *}]\n    *});\n    *\n    *tileEngine.setLayer('collision',[4,5,6,7]);\n    *tileEngine.tileAtLayer('collision',{row:0,col:0});//=>4\n    *tileEngine.tileAtLayer('collision',{row:0,col:1});//=>5\n    *tileEngine.tileAtLayer('collision',{row:1,col:0});//=>6\n    *tileEngine.tileAtLayer('collision',{row:1,col:1});//=>7\n    *```\n    *\n    *@memberofTileEngine\n    *@functionsetLayer\n    *\n    * @param {String} name - Name of the layer.\n    *@param {Number[]}data-1Darrayoftileindices.\n    */\n    setLayer(name, data) {\n      if (layerMap[name]) {\n        this._d = true;\n        layerMap[name]._d = true;\n        layerMap[name].data = data;\n      }\n    },\n\n    /**\n     * Add an object to the tile engine. The tile engine will set the objects camera position (`sx`, `sy`) to be in sync with the tile engine camera. [Sprite](api/sprite) uses this information to draw the sprite to the correct position on the canvas.\n     * @memberof TileEngine\n     * @function addObject\n     *\n     * @param {Object} object - Object to add to the tile engine.\n     */\n    addObject(object) {\n      objects.push(object);\n      object.sx = this._sx;\n      object.sy = this._sy;\n    },\n\n    /**\n     * Remove an object from the tile engine.\n     * @memberof TileEngine\n     * @function removeObject\n     *\n     * @param {Object} object - Object to remove from the tile engine.\n     */\n    removeObject(object) {\n      let index = objects.indexOf(object);\n      if (index !== -1) {\n        objects.splice(index, 1);\n        object.sx = object.sy = 0;\n      }\n    },\n\n    // expose for testing\n    _r: renderLayer,\n    _p: prerender,\n\n    // @ifdef DEBUG\n    layerCanvases: layerCanvases,\n    layerMap: layerMap\n    // @endif\n  }, properties);\n\n  // resolve linked files (source, image)\n  tileEngine.tilesets.map(tileset => {\n    // get the url of the Tiled JSON object (in this case, the properties object)\n    let url = (window.__k ? window.__k.dm.get(properties) : '') || window.location.href;\n\n    if (tileset.source) {\n      // @ifdef DEBUG\n      if (!window.__k) {\n        throw Error(`You must use \"load\" or \"loadData\" to resolve tileset.source`);\n      }\n      // @endif\n\n      let source = window.__k.d[window.__k.u(tileset.source, url)];\n\n      // @ifdef DEBUG\n      if (!source) {\n        throw Error(`You must load the tileset source \"${tileset.source}\" before loading the tileset`);\n      }\n      // @endif\n\n      Object.keys(source).map(key => {\n        tileset[key] = source[key];\n      });\n    }\n\n    if (''+tileset.image === tileset.image) {\n      // @ifdef DEBUG\n      if (!window.__k) {\n        throw Error(`You must use \"load\" or \"loadImage\" to resolve tileset.image`);\n      }\n      // @endif\n\n      let image = window.__k.i[window.__k.u(tileset.image, url)];\n\n      // @ifdef DEBUG\n      if (!image) {\n        throw Error(`You must load the image \"${tileset.image}\" before loading the tileset`);\n      }\n      // @endif\n\n      tileset.image = image;\n    }\n  });\n\n  /**\n   * Get the row from the y coordinate.\n   * @private\n   *\n   * @param {Number} y - Y coordinate.\n   *\n   * @return {Number}\n   */\n  function getRow(y) {\n    return y / tileEngine.tileheight | 0;\n  }\n\n  /**\n   * Get the col from the x coordinate.\n   * @private\n   *\n   * @param {Number} x - X coordinate.\n   *\n   * @return {Number}\n   */\n  function getCol(x) {\n    return x / tileEngine.tilewidth | 0;\n  }\n\n  /**\n   * Render a layer.\n   * @private\n   *\n   * @param {Object} layer - Layer data.\n   * @param {Context} context - Context to draw layer to.\n   */\n  function renderLayer(layer, context) {\n    context.save();\n    context.globalAlpha = layer.opacity;\n\n    (layer.data || []).map((tile, index) => {\n\n      // skip empty tiles (0)\n      if (!tile) return;\n\n      // find the tileset the tile belongs to\n      // assume tilesets are ordered by firstgid\n      let tileset;\n      for (let i = tileEngine.tilesets.length-1; i >= 0; i--) {\n        tileset = tileEngine.tilesets[i];\n\n        if (tile / tileset.firstgid >= 1) {\n          break;\n        }\n      }\n\n      let tilewidth = tileset.tilewidth || tileEngine.tilewidth;\n      let tileheight = tileset.tileheight || tileEngine.tileheight;\n      let margin = tileset.margin || 0;\n\n      let image = tileset.image;\n\n      let offset = tile - tileset.firstgid;\n      let cols = tileset.columns ||\n        image.width / (tilewidth + margin) | 0;\n\n      let x = (index % tileEngine.width) * tilewidth;\n      let y = (index / tileEngine.width | 0) * tileheight;\n      let sx = (offset % cols) * (tilewidth + margin);\n      let sy = (offset / cols | 0) * (tileheight + margin);\n\n      context.drawImage(\n        image,\n        sx, sy, tilewidth, tileheight,\n        x, y, tilewidth, tileheight\n      );\n    });\n\n    context.restore();\n  }\n\n  /**\n   * Pre-render the tiles to make drawing fast.\n   * @private\n   */\n  function prerender() {\n    if (tileEngine.layers) {\n      tileEngine.layers.map(layer => {\n        layer._d = false;\n        layerMap[layer.name] = layer;\n\n        if (layer.data && layer.visible !== false) {\n          tileEngine._r(layer, offscreenContext);\n        }\n      });\n    }\n  }\n\n  /**\n   * Render a tile engine canvas.\n   * @private\n   *\n   * @param {HTMLCanvasElement} canvas - Tile engine canvas to draw.\n   */\n  function render(canvas) {\n    const { width, height } = getCanvas();\n    const sWidth = Math.min(canvas.width, width);\n    const sHeight = Math.min(canvas.height, height);\n\n    tileEngine.context.drawImage(\n      canvas,\n      tileEngine.sx, tileEngine.sy, sWidth, sHeight,\n      0, 0, sWidth, sHeight\n    );\n  }\n\n  prerender();\n  return tileEngine;\n}\n\nlet kontra = {\n  Animation: factory,\n\n  imageAssets,\n  audioAssets,\n  dataAssets,\n  setImagePath,\n  setAudioPath,\n  setDataPath,\n  loadImage,\n  loadAudio,\n  loadData,\n  load,\n\n  Button: factory$5,\n\n  init,\n  getCanvas,\n  getContext,\n\n  on,\n  off,\n  emit,\n\n  GameLoop,\n  GameObject: factory$2,\n  Grid: factory$6,\n\n  degToRad,\n  radToDeg,\n  angleToTarget,\n  rotatePoint,\n  randInt,\n  seedRand,\n  lerp,\n  inverseLerp,\n  clamp,\n  setStoreItem,\n  getStoreItem,\n  collides,\n  getWorldRect,\n\n  keyMap,\n  initKeys,\n  bindKeys,\n  unbindKeys,\n  keyPressed,\n\n  registerPlugin,\n  unregisterPlugin,\n  extendObject,\n\n  initPointer,\n  getPointer,\n  track,\n  untrack,\n  pointerOver,\n  onPointerDown,\n  onPointerUp,\n  pointerPressed,\n\n  Pool: factory$7,\n  Quadtree: factory$8,\n  Scene: factory$9,\n  Sprite: factory$3,\n  SpriteSheet: factory$a,\n\n  Text: factory$4,\n  TileEngine,\n  Vector: factory$1\n};\n\nexport default kontra;\nexport { factory as Animation, imageAssets, audioAssets, dataAssets, setImagePath, setAudioPath, setDataPath, loadImage, loadAudio, loadData, load, factory$5 as Button, init, getCanvas, getContext, on, off, emit, GameLoop, factory$2 as GameObject, factory$6 as Grid, degToRad, radToDeg, angleToTarget, rotatePoint, randInt, seedRand, lerp, inverseLerp, clamp, setStoreItem, getStoreItem, collides, getWorldRect, keyMap, initKeys, bindKeys, unbindKeys, keyPressed, registerPlugin, unregisterPlugin, extendObject, initPointer, getPointer, track, untrack, pointerOver, onPointerDown, onPointerUp, pointerPressed, factory$7 as Pool, factory$8 as Quadtree, factory$9 as Scene, factory$3 as Sprite, factory$a as SpriteSheet, factory$4 as Text, TileEngine, factory$1 as Vector };\n","import { on as kontraOn, off as kontraOff, emit as kontraEmit } from \"kontra\";\r\n\r\nexport const EV_CONVOSTART = \"ev.convoStart\";\r\nexport const EV_CONVOEND = \"ev.convoEnd\";\r\nexport const EV_CONVONEXT = \"ev.convoNext\";\r\nexport const EV_CONVOCHOICE = \"ev.convoChoice\";\r\nexport const EV_SCENECHANGE = \"ev.sceneChange\";\r\nexport const EV_INTERACTION = \"ev.onInteraction\";\r\nexport const EV_UPDATECONVOTRIGGER = \"ev.onUpdateConvoTrigger\";\r\nexport const EV_GIVEQUEST = \"ev.onGiveQuest\";\r\n\r\nlet registry = {};\r\n\r\nexport const on = (e, fn) => {\r\n  registry[e] = fn;\r\n  kontraOn(e, registry[e]);\r\n};\r\n\r\nexport const off = (e, fn) => kontraOff(e, fn);\r\n\r\nexport const allOff = (ignoreList = []) =>\r\n  Object.keys(registry).map(\r\n    k => !ignoreList.some(str => str === k) && off(k, registry[k])\r\n  );\r\n\r\nexport const emit = (e, args = null) => kontraEmit(e, args);\r\n","import { emit, EV_DEBUGLOG } from \"../common/events\";\r\n\r\nexport const uniqueId = (pre = \"\") =>\r\n  `${pre}${pre.length ? \"_\" : \"\"}` +\r\n  (Number(String(Math.random()).slice(2)) +\r\n    Date.now() +\r\n    Math.round(performance.now())).toString(36);\r\n\r\nexport const between = (v, a, b) => v > a && v < b;\r\n\r\nexport const getNormal = dir => {\r\n  const dirLength = Math.sqrt(dir.x * dir.x + dir.y * dir.y);\r\n\r\n  return {\r\n    x: dir.x !== 0 ? dir.x / dirLength : 0,\r\n    y: dir.y !== 0 ? dir.y / dirLength : 0\r\n  };\r\n};\r\n\r\nexport const vmulti = (vec, v) => {\r\n  let x = 0;\r\n  let y = 0;\r\n  if (typeof v === \"object\") {\r\n    x = vec.x * v.x;\r\n    y = vec.y * v.y;\r\n  } else {\r\n    x = vec.x * v;\r\n    y = vec.y * v;\r\n  }\r\n  return Vector(x, y);\r\n};\r\n\r\nexport const dist = (p1, p2) => {\r\n  const a = p1.x - p2.x;\r\n  const b = p1.y - p2.y;\r\n  return Math.sqrt(a * a + b * b);\r\n};\r\n\r\nexport const sortByDist = (target, items = []) =>\r\n  items.sort((a, b) => dist(target, a.position) - dist(target, b.position));\r\n\r\nexport const circleCollision = (collider, targets, destroyOnHit = false) => {\r\n  if (!collider.radius) {\r\n    console.error(\"Cannot detect collisions without radius property.\");\r\n  }\r\n\r\n  const filtered = targets.filter(target => {\r\n    /* Because why would you ever want to collide with yourself? */\r\n    if (collider.id === target.id) return;\r\n\r\n    const offsets = target.collisionBodyOptions\r\n      ? {\r\n          x: target.collisionBodyOptions.offsetX\r\n            ? target.x + target.collisionBodyOptions.offsetX\r\n            : target.x,\r\n          y: target.collisionBodyOptions.offsetY\r\n            ? target.y + target.collisionBodyOptions.offsetY\r\n            : target.y\r\n        }\r\n      : {\r\n          x: target.x,\r\n          y: target.y\r\n        };\r\n\r\n    let dx = offsets.x - collider.x;\r\n    let dy = offsets.y - collider.y;\r\n\r\n    /* You might be seeing results from two perspectives. I'd ensure that it only comes from\r\n    one in the case of a door. */\r\n    //debug(target.name + \": \" + Math.sqrt(dx * dx + dy * dy))\r\n    if (Math.sqrt(dx * dx + dy * dy) < target.radius + collider.width) {\r\n      target.ttl = destroyOnHit ? 0 : target.ttl;\r\n      return target;\r\n    }\r\n  });\r\n\r\n  return filtered;\r\n};\r\n\r\nexport const getRandomIntInclusive = (min, max) => {\r\n  min = Math.ceil(min);\r\n  max = Math.floor(max);\r\n  return Math.floor(Math.random() * (max - min + 1) + min); //The maximum is inclusive and the minimum is inclusive\r\n};\r\n\r\nexport const Queue = () => {\r\n  let elements = [];\r\n\r\n  return {\r\n    elements: () => elements,\r\n    enqueue: e => elements.push(e),\r\n    dequeue: () => (elements.length > 0 ? elements.shift() : null),\r\n    isEmpty: () => elements.length === 0,\r\n    length: () => elements.length,\r\n    peek: () => (elements.length > 0 ? elements[0] : null)\r\n  };\r\n};\r\n\r\n/*!\r\n * Group items from an array together by some criteria or value.\r\n * (c) 2019 Tom Bremmer (https://tbremer.com/) and Chris Ferdinandi (https://gomakethings.com), MIT License,\r\n * @param  {Array}           arr      The array to group items from\r\n * @param  {String|Function} criteria The criteria to group by\r\n * @return {Object}                   The grouped object\r\n */\r\nexport const groupBy = function(arr, criteria) {\r\n  return arr.reduce(function(obj, item) {\r\n    // Check if the criteria is a function to run on the item or a property of it\r\n    var key = typeof criteria === \"function\" ? criteria(item) : item[criteria];\r\n\r\n    // If the key doesn't exist yet, create it\r\n    if (!obj.hasOwnProperty(key)) {\r\n      obj[key] = [];\r\n    }\r\n\r\n    // Push the value to the object\r\n    obj[key].push(item);\r\n\r\n    // Return the object to the next item in the loop\r\n    return obj;\r\n  }, {});\r\n};\r\n\r\nexport const debug = o => {\r\n  console.info(o);\r\n  emit(EV_DEBUGLOG, o);\r\n};\r\n","export const ENTITY_TYPE = {\r\n  FIXED: 0,\r\n  NPC: 1,\r\n  PICKUP: 2,\r\n  DOOR: 3,\r\n  PLAYER: 99\r\n};","import { dataAssets, setStoreItem, getStoreItem } from \"kontra\";\r\n\r\nconst Store = () => {\r\n  console.info(\"Initialized store.\");\r\n  const worldDataKey = \"assets/gameData/worldData.json\";\r\n  const entityDataKey = \"assets/gameData/entityData.json\";\r\n\r\n  /* NOTE: This brings to light problems with integrity of data and allowing to\r\n  push the same data (such as quests). Keep an eye on it. */\r\n  return {\r\n    resetEntityStates: () => {\r\n      console.log(\"Entity states were reset.\");\r\n      setStoreItem(\"entities\", []);\r\n      setStoreItem(\"quests\", []);\r\n      setStoreItem(\"progressData\", []);\r\n    },\r\n    pushProgress: item => {\r\n      const existing = getStoreItem(\"progressData\");\r\n\r\n      if (!existing) {\r\n        setStoreItem(\"progressData\", [item]);\r\n        return;\r\n      }\r\n\r\n      setStoreItem(\"progressData\", [...existing, item]);\r\n    },\r\n    updateProgress: updated => {\r\n      // TODO: This all might break down if NPC is in multiple places, be careful.\r\n      const progressData = getStoreItem(\"progressData\");\r\n      const entryExists = progressData.some(\r\n        x => x.props.entityId === updated.props.entityId\r\n      );\r\n\r\n      console.log(\"============>\");\r\n      console.log(progressData, updated, entryExists);\r\n\r\n      if (!entryExists) {\r\n        setStoreItem(\"progressData\", [...progressData, updated]);\r\n        return;\r\n      }\r\n\r\n      setStoreItem(\r\n        \"progressData\",\r\n        progressData.map(item => {\r\n          if (item.props.entityId === updated.props.entityId) {\r\n            return {\r\n              ...updated\r\n            };\r\n          }\r\n          return item;\r\n        })\r\n      );\r\n    },\r\n    updateQuestData: d => {\r\n      const currentQuests = getStoreItem(\"quests\");\r\n\r\n      if (!currentQuests) {\r\n        setStoreItem(\"quests\", [d]);\r\n        return;\r\n      }\r\n\r\n      if (currentQuests.find(x => x.id === d.id)) {\r\n        throw new Error(\"You should not push the same quest data twice.\");\r\n      }\r\n\r\n      setStoreItem(\"quests\", [...currentQuests, d]);\r\n    },\r\n    updatePickupData: updatedEntity => {\r\n      const { customProperties, id, type, ttl } = updatedEntity;\r\n      setStoreItem(\"entities\", [\r\n        ...getStoreItem(\"entities\"),\r\n        { worldId: customProperties.worldId, id, type, ttl }\r\n      ]);\r\n    },\r\n    getMapData: mapKey => dataAssets[mapKey],\r\n    getWorldData: () => dataAssets[worldDataKey],\r\n    getEntityData: () => dataAssets[entityDataKey],\r\n    getProgressDataStore: () => getStoreItem(\"progressData\"),\r\n    getEntityDataStore: () => getStoreItem(\"entities\"),\r\n    getQuestDataStore: () => {},\r\n    getAllEntitiesOfType: type => {\r\n      const entityDataStore = getStoreItem(\"entities\");\r\n      return entityDataStore\r\n        ? entityDataStore.filter(ent => ent.type === type)\r\n        : [];\r\n    },\r\n    getEntityFromStore: (id, customQuery = \"id\") => {\r\n      const entityDataStore = getStoreItem(\"entities\");\r\n      console.log(entityDataStore);\r\n      return entityDataStore && entityDataStore.length\r\n        ? entityDataStore.find(e => e[customQuery] === id)\r\n        : null;\r\n    }\r\n  };\r\n};\r\n\r\nexport default Store();\r\n","\"use strict\"\n\nfunction Vnode(tag, key, attrs, children, text, dom) {\n\treturn {tag: tag, key: key, attrs: attrs, children: children, text: text, dom: dom, domSize: undefined, state: undefined, events: undefined, instance: undefined}\n}\nVnode.normalize = function(node) {\n\tif (Array.isArray(node)) return Vnode(\"[\", undefined, undefined, Vnode.normalizeChildren(node), undefined, undefined)\n\tif (node == null || typeof node === \"boolean\") return null\n\tif (typeof node === \"object\") return node\n\treturn Vnode(\"#\", undefined, undefined, String(node), undefined, undefined)\n}\nVnode.normalizeChildren = function(input) {\n\tvar children = []\n\tif (input.length) {\n\t\tvar isKeyed = input[0] != null && input[0].key != null\n\t\t// Note: this is a *very* perf-sensitive check.\n\t\t// Fun fact: merging the loop like this is somehow faster than splitting\n\t\t// it, noticeably so.\n\t\tfor (var i = 1; i < input.length; i++) {\n\t\t\tif ((input[i] != null && input[i].key != null) !== isKeyed) {\n\t\t\t\tthrow new TypeError(\"Vnodes must either always have keys or never have keys!\")\n\t\t\t}\n\t\t}\n\t\tfor (var i = 0; i < input.length; i++) {\n\t\t\tchildren[i] = Vnode.normalize(input[i])\n\t\t}\n\t}\n\treturn children\n}\n\nmodule.exports = Vnode\n","\"use strict\"\n\nvar Vnode = require(\"../render/vnode\")\n\n// Call via `hyperscriptVnode.apply(startOffset, arguments)`\n//\n// The reason I do it this way, forwarding the arguments and passing the start\n// offset in `this`, is so I don't have to create a temporary array in a\n// performance-critical path.\n//\n// In native ES6, I'd instead add a final `...args` parameter to the\n// `hyperscript` and `fragment` factories and define this as\n// `hyperscriptVnode(...args)`, since modern engines do optimize that away. But\n// ES5 (what Mithril requires thanks to IE support) doesn't give me that luxury,\n// and engines aren't nearly intelligent enough to do either of these:\n//\n// 1. Elide the allocation for `[].slice.call(arguments, 1)` when it's passed to\n//    another function only to be indexed.\n// 2. Elide an `arguments` allocation when it's passed to any function other\n//    than `Function.prototype.apply` or `Reflect.apply`.\n//\n// In ES6, it'd probably look closer to this (I'd need to profile it, though):\n// module.exports = function(attrs, ...children) {\n//     if (attrs == null || typeof attrs === \"object\" && attrs.tag == null && !Array.isArray(attrs)) {\n//         if (children.length === 1 && Array.isArray(children[0])) children = children[0]\n//     } else {\n//         children = children.length === 0 && Array.isArray(attrs) ? attrs : [attrs, ...children]\n//         attrs = undefined\n//     }\n//\n//     if (attrs == null) attrs = {}\n//     return Vnode(\"\", attrs.key, attrs, children)\n// }\nmodule.exports = function() {\n\tvar attrs = arguments[this], start = this + 1, children\n\n\tif (attrs == null) {\n\t\tattrs = {}\n\t} else if (typeof attrs !== \"object\" || attrs.tag != null || Array.isArray(attrs)) {\n\t\tattrs = {}\n\t\tstart = this\n\t}\n\n\tif (arguments.length === start + 1) {\n\t\tchildren = arguments[start]\n\t\tif (!Array.isArray(children)) children = [children]\n\t} else {\n\t\tchildren = []\n\t\twhile (start < arguments.length) children.push(arguments[start++])\n\t}\n\n\treturn Vnode(\"\", attrs.key, attrs, children)\n}\n","\"use strict\"\n\nvar Vnode = require(\"../render/vnode\")\nvar hyperscriptVnode = require(\"./hyperscriptVnode\")\n\nvar selectorParser = /(?:(^|#|\\.)([^#\\.\\[\\]]+))|(\\[(.+?)(?:\\s*=\\s*(\"|'|)((?:\\\\[\"'\\]]|.)*?)\\5)?\\])/g\nvar selectorCache = {}\nvar hasOwn = {}.hasOwnProperty\n\nfunction isEmpty(object) {\n\tfor (var key in object) if (hasOwn.call(object, key)) return false\n\treturn true\n}\n\nfunction compileSelector(selector) {\n\tvar match, tag = \"div\", classes = [], attrs = {}\n\twhile (match = selectorParser.exec(selector)) {\n\t\tvar type = match[1], value = match[2]\n\t\tif (type === \"\" && value !== \"\") tag = value\n\t\telse if (type === \"#\") attrs.id = value\n\t\telse if (type === \".\") classes.push(value)\n\t\telse if (match[3][0] === \"[\") {\n\t\t\tvar attrValue = match[6]\n\t\t\tif (attrValue) attrValue = attrValue.replace(/\\\\([\"'])/g, \"$1\").replace(/\\\\\\\\/g, \"\\\\\")\n\t\t\tif (match[4] === \"class\") classes.push(attrValue)\n\t\t\telse attrs[match[4]] = attrValue === \"\" ? attrValue : attrValue || true\n\t\t}\n\t}\n\tif (classes.length > 0) attrs.className = classes.join(\" \")\n\treturn selectorCache[selector] = {tag: tag, attrs: attrs}\n}\n\nfunction execSelector(state, vnode) {\n\tvar attrs = vnode.attrs\n\tvar children = Vnode.normalizeChildren(vnode.children)\n\tvar hasClass = hasOwn.call(attrs, \"class\")\n\tvar className = hasClass ? attrs.class : attrs.className\n\n\tvnode.tag = state.tag\n\tvnode.attrs = null\n\tvnode.children = undefined\n\n\tif (!isEmpty(state.attrs) && !isEmpty(attrs)) {\n\t\tvar newAttrs = {}\n\n\t\tfor (var key in attrs) {\n\t\t\tif (hasOwn.call(attrs, key)) newAttrs[key] = attrs[key]\n\t\t}\n\n\t\tattrs = newAttrs\n\t}\n\n\tfor (var key in state.attrs) {\n\t\tif (hasOwn.call(state.attrs, key) && key !== \"className\" && !hasOwn.call(attrs, key)){\n\t\t\tattrs[key] = state.attrs[key]\n\t\t}\n\t}\n\tif (className != null || state.attrs.className != null) attrs.className =\n\t\tclassName != null\n\t\t\t? state.attrs.className != null\n\t\t\t\t? String(state.attrs.className) + \" \" + String(className)\n\t\t\t\t: className\n\t\t\t: state.attrs.className != null\n\t\t\t\t? state.attrs.className\n\t\t\t\t: null\n\n\tif (hasClass) attrs.class = null\n\n\tfor (var key in attrs) {\n\t\tif (hasOwn.call(attrs, key) && key !== \"key\") {\n\t\t\tvnode.attrs = attrs\n\t\t\tbreak\n\t\t}\n\t}\n\n\tif (Array.isArray(children) && children.length === 1 && children[0] != null && children[0].tag === \"#\") {\n\t\tvnode.text = children[0].children\n\t} else {\n\t\tvnode.children = children\n\t}\n\n\treturn vnode\n}\n\nfunction hyperscript(selector) {\n\tif (selector == null || typeof selector !== \"string\" && typeof selector !== \"function\" && typeof selector.view !== \"function\") {\n\t\tthrow Error(\"The selector must be either a string or a component.\");\n\t}\n\n\tvar vnode = hyperscriptVnode.apply(1, arguments)\n\n\tif (typeof selector === \"string\") {\n\t\tvnode.children = Vnode.normalizeChildren(vnode.children)\n\t\tif (selector !== \"[\") return execSelector(selectorCache[selector] || compileSelector(selector), vnode)\n\t}\n\n\tvnode.tag = selector\n\treturn vnode\n}\n\nmodule.exports = hyperscript\n","\"use strict\"\n\nvar Vnode = require(\"../render/vnode\")\n\nmodule.exports = function(html) {\n\tif (html == null) html = \"\"\n\treturn Vnode(\"<\", undefined, undefined, html, undefined, undefined)\n}\n","\"use strict\"\n\nvar Vnode = require(\"../render/vnode\")\nvar hyperscriptVnode = require(\"./hyperscriptVnode\")\n\nmodule.exports = function() {\n\tvar vnode = hyperscriptVnode.apply(0, arguments)\n\n\tvnode.tag = \"[\"\n\tvnode.children = Vnode.normalizeChildren(vnode.children)\n\treturn vnode\n}\n","\"use strict\"\n\nvar hyperscript = require(\"./render/hyperscript\")\n\nhyperscript.trust = require(\"./render/trust\")\nhyperscript.fragment = require(\"./render/fragment\")\n\nmodule.exports = hyperscript\n","\"use strict\"\n/** @constructor */\nvar PromisePolyfill = function(executor) {\n\tif (!(this instanceof PromisePolyfill)) throw new Error(\"Promise must be called with `new`\")\n\tif (typeof executor !== \"function\") throw new TypeError(\"executor must be a function\")\n\n\tvar self = this, resolvers = [], rejectors = [], resolveCurrent = handler(resolvers, true), rejectCurrent = handler(rejectors, false)\n\tvar instance = self._instance = {resolvers: resolvers, rejectors: rejectors}\n\tvar callAsync = typeof setImmediate === \"function\" ? setImmediate : setTimeout\n\tfunction handler(list, shouldAbsorb) {\n\t\treturn function execute(value) {\n\t\t\tvar then\n\t\t\ttry {\n\t\t\t\tif (shouldAbsorb && value != null && (typeof value === \"object\" || typeof value === \"function\") && typeof (then = value.then) === \"function\") {\n\t\t\t\t\tif (value === self) throw new TypeError(\"Promise can't be resolved w/ itself\")\n\t\t\t\t\texecuteOnce(then.bind(value))\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tcallAsync(function() {\n\t\t\t\t\t\tif (!shouldAbsorb && list.length === 0) console.error(\"Possible unhandled promise rejection:\", value)\n\t\t\t\t\t\tfor (var i = 0; i < list.length; i++) list[i](value)\n\t\t\t\t\t\tresolvers.length = 0, rejectors.length = 0\n\t\t\t\t\t\tinstance.state = shouldAbsorb\n\t\t\t\t\t\tinstance.retry = function() {execute(value)}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\trejectCurrent(e)\n\t\t\t}\n\t\t}\n\t}\n\tfunction executeOnce(then) {\n\t\tvar runs = 0\n\t\tfunction run(fn) {\n\t\t\treturn function(value) {\n\t\t\t\tif (runs++ > 0) return\n\t\t\t\tfn(value)\n\t\t\t}\n\t\t}\n\t\tvar onerror = run(rejectCurrent)\n\t\ttry {then(run(resolveCurrent), onerror)} catch (e) {onerror(e)}\n\t}\n\n\texecuteOnce(executor)\n}\nPromisePolyfill.prototype.then = function(onFulfilled, onRejection) {\n\tvar self = this, instance = self._instance\n\tfunction handle(callback, list, next, state) {\n\t\tlist.push(function(value) {\n\t\t\tif (typeof callback !== \"function\") next(value)\n\t\t\telse try {resolveNext(callback(value))} catch (e) {if (rejectNext) rejectNext(e)}\n\t\t})\n\t\tif (typeof instance.retry === \"function\" && state === instance.state) instance.retry()\n\t}\n\tvar resolveNext, rejectNext\n\tvar promise = new PromisePolyfill(function(resolve, reject) {resolveNext = resolve, rejectNext = reject})\n\thandle(onFulfilled, instance.resolvers, resolveNext, true), handle(onRejection, instance.rejectors, rejectNext, false)\n\treturn promise\n}\nPromisePolyfill.prototype.catch = function(onRejection) {\n\treturn this.then(null, onRejection)\n}\nPromisePolyfill.prototype.finally = function(callback) {\n\treturn this.then(\n\t\tfunction(value) {\n\t\t\treturn PromisePolyfill.resolve(callback()).then(function() {\n\t\t\t\treturn value\n\t\t\t})\n\t\t},\n\t\tfunction(reason) {\n\t\t\treturn PromisePolyfill.resolve(callback()).then(function() {\n\t\t\t\treturn PromisePolyfill.reject(reason);\n\t\t\t})\n\t\t}\n\t)\n}\nPromisePolyfill.resolve = function(value) {\n\tif (value instanceof PromisePolyfill) return value\n\treturn new PromisePolyfill(function(resolve) {resolve(value)})\n}\nPromisePolyfill.reject = function(value) {\n\treturn new PromisePolyfill(function(resolve, reject) {reject(value)})\n}\nPromisePolyfill.all = function(list) {\n\treturn new PromisePolyfill(function(resolve, reject) {\n\t\tvar total = list.length, count = 0, values = []\n\t\tif (list.length === 0) resolve([])\n\t\telse for (var i = 0; i < list.length; i++) {\n\t\t\t(function(i) {\n\t\t\t\tfunction consume(value) {\n\t\t\t\t\tcount++\n\t\t\t\t\tvalues[i] = value\n\t\t\t\t\tif (count === total) resolve(values)\n\t\t\t\t}\n\t\t\t\tif (list[i] != null && (typeof list[i] === \"object\" || typeof list[i] === \"function\") && typeof list[i].then === \"function\") {\n\t\t\t\t\tlist[i].then(consume, reject)\n\t\t\t\t}\n\t\t\t\telse consume(list[i])\n\t\t\t})(i)\n\t\t}\n\t})\n}\nPromisePolyfill.race = function(list) {\n\treturn new PromisePolyfill(function(resolve, reject) {\n\t\tfor (var i = 0; i < list.length; i++) {\n\t\t\tlist[i].then(resolve, reject)\n\t\t}\n\t})\n}\n\nmodule.exports = PromisePolyfill\n","\"use strict\"\n\nvar PromisePolyfill = require(\"./polyfill\")\n\nif (typeof window !== \"undefined\") {\n\tif (typeof window.Promise === \"undefined\") {\n\t\twindow.Promise = PromisePolyfill\n\t} else if (!window.Promise.prototype.finally) {\n\t\twindow.Promise.prototype.finally = PromisePolyfill.prototype.finally\n\t}\n\tmodule.exports = window.Promise\n} else if (typeof global !== \"undefined\") {\n\tif (typeof global.Promise === \"undefined\") {\n\t\tglobal.Promise = PromisePolyfill\n\t} else if (!global.Promise.prototype.finally) {\n\t\tglobal.Promise.prototype.finally = PromisePolyfill.prototype.finally\n\t}\n\tmodule.exports = global.Promise\n} else {\n\tmodule.exports = PromisePolyfill\n}\n","\"use strict\"\n\nvar Vnode = require(\"../render/vnode\")\n\nmodule.exports = function($window) {\n\tvar $doc = $window && $window.document\n\tvar currentRedraw\n\n\tvar nameSpace = {\n\t\tsvg: \"http://www.w3.org/2000/svg\",\n\t\tmath: \"http://www.w3.org/1998/Math/MathML\"\n\t}\n\n\tfunction getNameSpace(vnode) {\n\t\treturn vnode.attrs && vnode.attrs.xmlns || nameSpace[vnode.tag]\n\t}\n\n\t//sanity check to discourage people from doing `vnode.state = ...`\n\tfunction checkState(vnode, original) {\n\t\tif (vnode.state !== original) throw new Error(\"`vnode.state` must not be modified\")\n\t}\n\n\t//Note: the hook is passed as the `this` argument to allow proxying the\n\t//arguments without requiring a full array allocation to do so. It also\n\t//takes advantage of the fact the current `vnode` is the first argument in\n\t//all lifecycle methods.\n\tfunction callHook(vnode) {\n\t\tvar original = vnode.state\n\t\ttry {\n\t\t\treturn this.apply(original, arguments)\n\t\t} finally {\n\t\t\tcheckState(vnode, original)\n\t\t}\n\t}\n\n\t// IE11 (at least) throws an UnspecifiedError when accessing document.activeElement when\n\t// inside an iframe. Catch and swallow this error, and heavy-handidly return null.\n\tfunction activeElement() {\n\t\ttry {\n\t\t\treturn $doc.activeElement\n\t\t} catch (e) {\n\t\t\treturn null\n\t\t}\n\t}\n\t//create\n\tfunction createNodes(parent, vnodes, start, end, hooks, nextSibling, ns) {\n\t\tfor (var i = start; i < end; i++) {\n\t\t\tvar vnode = vnodes[i]\n\t\t\tif (vnode != null) {\n\t\t\t\tcreateNode(parent, vnode, hooks, ns, nextSibling)\n\t\t\t}\n\t\t}\n\t}\n\tfunction createNode(parent, vnode, hooks, ns, nextSibling) {\n\t\tvar tag = vnode.tag\n\t\tif (typeof tag === \"string\") {\n\t\t\tvnode.state = {}\n\t\t\tif (vnode.attrs != null) initLifecycle(vnode.attrs, vnode, hooks)\n\t\t\tswitch (tag) {\n\t\t\t\tcase \"#\": createText(parent, vnode, nextSibling); break\n\t\t\t\tcase \"<\": createHTML(parent, vnode, ns, nextSibling); break\n\t\t\t\tcase \"[\": createFragment(parent, vnode, hooks, ns, nextSibling); break\n\t\t\t\tdefault: createElement(parent, vnode, hooks, ns, nextSibling)\n\t\t\t}\n\t\t}\n\t\telse createComponent(parent, vnode, hooks, ns, nextSibling)\n\t}\n\tfunction createText(parent, vnode, nextSibling) {\n\t\tvnode.dom = $doc.createTextNode(vnode.children)\n\t\tinsertNode(parent, vnode.dom, nextSibling)\n\t}\n\tvar possibleParents = {caption: \"table\", thead: \"table\", tbody: \"table\", tfoot: \"table\", tr: \"tbody\", th: \"tr\", td: \"tr\", colgroup: \"table\", col: \"colgroup\"}\n\tfunction createHTML(parent, vnode, ns, nextSibling) {\n\t\tvar match = vnode.children.match(/^\\s*?<(\\w+)/im) || []\n\t\t// not using the proper parent makes the child element(s) vanish.\n\t\t//     var div = document.createElement(\"div\")\n\t\t//     div.innerHTML = \"<td>i</td><td>j</td>\"\n\t\t//     console.log(div.innerHTML)\n\t\t// --> \"ij\", no <td> in sight.\n\t\tvar temp = $doc.createElement(possibleParents[match[1]] || \"div\")\n\t\tif (ns === \"http://www.w3.org/2000/svg\") {\n\t\t\ttemp.innerHTML = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\">\" + vnode.children + \"</svg>\"\n\t\t\ttemp = temp.firstChild\n\t\t} else {\n\t\t\ttemp.innerHTML = vnode.children\n\t\t}\n\t\tvnode.dom = temp.firstChild\n\t\tvnode.domSize = temp.childNodes.length\n\t\t// Capture nodes to remove, so we don't confuse them.\n\t\tvnode.instance = []\n\t\tvar fragment = $doc.createDocumentFragment()\n\t\tvar child\n\t\twhile (child = temp.firstChild) {\n\t\t\tvnode.instance.push(child)\n\t\t\tfragment.appendChild(child)\n\t\t}\n\t\tinsertNode(parent, fragment, nextSibling)\n\t}\n\tfunction createFragment(parent, vnode, hooks, ns, nextSibling) {\n\t\tvar fragment = $doc.createDocumentFragment()\n\t\tif (vnode.children != null) {\n\t\t\tvar children = vnode.children\n\t\t\tcreateNodes(fragment, children, 0, children.length, hooks, null, ns)\n\t\t}\n\t\tvnode.dom = fragment.firstChild\n\t\tvnode.domSize = fragment.childNodes.length\n\t\tinsertNode(parent, fragment, nextSibling)\n\t}\n\tfunction createElement(parent, vnode, hooks, ns, nextSibling) {\n\t\tvar tag = vnode.tag\n\t\tvar attrs = vnode.attrs\n\t\tvar is = attrs && attrs.is\n\n\t\tns = getNameSpace(vnode) || ns\n\n\t\tvar element = ns ?\n\t\t\tis ? $doc.createElementNS(ns, tag, {is: is}) : $doc.createElementNS(ns, tag) :\n\t\t\tis ? $doc.createElement(tag, {is: is}) : $doc.createElement(tag)\n\t\tvnode.dom = element\n\n\t\tif (attrs != null) {\n\t\t\tsetAttrs(vnode, attrs, ns)\n\t\t}\n\n\t\tinsertNode(parent, element, nextSibling)\n\n\t\tif (!maybeSetContentEditable(vnode)) {\n\t\t\tif (vnode.text != null) {\n\t\t\t\tif (vnode.text !== \"\") element.textContent = vnode.text\n\t\t\t\telse vnode.children = [Vnode(\"#\", undefined, undefined, vnode.text, undefined, undefined)]\n\t\t\t}\n\t\t\tif (vnode.children != null) {\n\t\t\t\tvar children = vnode.children\n\t\t\t\tcreateNodes(element, children, 0, children.length, hooks, null, ns)\n\t\t\t\tif (vnode.tag === \"select\" && attrs != null) setLateSelectAttrs(vnode, attrs)\n\t\t\t}\n\t\t}\n\t}\n\tfunction initComponent(vnode, hooks) {\n\t\tvar sentinel\n\t\tif (typeof vnode.tag.view === \"function\") {\n\t\t\tvnode.state = Object.create(vnode.tag)\n\t\t\tsentinel = vnode.state.view\n\t\t\tif (sentinel.$$reentrantLock$$ != null) return\n\t\t\tsentinel.$$reentrantLock$$ = true\n\t\t} else {\n\t\t\tvnode.state = void 0\n\t\t\tsentinel = vnode.tag\n\t\t\tif (sentinel.$$reentrantLock$$ != null) return\n\t\t\tsentinel.$$reentrantLock$$ = true\n\t\t\tvnode.state = (vnode.tag.prototype != null && typeof vnode.tag.prototype.view === \"function\") ? new vnode.tag(vnode) : vnode.tag(vnode)\n\t\t}\n\t\tinitLifecycle(vnode.state, vnode, hooks)\n\t\tif (vnode.attrs != null) initLifecycle(vnode.attrs, vnode, hooks)\n\t\tvnode.instance = Vnode.normalize(callHook.call(vnode.state.view, vnode))\n\t\tif (vnode.instance === vnode) throw Error(\"A view cannot return the vnode it received as argument\")\n\t\tsentinel.$$reentrantLock$$ = null\n\t}\n\tfunction createComponent(parent, vnode, hooks, ns, nextSibling) {\n\t\tinitComponent(vnode, hooks)\n\t\tif (vnode.instance != null) {\n\t\t\tcreateNode(parent, vnode.instance, hooks, ns, nextSibling)\n\t\t\tvnode.dom = vnode.instance.dom\n\t\t\tvnode.domSize = vnode.dom != null ? vnode.instance.domSize : 0\n\t\t}\n\t\telse {\n\t\t\tvnode.domSize = 0\n\t\t}\n\t}\n\n\t//update\n\t/**\n\t * @param {Element|Fragment} parent - the parent element\n\t * @param {Vnode[] | null} old - the list of vnodes of the last `render()` call for\n\t *                               this part of the tree\n\t * @param {Vnode[] | null} vnodes - as above, but for the current `render()` call.\n\t * @param {Function[]} hooks - an accumulator of post-render hooks (oncreate/onupdate)\n\t * @param {Element | null} nextSibling - the next DOM node if we're dealing with a\n\t *                                       fragment that is not the last item in its\n\t *                                       parent\n\t * @param {'svg' | 'math' | String | null} ns) - the current XML namespace, if any\n\t * @returns void\n\t */\n\t// This function diffs and patches lists of vnodes, both keyed and unkeyed.\n\t//\n\t// We will:\n\t//\n\t// 1. describe its general structure\n\t// 2. focus on the diff algorithm optimizations\n\t// 3. discuss DOM node operations.\n\n\t// ## Overview:\n\t//\n\t// The updateNodes() function:\n\t// - deals with trivial cases\n\t// - determines whether the lists are keyed or unkeyed based on the first non-null node\n\t//   of each list.\n\t// - diffs them and patches the DOM if needed (that's the brunt of the code)\n\t// - manages the leftovers: after diffing, are there:\n\t//   - old nodes left to remove?\n\t// \t - new nodes to insert?\n\t// \t deal with them!\n\t//\n\t// The lists are only iterated over once, with an exception for the nodes in `old` that\n\t// are visited in the fourth part of the diff and in the `removeNodes` loop.\n\n\t// ## Diffing\n\t//\n\t// Reading https://github.com/localvoid/ivi/blob/ddc09d06abaef45248e6133f7040d00d3c6be853/packages/ivi/src/vdom/implementation.ts#L617-L837\n\t// may be good for context on longest increasing subsequence-based logic for moving nodes.\n\t//\n\t// In order to diff keyed lists, one has to\n\t//\n\t// 1) match nodes in both lists, per key, and update them accordingly\n\t// 2) create the nodes present in the new list, but absent in the old one\n\t// 3) remove the nodes present in the old list, but absent in the new one\n\t// 4) figure out what nodes in 1) to move in order to minimize the DOM operations.\n\t//\n\t// To achieve 1) one can create a dictionary of keys => index (for the old list), then iterate\n\t// over the new list and for each new vnode, find the corresponding vnode in the old list using\n\t// the map.\n\t// 2) is achieved in the same step: if a new node has no corresponding entry in the map, it is new\n\t// and must be created.\n\t// For the removals, we actually remove the nodes that have been updated from the old list.\n\t// The nodes that remain in that list after 1) and 2) have been performed can be safely removed.\n\t// The fourth step is a bit more complex and relies on the longest increasing subsequence (LIS)\n\t// algorithm.\n\t//\n\t// the longest increasing subsequence is the list of nodes that can remain in place. Imagine going\n\t// from `1,2,3,4,5` to `4,5,1,2,3` where the numbers are not necessarily the keys, but the indices\n\t// corresponding to the keyed nodes in the old list (keyed nodes `e,d,c,b,a` => `b,a,e,d,c` would\n\t//  match the above lists, for example).\n\t//\n\t// In there are two increasing subsequences: `4,5` and `1,2,3`, the latter being the longest. We\n\t// can update those nodes without moving them, and only call `insertNode` on `4` and `5`.\n\t//\n\t// @localvoid adapted the algo to also support node deletions and insertions (the `lis` is actually\n\t// the longest increasing subsequence *of old nodes still present in the new list*).\n\t//\n\t// It is a general algorithm that is fireproof in all circumstances, but it requires the allocation\n\t// and the construction of a `key => oldIndex` map, and three arrays (one with `newIndex => oldIndex`,\n\t// the `LIS` and a temporary one to create the LIS).\n\t//\n\t// So we cheat where we can: if the tails of the lists are identical, they are guaranteed to be part of\n\t// the LIS and can be updated without moving them.\n\t//\n\t// If two nodes are swapped, they are guaranteed not to be part of the LIS, and must be moved (with\n\t// the exception of the last node if the list is fully reversed).\n\t//\n\t// ## Finding the next sibling.\n\t//\n\t// `updateNode()` and `createNode()` expect a nextSibling parameter to perform DOM operations.\n\t// When the list is being traversed top-down, at any index, the DOM nodes up to the previous\n\t// vnode reflect the content of the new list, whereas the rest of the DOM nodes reflect the old\n\t// list. The next sibling must be looked for in the old list using `getNextSibling(... oldStart + 1 ...)`.\n\t//\n\t// In the other scenarios (swaps, upwards traversal, map-based diff),\n\t// the new vnodes list is traversed upwards. The DOM nodes at the bottom of the list reflect the\n\t// bottom part of the new vnodes list, and we can use the `v.dom`  value of the previous node\n\t// as the next sibling (cached in the `nextSibling` variable).\n\n\n\t// ## DOM node moves\n\t//\n\t// In most scenarios `updateNode()` and `createNode()` perform the DOM operations. However,\n\t// this is not the case if the node moved (second and fourth part of the diff algo). We move\n\t// the old DOM nodes before updateNode runs because it enables us to use the cached `nextSibling`\n\t// variable rather than fetching it using `getNextSibling()`.\n\t//\n\t// The fourth part of the diff currently inserts nodes unconditionally, leading to issues\n\t// like #1791 and #1999. We need to be smarter about those situations where adjascent old\n\t// nodes remain together in the new list in a way that isn't covered by parts one and\n\t// three of the diff algo.\n\n\tfunction updateNodes(parent, old, vnodes, hooks, nextSibling, ns) {\n\t\tif (old === vnodes || old == null && vnodes == null) return\n\t\telse if (old == null || old.length === 0) createNodes(parent, vnodes, 0, vnodes.length, hooks, nextSibling, ns)\n\t\telse if (vnodes == null || vnodes.length === 0) removeNodes(parent, old, 0, old.length)\n\t\telse {\n\t\t\tvar isOldKeyed = old[0] != null && old[0].key != null\n\t\t\tvar isKeyed = vnodes[0] != null && vnodes[0].key != null\n\t\t\tvar start = 0, oldStart = 0\n\t\t\tif (!isOldKeyed) while (oldStart < old.length && old[oldStart] == null) oldStart++\n\t\t\tif (!isKeyed) while (start < vnodes.length && vnodes[start] == null) start++\n\t\t\tif (isKeyed === null && isOldKeyed == null) return // both lists are full of nulls\n\t\t\tif (isOldKeyed !== isKeyed) {\n\t\t\t\tremoveNodes(parent, old, oldStart, old.length)\n\t\t\t\tcreateNodes(parent, vnodes, start, vnodes.length, hooks, nextSibling, ns)\n\t\t\t} else if (!isKeyed) {\n\t\t\t\t// Don't index past the end of either list (causes deopts).\n\t\t\t\tvar commonLength = old.length < vnodes.length ? old.length : vnodes.length\n\t\t\t\t// Rewind if necessary to the first non-null index on either side.\n\t\t\t\t// We could alternatively either explicitly create or remove nodes when `start !== oldStart`\n\t\t\t\t// but that would be optimizing for sparse lists which are more rare than dense ones.\n\t\t\t\tstart = start < oldStart ? start : oldStart\n\t\t\t\tfor (; start < commonLength; start++) {\n\t\t\t\t\to = old[start]\n\t\t\t\t\tv = vnodes[start]\n\t\t\t\t\tif (o === v || o == null && v == null) continue\n\t\t\t\t\telse if (o == null) createNode(parent, v, hooks, ns, getNextSibling(old, start + 1, nextSibling))\n\t\t\t\t\telse if (v == null) removeNode(parent, o)\n\t\t\t\t\telse updateNode(parent, o, v, hooks, getNextSibling(old, start + 1, nextSibling), ns)\n\t\t\t\t}\n\t\t\t\tif (old.length > commonLength) removeNodes(parent, old, start, old.length)\n\t\t\t\tif (vnodes.length > commonLength) createNodes(parent, vnodes, start, vnodes.length, hooks, nextSibling, ns)\n\t\t\t} else {\n\t\t\t\t// keyed diff\n\t\t\t\tvar oldEnd = old.length - 1, end = vnodes.length - 1, map, o, v, oe, ve, topSibling\n\n\t\t\t\t// bottom-up\n\t\t\t\twhile (oldEnd >= oldStart && end >= start) {\n\t\t\t\t\toe = old[oldEnd]\n\t\t\t\t\tve = vnodes[end]\n\t\t\t\t\tif (oe.key !== ve.key) break\n\t\t\t\t\tif (oe !== ve) updateNode(parent, oe, ve, hooks, nextSibling, ns)\n\t\t\t\t\tif (ve.dom != null) nextSibling = ve.dom\n\t\t\t\t\toldEnd--, end--\n\t\t\t\t}\n\t\t\t\t// top-down\n\t\t\t\twhile (oldEnd >= oldStart && end >= start) {\n\t\t\t\t\to = old[oldStart]\n\t\t\t\t\tv = vnodes[start]\n\t\t\t\t\tif (o.key !== v.key) break\n\t\t\t\t\toldStart++, start++\n\t\t\t\t\tif (o !== v) updateNode(parent, o, v, hooks, getNextSibling(old, oldStart, nextSibling), ns)\n\t\t\t\t}\n\t\t\t\t// swaps and list reversals\n\t\t\t\twhile (oldEnd >= oldStart && end >= start) {\n\t\t\t\t\tif (start === end) break\n\t\t\t\t\tif (o.key !== ve.key || oe.key !== v.key) break\n\t\t\t\t\ttopSibling = getNextSibling(old, oldStart, nextSibling)\n\t\t\t\t\tmoveNodes(parent, oe, topSibling)\n\t\t\t\t\tif (oe !== v) updateNode(parent, oe, v, hooks, topSibling, ns)\n\t\t\t\t\tif (++start <= --end) moveNodes(parent, o, nextSibling)\n\t\t\t\t\tif (o !== ve) updateNode(parent, o, ve, hooks, nextSibling, ns)\n\t\t\t\t\tif (ve.dom != null) nextSibling = ve.dom\n\t\t\t\t\toldStart++; oldEnd--\n\t\t\t\t\toe = old[oldEnd]\n\t\t\t\t\tve = vnodes[end]\n\t\t\t\t\to = old[oldStart]\n\t\t\t\t\tv = vnodes[start]\n\t\t\t\t}\n\t\t\t\t// bottom up once again\n\t\t\t\twhile (oldEnd >= oldStart && end >= start) {\n\t\t\t\t\tif (oe.key !== ve.key) break\n\t\t\t\t\tif (oe !== ve) updateNode(parent, oe, ve, hooks, nextSibling, ns)\n\t\t\t\t\tif (ve.dom != null) nextSibling = ve.dom\n\t\t\t\t\toldEnd--, end--\n\t\t\t\t\toe = old[oldEnd]\n\t\t\t\t\tve = vnodes[end]\n\t\t\t\t}\n\t\t\t\tif (start > end) removeNodes(parent, old, oldStart, oldEnd + 1)\n\t\t\t\telse if (oldStart > oldEnd) createNodes(parent, vnodes, start, end + 1, hooks, nextSibling, ns)\n\t\t\t\telse {\n\t\t\t\t\t// inspired by ivi https://github.com/ivijs/ivi/ by Boris Kaul\n\t\t\t\t\tvar originalNextSibling = nextSibling, vnodesLength = end - start + 1, oldIndices = new Array(vnodesLength), li=0, i=0, pos = 2147483647, matched = 0, map, lisIndices\n\t\t\t\t\tfor (i = 0; i < vnodesLength; i++) oldIndices[i] = -1\n\t\t\t\t\tfor (i = end; i >= start; i--) {\n\t\t\t\t\t\tif (map == null) map = getKeyMap(old, oldStart, oldEnd + 1)\n\t\t\t\t\t\tve = vnodes[i]\n\t\t\t\t\t\tvar oldIndex = map[ve.key]\n\t\t\t\t\t\tif (oldIndex != null) {\n\t\t\t\t\t\t\tpos = (oldIndex < pos) ? oldIndex : -1 // becomes -1 if nodes were re-ordered\n\t\t\t\t\t\t\toldIndices[i-start] = oldIndex\n\t\t\t\t\t\t\toe = old[oldIndex]\n\t\t\t\t\t\t\told[oldIndex] = null\n\t\t\t\t\t\t\tif (oe !== ve) updateNode(parent, oe, ve, hooks, nextSibling, ns)\n\t\t\t\t\t\t\tif (ve.dom != null) nextSibling = ve.dom\n\t\t\t\t\t\t\tmatched++\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tnextSibling = originalNextSibling\n\t\t\t\t\tif (matched !== oldEnd - oldStart + 1) removeNodes(parent, old, oldStart, oldEnd + 1)\n\t\t\t\t\tif (matched === 0) createNodes(parent, vnodes, start, end + 1, hooks, nextSibling, ns)\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (pos === -1) {\n\t\t\t\t\t\t\t// the indices of the indices of the items that are part of the\n\t\t\t\t\t\t\t// longest increasing subsequence in the oldIndices list\n\t\t\t\t\t\t\tlisIndices = makeLisIndices(oldIndices)\n\t\t\t\t\t\t\tli = lisIndices.length - 1\n\t\t\t\t\t\t\tfor (i = end; i >= start; i--) {\n\t\t\t\t\t\t\t\tv = vnodes[i]\n\t\t\t\t\t\t\t\tif (oldIndices[i-start] === -1) createNode(parent, v, hooks, ns, nextSibling)\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tif (lisIndices[li] === i - start) li--\n\t\t\t\t\t\t\t\t\telse moveNodes(parent, v, nextSibling)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (v.dom != null) nextSibling = vnodes[i].dom\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tfor (i = end; i >= start; i--) {\n\t\t\t\t\t\t\t\tv = vnodes[i]\n\t\t\t\t\t\t\t\tif (oldIndices[i-start] === -1) createNode(parent, v, hooks, ns, nextSibling)\n\t\t\t\t\t\t\t\tif (v.dom != null) nextSibling = vnodes[i].dom\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfunction updateNode(parent, old, vnode, hooks, nextSibling, ns) {\n\t\tvar oldTag = old.tag, tag = vnode.tag\n\t\tif (oldTag === tag) {\n\t\t\tvnode.state = old.state\n\t\t\tvnode.events = old.events\n\t\t\tif (shouldNotUpdate(vnode, old)) return\n\t\t\tif (typeof oldTag === \"string\") {\n\t\t\t\tif (vnode.attrs != null) {\n\t\t\t\t\tupdateLifecycle(vnode.attrs, vnode, hooks)\n\t\t\t\t}\n\t\t\t\tswitch (oldTag) {\n\t\t\t\t\tcase \"#\": updateText(old, vnode); break\n\t\t\t\t\tcase \"<\": updateHTML(parent, old, vnode, ns, nextSibling); break\n\t\t\t\t\tcase \"[\": updateFragment(parent, old, vnode, hooks, nextSibling, ns); break\n\t\t\t\t\tdefault: updateElement(old, vnode, hooks, ns)\n\t\t\t\t}\n\t\t\t}\n\t\t\telse updateComponent(parent, old, vnode, hooks, nextSibling, ns)\n\t\t}\n\t\telse {\n\t\t\tremoveNode(parent, old)\n\t\t\tcreateNode(parent, vnode, hooks, ns, nextSibling)\n\t\t}\n\t}\n\tfunction updateText(old, vnode) {\n\t\tif (old.children.toString() !== vnode.children.toString()) {\n\t\t\told.dom.nodeValue = vnode.children\n\t\t}\n\t\tvnode.dom = old.dom\n\t}\n\tfunction updateHTML(parent, old, vnode, ns, nextSibling) {\n\t\tif (old.children !== vnode.children) {\n\t\t\tremoveHTML(parent, old)\n\t\t\tcreateHTML(parent, vnode, ns, nextSibling)\n\t\t}\n\t\telse {\n\t\t\tvnode.dom = old.dom\n\t\t\tvnode.domSize = old.domSize\n\t\t\tvnode.instance = old.instance\n\t\t}\n\t}\n\tfunction updateFragment(parent, old, vnode, hooks, nextSibling, ns) {\n\t\tupdateNodes(parent, old.children, vnode.children, hooks, nextSibling, ns)\n\t\tvar domSize = 0, children = vnode.children\n\t\tvnode.dom = null\n\t\tif (children != null) {\n\t\t\tfor (var i = 0; i < children.length; i++) {\n\t\t\t\tvar child = children[i]\n\t\t\t\tif (child != null && child.dom != null) {\n\t\t\t\t\tif (vnode.dom == null) vnode.dom = child.dom\n\t\t\t\t\tdomSize += child.domSize || 1\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (domSize !== 1) vnode.domSize = domSize\n\t\t}\n\t}\n\tfunction updateElement(old, vnode, hooks, ns) {\n\t\tvar element = vnode.dom = old.dom\n\t\tns = getNameSpace(vnode) || ns\n\n\t\tif (vnode.tag === \"textarea\") {\n\t\t\tif (vnode.attrs == null) vnode.attrs = {}\n\t\t\tif (vnode.text != null) {\n\t\t\t\tvnode.attrs.value = vnode.text //FIXME handle multiple children\n\t\t\t\tvnode.text = undefined\n\t\t\t}\n\t\t}\n\t\tupdateAttrs(vnode, old.attrs, vnode.attrs, ns)\n\t\tif (!maybeSetContentEditable(vnode)) {\n\t\t\tif (old.text != null && vnode.text != null && vnode.text !== \"\") {\n\t\t\t\tif (old.text.toString() !== vnode.text.toString()) old.dom.firstChild.nodeValue = vnode.text\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (old.text != null) old.children = [Vnode(\"#\", undefined, undefined, old.text, undefined, old.dom.firstChild)]\n\t\t\t\tif (vnode.text != null) vnode.children = [Vnode(\"#\", undefined, undefined, vnode.text, undefined, undefined)]\n\t\t\t\tupdateNodes(element, old.children, vnode.children, hooks, null, ns)\n\t\t\t}\n\t\t}\n\t}\n\tfunction updateComponent(parent, old, vnode, hooks, nextSibling, ns) {\n\t\tvnode.instance = Vnode.normalize(callHook.call(vnode.state.view, vnode))\n\t\tif (vnode.instance === vnode) throw Error(\"A view cannot return the vnode it received as argument\")\n\t\tupdateLifecycle(vnode.state, vnode, hooks)\n\t\tif (vnode.attrs != null) updateLifecycle(vnode.attrs, vnode, hooks)\n\t\tif (vnode.instance != null) {\n\t\t\tif (old.instance == null) createNode(parent, vnode.instance, hooks, ns, nextSibling)\n\t\t\telse updateNode(parent, old.instance, vnode.instance, hooks, nextSibling, ns)\n\t\t\tvnode.dom = vnode.instance.dom\n\t\t\tvnode.domSize = vnode.instance.domSize\n\t\t}\n\t\telse if (old.instance != null) {\n\t\t\tremoveNode(parent, old.instance)\n\t\t\tvnode.dom = undefined\n\t\t\tvnode.domSize = 0\n\t\t}\n\t\telse {\n\t\t\tvnode.dom = old.dom\n\t\t\tvnode.domSize = old.domSize\n\t\t}\n\t}\n\tfunction getKeyMap(vnodes, start, end) {\n\t\tvar map = Object.create(null)\n\t\tfor (; start < end; start++) {\n\t\t\tvar vnode = vnodes[start]\n\t\t\tif (vnode != null) {\n\t\t\t\tvar key = vnode.key\n\t\t\t\tif (key != null) map[key] = start\n\t\t\t}\n\t\t}\n\t\treturn map\n\t}\n\t// Lifted from ivi https://github.com/ivijs/ivi/\n\t// takes a list of unique numbers (-1 is special and can\n\t// occur multiple times) and returns an array with the indices\n\t// of the items that are part of the longest increasing\n\t// subsequece\n\tvar lisTemp = []\n\tfunction makeLisIndices(a) {\n\t\tvar result = [0]\n\t\tvar u = 0, v = 0, i = 0\n\t\tvar il = lisTemp.length = a.length\n\t\tfor (var i = 0; i < il; i++) lisTemp[i] = a[i]\n\t\tfor (var i = 0; i < il; ++i) {\n\t\t\tif (a[i] === -1) continue\n\t\t\tvar j = result[result.length - 1]\n\t\t\tif (a[j] < a[i]) {\n\t\t\t\tlisTemp[i] = j\n\t\t\t\tresult.push(i)\n\t\t\t\tcontinue\n\t\t\t}\n\t\t\tu = 0\n\t\t\tv = result.length - 1\n\t\t\twhile (u < v) {\n\t\t\t\t// Fast integer average without overflow.\n\t\t\t\t// eslint-disable-next-line no-bitwise\n\t\t\t\tvar c = (u >>> 1) + (v >>> 1) + (u & v & 1)\n\t\t\t\tif (a[result[c]] < a[i]) {\n\t\t\t\t\tu = c + 1\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tv = c\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (a[i] < a[result[u]]) {\n\t\t\t\tif (u > 0) lisTemp[i] = result[u - 1]\n\t\t\t\tresult[u] = i\n\t\t\t}\n\t\t}\n\t\tu = result.length\n\t\tv = result[u - 1]\n\t\twhile (u-- > 0) {\n\t\t\tresult[u] = v\n\t\t\tv = lisTemp[v]\n\t\t}\n\t\tlisTemp.length = 0\n\t\treturn result\n\t}\n\n\tfunction getNextSibling(vnodes, i, nextSibling) {\n\t\tfor (; i < vnodes.length; i++) {\n\t\t\tif (vnodes[i] != null && vnodes[i].dom != null) return vnodes[i].dom\n\t\t}\n\t\treturn nextSibling\n\t}\n\n\t// This covers a really specific edge case:\n\t// - Parent node is keyed and contains child\n\t// - Child is removed, returns unresolved promise in `onbeforeremove`\n\t// - Parent node is moved in keyed diff\n\t// - Remaining children still need moved appropriately\n\t//\n\t// Ideally, I'd track removed nodes as well, but that introduces a lot more\n\t// complexity and I'm not exactly interested in doing that.\n\tfunction moveNodes(parent, vnode, nextSibling) {\n\t\tvar frag = $doc.createDocumentFragment()\n\t\tmoveChildToFrag(parent, frag, vnode)\n\t\tinsertNode(parent, frag, nextSibling)\n\t}\n\tfunction moveChildToFrag(parent, frag, vnode) {\n\t\t// Dodge the recursion overhead in a few of the most common cases.\n\t\twhile (vnode.dom != null && vnode.dom.parentNode === parent) {\n\t\t\tif (typeof vnode.tag !== \"string\") {\n\t\t\t\tvnode = vnode.instance\n\t\t\t\tif (vnode != null) continue\n\t\t\t} else if (vnode.tag === \"<\") {\n\t\t\t\tfor (var i = 0; i < vnode.instance.length; i++) {\n\t\t\t\t\tfrag.appendChild(vnode.instance[i])\n\t\t\t\t}\n\t\t\t} else if (vnode.tag !== \"[\") {\n\t\t\t\t// Don't recurse for text nodes *or* elements, just fragments\n\t\t\t\tfrag.appendChild(vnode.dom)\n\t\t\t} else if (vnode.children.length === 1) {\n\t\t\t\tvnode = vnode.children[0]\n\t\t\t\tif (vnode != null) continue\n\t\t\t} else {\n\t\t\t\tfor (var i = 0; i < vnode.children.length; i++) {\n\t\t\t\t\tvar child = vnode.children[i]\n\t\t\t\t\tif (child != null) moveChildToFrag(parent, frag, child)\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak\n\t\t}\n\t}\n\n\tfunction insertNode(parent, dom, nextSibling) {\n\t\tif (nextSibling != null) parent.insertBefore(dom, nextSibling)\n\t\telse parent.appendChild(dom)\n\t}\n\n\tfunction maybeSetContentEditable(vnode) {\n\t\tif (vnode.attrs == null || (\n\t\t\tvnode.attrs.contenteditable == null && // attribute\n\t\t\tvnode.attrs.contentEditable == null // property\n\t\t)) return false\n\t\tvar children = vnode.children\n\t\tif (children != null && children.length === 1 && children[0].tag === \"<\") {\n\t\t\tvar content = children[0].children\n\t\t\tif (vnode.dom.innerHTML !== content) vnode.dom.innerHTML = content\n\t\t}\n\t\telse if (vnode.text != null || children != null && children.length !== 0) throw new Error(\"Child node of a contenteditable must be trusted\")\n\t\treturn true\n\t}\n\n\t//remove\n\tfunction removeNodes(parent, vnodes, start, end) {\n\t\tfor (var i = start; i < end; i++) {\n\t\t\tvar vnode = vnodes[i]\n\t\t\tif (vnode != null) removeNode(parent, vnode)\n\t\t}\n\t}\n\tfunction removeNode(parent, vnode) {\n\t\tvar mask = 0\n\t\tvar original = vnode.state\n\t\tvar stateResult, attrsResult\n\t\tif (typeof vnode.tag !== \"string\" && typeof vnode.state.onbeforeremove === \"function\") {\n\t\t\tvar result = callHook.call(vnode.state.onbeforeremove, vnode)\n\t\t\tif (result != null && typeof result.then === \"function\") {\n\t\t\t\tmask = 1\n\t\t\t\tstateResult = result\n\t\t\t}\n\t\t}\n\t\tif (vnode.attrs && typeof vnode.attrs.onbeforeremove === \"function\") {\n\t\t\tvar result = callHook.call(vnode.attrs.onbeforeremove, vnode)\n\t\t\tif (result != null && typeof result.then === \"function\") {\n\t\t\t\t// eslint-disable-next-line no-bitwise\n\t\t\t\tmask |= 2\n\t\t\t\tattrsResult = result\n\t\t\t}\n\t\t}\n\t\tcheckState(vnode, original)\n\n\t\t// If we can, try to fast-path it and avoid all the overhead of awaiting\n\t\tif (!mask) {\n\t\t\tonremove(vnode)\n\t\t\tremoveChild(parent, vnode)\n\t\t} else {\n\t\t\tif (stateResult != null) {\n\t\t\t\tvar next = function () {\n\t\t\t\t\t// eslint-disable-next-line no-bitwise\n\t\t\t\t\tif (mask & 1) { mask &= 2; if (!mask) reallyRemove() }\n\t\t\t\t}\n\t\t\t\tstateResult.then(next, next)\n\t\t\t}\n\t\t\tif (attrsResult != null) {\n\t\t\t\tvar next = function () {\n\t\t\t\t\t// eslint-disable-next-line no-bitwise\n\t\t\t\t\tif (mask & 2) { mask &= 1; if (!mask) reallyRemove() }\n\t\t\t\t}\n\t\t\t\tattrsResult.then(next, next)\n\t\t\t}\n\t\t}\n\n\t\tfunction reallyRemove() {\n\t\t\tcheckState(vnode, original)\n\t\t\tonremove(vnode)\n\t\t\tremoveChild(parent, vnode)\n\t\t}\n\t}\n\tfunction removeHTML(parent, vnode) {\n\t\tfor (var i = 0; i < vnode.instance.length; i++) {\n\t\t\tparent.removeChild(vnode.instance[i])\n\t\t}\n\t}\n\tfunction removeChild(parent, vnode) {\n\t\t// Dodge the recursion overhead in a few of the most common cases.\n\t\twhile (vnode.dom != null && vnode.dom.parentNode === parent) {\n\t\t\tif (typeof vnode.tag !== \"string\") {\n\t\t\t\tvnode = vnode.instance\n\t\t\t\tif (vnode != null) continue\n\t\t\t} else if (vnode.tag === \"<\") {\n\t\t\t\tremoveHTML(parent, vnode)\n\t\t\t} else {\n\t\t\t\tif (vnode.tag !== \"[\") {\n\t\t\t\t\tparent.removeChild(vnode.dom)\n\t\t\t\t\tif (!Array.isArray(vnode.children)) break\n\t\t\t\t}\n\t\t\t\tif (vnode.children.length === 1) {\n\t\t\t\t\tvnode = vnode.children[0]\n\t\t\t\t\tif (vnode != null) continue\n\t\t\t\t} else {\n\t\t\t\t\tfor (var i = 0; i < vnode.children.length; i++) {\n\t\t\t\t\t\tvar child = vnode.children[i]\n\t\t\t\t\t\tif (child != null) removeChild(parent, child)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak\n\t\t}\n\t}\n\tfunction onremove(vnode) {\n\t\tif (typeof vnode.tag !== \"string\" && typeof vnode.state.onremove === \"function\") callHook.call(vnode.state.onremove, vnode)\n\t\tif (vnode.attrs && typeof vnode.attrs.onremove === \"function\") callHook.call(vnode.attrs.onremove, vnode)\n\t\tif (typeof vnode.tag !== \"string\") {\n\t\t\tif (vnode.instance != null) onremove(vnode.instance)\n\t\t} else {\n\t\t\tvar children = vnode.children\n\t\t\tif (Array.isArray(children)) {\n\t\t\t\tfor (var i = 0; i < children.length; i++) {\n\t\t\t\t\tvar child = children[i]\n\t\t\t\t\tif (child != null) onremove(child)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t//attrs\n\tfunction setAttrs(vnode, attrs, ns) {\n\t\tfor (var key in attrs) {\n\t\t\tsetAttr(vnode, key, null, attrs[key], ns)\n\t\t}\n\t}\n\tfunction setAttr(vnode, key, old, value, ns) {\n\t\tif (key === \"key\" || key === \"is\" || value == null || isLifecycleMethod(key) || (old === value && !isFormAttribute(vnode, key)) && typeof value !== \"object\") return\n\t\tif (key[0] === \"o\" && key[1] === \"n\") return updateEvent(vnode, key, value)\n\t\tif (key.slice(0, 6) === \"xlink:\") vnode.dom.setAttributeNS(\"http://www.w3.org/1999/xlink\", key.slice(6), value)\n\t\telse if (key === \"style\") updateStyle(vnode.dom, old, value)\n\t\telse if (hasPropertyKey(vnode, key, ns)) {\n\t\t\tif (key === \"value\") {\n\t\t\t\t// Only do the coercion if we're actually going to check the value.\n\t\t\t\t/* eslint-disable no-implicit-coercion */\n\t\t\t\t//setting input[value] to same value by typing on focused element moves cursor to end in Chrome\n\t\t\t\tif ((vnode.tag === \"input\" || vnode.tag === \"textarea\") && vnode.dom.value === \"\" + value && vnode.dom === activeElement()) return\n\t\t\t\t//setting select[value] to same value while having select open blinks select dropdown in Chrome\n\t\t\t\tif (vnode.tag === \"select\" && old !== null && vnode.dom.value === \"\" + value) return\n\t\t\t\t//setting option[value] to same value while having select open blinks select dropdown in Chrome\n\t\t\t\tif (vnode.tag === \"option\" && old !== null && vnode.dom.value === \"\" + value) return\n\t\t\t\t/* eslint-enable no-implicit-coercion */\n\t\t\t}\n\t\t\t// If you assign an input type that is not supported by IE 11 with an assignment expression, an error will occur.\n\t\t\tif (vnode.tag === \"input\" && key === \"type\") vnode.dom.setAttribute(key, value)\n\t\t\telse vnode.dom[key] = value\n\t\t} else {\n\t\t\tif (typeof value === \"boolean\") {\n\t\t\t\tif (value) vnode.dom.setAttribute(key, \"\")\n\t\t\t\telse vnode.dom.removeAttribute(key)\n\t\t\t}\n\t\t\telse vnode.dom.setAttribute(key === \"className\" ? \"class\" : key, value)\n\t\t}\n\t}\n\tfunction removeAttr(vnode, key, old, ns) {\n\t\tif (key === \"key\" || key === \"is\" || old == null || isLifecycleMethod(key)) return\n\t\tif (key[0] === \"o\" && key[1] === \"n\" && !isLifecycleMethod(key)) updateEvent(vnode, key, undefined)\n\t\telse if (key === \"style\") updateStyle(vnode.dom, old, null)\n\t\telse if (\n\t\t\thasPropertyKey(vnode, key, ns)\n\t\t\t&& key !== \"className\"\n\t\t\t&& !(key === \"value\" && (\n\t\t\t\tvnode.tag === \"option\"\n\t\t\t\t|| vnode.tag === \"select\" && vnode.dom.selectedIndex === -1 && vnode.dom === activeElement()\n\t\t\t))\n\t\t\t&& !(vnode.tag === \"input\" && key === \"type\")\n\t\t) {\n\t\t\tvnode.dom[key] = null\n\t\t} else {\n\t\t\tvar nsLastIndex = key.indexOf(\":\")\n\t\t\tif (nsLastIndex !== -1) key = key.slice(nsLastIndex + 1)\n\t\t\tif (old !== false) vnode.dom.removeAttribute(key === \"className\" ? \"class\" : key)\n\t\t}\n\t}\n\tfunction setLateSelectAttrs(vnode, attrs) {\n\t\tif (\"value\" in attrs) {\n\t\t\tif(attrs.value === null) {\n\t\t\t\tif (vnode.dom.selectedIndex !== -1) vnode.dom.value = null\n\t\t\t} else {\n\t\t\t\tvar normalized = \"\" + attrs.value // eslint-disable-line no-implicit-coercion\n\t\t\t\tif (vnode.dom.value !== normalized || vnode.dom.selectedIndex === -1) {\n\t\t\t\t\tvnode.dom.value = normalized\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (\"selectedIndex\" in attrs) setAttr(vnode, \"selectedIndex\", null, attrs.selectedIndex, undefined)\n\t}\n\tfunction updateAttrs(vnode, old, attrs, ns) {\n\t\tif (attrs != null) {\n\t\t\tfor (var key in attrs) {\n\t\t\t\tsetAttr(vnode, key, old && old[key], attrs[key], ns)\n\t\t\t}\n\t\t}\n\t\tvar val\n\t\tif (old != null) {\n\t\t\tfor (var key in old) {\n\t\t\t\tif (((val = old[key]) != null) && (attrs == null || attrs[key] == null)) {\n\t\t\t\t\tremoveAttr(vnode, key, val, ns)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfunction isFormAttribute(vnode, attr) {\n\t\treturn attr === \"value\" || attr === \"checked\" || attr === \"selectedIndex\" || attr === \"selected\" && vnode.dom === activeElement() || vnode.tag === \"option\" && vnode.dom.parentNode === $doc.activeElement\n\t}\n\tfunction isLifecycleMethod(attr) {\n\t\treturn attr === \"oninit\" || attr === \"oncreate\" || attr === \"onupdate\" || attr === \"onremove\" || attr === \"onbeforeremove\" || attr === \"onbeforeupdate\"\n\t}\n\tfunction hasPropertyKey(vnode, key, ns) {\n\t\t// Filter out namespaced keys\n\t\treturn ns === undefined && (\n\t\t\t// If it's a custom element, just keep it.\n\t\t\tvnode.tag.indexOf(\"-\") > -1 || vnode.attrs != null && vnode.attrs.is ||\n\t\t\t// If it's a normal element, let's try to avoid a few browser bugs.\n\t\t\tkey !== \"href\" && key !== \"list\" && key !== \"form\" && key !== \"width\" && key !== \"height\"// && key !== \"type\"\n\t\t\t// Defer the property check until *after* we check everything.\n\t\t) && key in vnode.dom\n\t}\n\n\t//style\n\tvar uppercaseRegex = /[A-Z]/g\n\tfunction toLowerCase(capital) { return \"-\" + capital.toLowerCase() }\n\tfunction normalizeKey(key) {\n\t\treturn key[0] === \"-\" && key[1] === \"-\" ? key :\n\t\t\tkey === \"cssFloat\" ? \"float\" :\n\t\t\t\tkey.replace(uppercaseRegex, toLowerCase)\n\t}\n\tfunction updateStyle(element, old, style) {\n\t\tif (old === style) {\n\t\t\t// Styles are equivalent, do nothing.\n\t\t} else if (style == null) {\n\t\t\t// New style is missing, just clear it.\n\t\t\telement.style.cssText = \"\"\n\t\t} else if (typeof style !== \"object\") {\n\t\t\t// New style is a string, let engine deal with patching.\n\t\t\telement.style.cssText = style\n\t\t} else if (old == null || typeof old !== \"object\") {\n\t\t\t// `old` is missing or a string, `style` is an object.\n\t\t\telement.style.cssText = \"\"\n\t\t\t// Add new style properties\n\t\t\tfor (var key in style) {\n\t\t\t\tvar value = style[key]\n\t\t\t\tif (value != null) element.style.setProperty(normalizeKey(key), String(value))\n\t\t\t}\n\t\t} else {\n\t\t\t// Both old & new are (different) objects.\n\t\t\t// Update style properties that have changed\n\t\t\tfor (var key in style) {\n\t\t\t\tvar value = style[key]\n\t\t\t\tif (value != null && (value = String(value)) !== String(old[key])) {\n\t\t\t\t\telement.style.setProperty(normalizeKey(key), value)\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Remove style properties that no longer exist\n\t\t\tfor (var key in old) {\n\t\t\t\tif (old[key] != null && style[key] == null) {\n\t\t\t\t\telement.style.removeProperty(normalizeKey(key))\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// Here's an explanation of how this works:\n\t// 1. The event names are always (by design) prefixed by `on`.\n\t// 2. The EventListener interface accepts either a function or an object\n\t//    with a `handleEvent` method.\n\t// 3. The object does not inherit from `Object.prototype`, to avoid\n\t//    any potential interference with that (e.g. setters).\n\t// 4. The event name is remapped to the handler before calling it.\n\t// 5. In function-based event handlers, `ev.target === this`. We replicate\n\t//    that below.\n\t// 6. In function-based event handlers, `return false` prevents the default\n\t//    action and stops event propagation. We replicate that below.\n\tfunction EventDict() {\n\t\t// Save this, so the current redraw is correctly tracked.\n\t\tthis._ = currentRedraw\n\t}\n\tEventDict.prototype = Object.create(null)\n\tEventDict.prototype.handleEvent = function (ev) {\n\t\tvar handler = this[\"on\" + ev.type]\n\t\tvar result\n\t\tif (typeof handler === \"function\") result = handler.call(ev.currentTarget, ev)\n\t\telse if (typeof handler.handleEvent === \"function\") handler.handleEvent(ev)\n\t\tif (this._ && ev.redraw !== false) (0, this._)()\n\t\tif (result === false) {\n\t\t\tev.preventDefault()\n\t\t\tev.stopPropagation()\n\t\t}\n\t}\n\n\t//event\n\tfunction updateEvent(vnode, key, value) {\n\t\tif (vnode.events != null) {\n\t\t\tif (vnode.events[key] === value) return\n\t\t\tif (value != null && (typeof value === \"function\" || typeof value === \"object\")) {\n\t\t\t\tif (vnode.events[key] == null) vnode.dom.addEventListener(key.slice(2), vnode.events, false)\n\t\t\t\tvnode.events[key] = value\n\t\t\t} else {\n\t\t\t\tif (vnode.events[key] != null) vnode.dom.removeEventListener(key.slice(2), vnode.events, false)\n\t\t\t\tvnode.events[key] = undefined\n\t\t\t}\n\t\t} else if (value != null && (typeof value === \"function\" || typeof value === \"object\")) {\n\t\t\tvnode.events = new EventDict()\n\t\t\tvnode.dom.addEventListener(key.slice(2), vnode.events, false)\n\t\t\tvnode.events[key] = value\n\t\t}\n\t}\n\n\t//lifecycle\n\tfunction initLifecycle(source, vnode, hooks) {\n\t\tif (typeof source.oninit === \"function\") callHook.call(source.oninit, vnode)\n\t\tif (typeof source.oncreate === \"function\") hooks.push(callHook.bind(source.oncreate, vnode))\n\t}\n\tfunction updateLifecycle(source, vnode, hooks) {\n\t\tif (typeof source.onupdate === \"function\") hooks.push(callHook.bind(source.onupdate, vnode))\n\t}\n\tfunction shouldNotUpdate(vnode, old) {\n\t\tdo {\n\t\t\tif (vnode.attrs != null && typeof vnode.attrs.onbeforeupdate === \"function\") {\n\t\t\t\tvar force = callHook.call(vnode.attrs.onbeforeupdate, vnode, old)\n\t\t\t\tif (force !== undefined && !force) break\n\t\t\t}\n\t\t\tif (typeof vnode.tag !== \"string\" && typeof vnode.state.onbeforeupdate === \"function\") {\n\t\t\t\tvar force = callHook.call(vnode.state.onbeforeupdate, vnode, old)\n\t\t\t\tif (force !== undefined && !force) break\n\t\t\t}\n\t\t\treturn false\n\t\t} while (false); // eslint-disable-line no-constant-condition\n\t\tvnode.dom = old.dom\n\t\tvnode.domSize = old.domSize\n\t\tvnode.instance = old.instance\n\t\t// One would think having the actual latest attributes would be ideal,\n\t\t// but it doesn't let us properly diff based on our current internal\n\t\t// representation. We have to save not only the old DOM info, but also\n\t\t// the attributes used to create it, as we diff *that*, not against the\n\t\t// DOM directly (with a few exceptions in `setAttr`). And, of course, we\n\t\t// need to save the children and text as they are conceptually not\n\t\t// unlike special \"attributes\" internally.\n\t\tvnode.attrs = old.attrs\n\t\tvnode.children = old.children\n\t\tvnode.text = old.text\n\t\treturn true\n\t}\n\n\treturn function(dom, vnodes, redraw) {\n\t\tif (!dom) throw new TypeError(\"Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.\")\n\t\tvar hooks = []\n\t\tvar active = activeElement()\n\t\tvar namespace = dom.namespaceURI\n\n\t\t// First time rendering into a node clears it out\n\t\tif (dom.vnodes == null) dom.textContent = \"\"\n\n\t\tvnodes = Vnode.normalizeChildren(Array.isArray(vnodes) ? vnodes : [vnodes])\n\t\tvar prevRedraw = currentRedraw\n\t\ttry {\n\t\t\tcurrentRedraw = typeof redraw === \"function\" ? redraw : undefined\n\t\t\tupdateNodes(dom, dom.vnodes, vnodes, hooks, null, namespace === \"http://www.w3.org/1999/xhtml\" ? undefined : namespace)\n\t\t} finally {\n\t\t\tcurrentRedraw = prevRedraw\n\t\t}\n\t\tdom.vnodes = vnodes\n\t\t// `document.activeElement` can return null: https://html.spec.whatwg.org/multipage/interaction.html#dom-document-activeelement\n\t\tif (active != null && activeElement() !== active && typeof active.focus === \"function\") active.focus()\n\t\tfor (var i = 0; i < hooks.length; i++) hooks[i]()\n\t}\n}\n","\"use strict\"\n\nmodule.exports = require(\"./render/render\")(window)\n","\"use strict\"\n\nvar Vnode = require(\"../render/vnode\")\n\nmodule.exports = function(render, schedule, console) {\n\tvar subscriptions = []\n\tvar rendering = false\n\tvar pending = false\n\n\tfunction sync() {\n\t\tif (rendering) throw new Error(\"Nested m.redraw.sync() call\")\n\t\trendering = true\n\t\tfor (var i = 0; i < subscriptions.length; i += 2) {\n\t\t\ttry { render(subscriptions[i], Vnode(subscriptions[i + 1]), redraw) }\n\t\t\tcatch (e) { console.error(e) }\n\t\t}\n\t\trendering = false\n\t}\n\n\tfunction redraw() {\n\t\tif (!pending) {\n\t\t\tpending = true\n\t\t\tschedule(function() {\n\t\t\t\tpending = false\n\t\t\t\tsync()\n\t\t\t})\n\t\t}\n\t}\n\n\tredraw.sync = sync\n\n\tfunction mount(root, component) {\n\t\tif (component != null && component.view == null && typeof component !== \"function\") {\n\t\t\tthrow new TypeError(\"m.mount(element, component) expects a component, not a vnode\")\n\t\t}\n\n\t\tvar index = subscriptions.indexOf(root)\n\t\tif (index >= 0) {\n\t\t\tsubscriptions.splice(index, 2)\n\t\t\trender(root, [], redraw)\n\t\t}\n\n\t\tif (component != null) {\n\t\t\tsubscriptions.push(root, component)\n\t\t\trender(root, Vnode(component), redraw)\n\t\t}\n\t}\n\n\treturn {mount: mount, redraw: redraw}\n}\n","\"use strict\"\n\nvar render = require(\"./render\")\n\nmodule.exports = require(\"./api/mount-redraw\")(render, requestAnimationFrame, console)\n","\"use strict\"\n\nmodule.exports = function(object) {\n\tif (Object.prototype.toString.call(object) !== \"[object Object]\") return \"\"\n\n\tvar args = []\n\tfor (var key in object) {\n\t\tdestructure(key, object[key])\n\t}\n\n\treturn args.join(\"&\")\n\n\tfunction destructure(key, value) {\n\t\tif (Array.isArray(value)) {\n\t\t\tfor (var i = 0; i < value.length; i++) {\n\t\t\t\tdestructure(key + \"[\" + i + \"]\", value[i])\n\t\t\t}\n\t\t}\n\t\telse if (Object.prototype.toString.call(value) === \"[object Object]\") {\n\t\t\tfor (var i in value) {\n\t\t\t\tdestructure(key + \"[\" + i + \"]\", value[i])\n\t\t\t}\n\t\t}\n\t\telse args.push(encodeURIComponent(key) + (value != null && value !== \"\" ? \"=\" + encodeURIComponent(value) : \"\"))\n\t}\n}\n","\"use strict\"\n\nmodule.exports = Object.assign || function(target, source) {\n\tif(source) Object.keys(source).forEach(function(key) { target[key] = source[key] })\n}\n","\"use strict\"\n\nvar buildQueryString = require(\"../querystring/build\")\nvar assign = require(\"./assign\")\n\n// Returns `path` from `template` + `params`\nmodule.exports = function(template, params) {\n\tif ((/:([^\\/\\.-]+)(\\.{3})?:/).test(template)) {\n\t\tthrow new SyntaxError(\"Template parameter names *must* be separated\")\n\t}\n\tif (params == null) return template\n\tvar queryIndex = template.indexOf(\"?\")\n\tvar hashIndex = template.indexOf(\"#\")\n\tvar queryEnd = hashIndex < 0 ? template.length : hashIndex\n\tvar pathEnd = queryIndex < 0 ? queryEnd : queryIndex\n\tvar path = template.slice(0, pathEnd)\n\tvar query = {}\n\n\tassign(query, params)\n\n\tvar resolved = path.replace(/:([^\\/\\.-]+)(\\.{3})?/g, function(m, key, variadic) {\n\t\tdelete query[key]\n\t\t// If no such parameter exists, don't interpolate it.\n\t\tif (params[key] == null) return m\n\t\t// Escape normal parameters, but not variadic ones.\n\t\treturn variadic ? params[key] : encodeURIComponent(String(params[key]))\n\t})\n\n\t// In case the template substitution adds new query/hash parameters.\n\tvar newQueryIndex = resolved.indexOf(\"?\")\n\tvar newHashIndex = resolved.indexOf(\"#\")\n\tvar newQueryEnd = newHashIndex < 0 ? resolved.length : newHashIndex\n\tvar newPathEnd = newQueryIndex < 0 ? newQueryEnd : newQueryIndex\n\tvar result = resolved.slice(0, newPathEnd)\n\n\tif (queryIndex >= 0) result += template.slice(queryIndex, queryEnd)\n\tif (newQueryIndex >= 0) result += (queryIndex < 0 ? \"?\" : \"&\") + resolved.slice(newQueryIndex, newQueryEnd)\n\tvar querystring = buildQueryString(query)\n\tif (querystring) result += (queryIndex < 0 && newQueryIndex < 0 ? \"?\" : \"&\") + querystring\n\tif (hashIndex >= 0) result += template.slice(hashIndex)\n\tif (newHashIndex >= 0) result += (hashIndex < 0 ? \"\" : \"&\") + resolved.slice(newHashIndex)\n\treturn result\n}\n","\"use strict\"\n\nvar buildPathname = require(\"../pathname/build\")\n\nmodule.exports = function($window, Promise, oncompletion) {\n\tvar callbackCount = 0\n\n\tfunction PromiseProxy(executor) {\n\t\treturn new Promise(executor)\n\t}\n\n\t// In case the global Promise is some userland library's where they rely on\n\t// `foo instanceof this.constructor`, `this.constructor.resolve(value)`, or\n\t// similar. Let's *not* break them.\n\tPromiseProxy.prototype = Promise.prototype\n\tPromiseProxy.__proto__ = Promise // eslint-disable-line no-proto\n\n\tfunction makeRequest(factory) {\n\t\treturn function(url, args) {\n\t\t\tif (typeof url !== \"string\") { args = url; url = url.url }\n\t\t\telse if (args == null) args = {}\n\t\t\tvar promise = new Promise(function(resolve, reject) {\n\t\t\t\tfactory(buildPathname(url, args.params), args, function (data) {\n\t\t\t\t\tif (typeof args.type === \"function\") {\n\t\t\t\t\t\tif (Array.isArray(data)) {\n\t\t\t\t\t\t\tfor (var i = 0; i < data.length; i++) {\n\t\t\t\t\t\t\t\tdata[i] = new args.type(data[i])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse data = new args.type(data)\n\t\t\t\t\t}\n\t\t\t\t\tresolve(data)\n\t\t\t\t}, reject)\n\t\t\t})\n\t\t\tif (args.background === true) return promise\n\t\t\tvar count = 0\n\t\t\tfunction complete() {\n\t\t\t\tif (--count === 0 && typeof oncompletion === \"function\") oncompletion()\n\t\t\t}\n\n\t\t\treturn wrap(promise)\n\n\t\t\tfunction wrap(promise) {\n\t\t\t\tvar then = promise.then\n\t\t\t\t// Set the constructor, so engines know to not await or resolve\n\t\t\t\t// this as a native promise. At the time of writing, this is\n\t\t\t\t// only necessary for V8, but their behavior is the correct\n\t\t\t\t// behavior per spec. See this spec issue for more details:\n\t\t\t\t// https://github.com/tc39/ecma262/issues/1577. Also, see the\n\t\t\t\t// corresponding comment in `request/tests/test-request.js` for\n\t\t\t\t// a bit more background on the issue at hand.\n\t\t\t\tpromise.constructor = PromiseProxy\n\t\t\t\tpromise.then = function() {\n\t\t\t\t\tcount++\n\t\t\t\t\tvar next = then.apply(promise, arguments)\n\t\t\t\t\tnext.then(complete, function(e) {\n\t\t\t\t\t\tcomplete()\n\t\t\t\t\t\tif (count === 0) throw e\n\t\t\t\t\t})\n\t\t\t\t\treturn wrap(next)\n\t\t\t\t}\n\t\t\t\treturn promise\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction hasHeader(args, name) {\n\t\tfor (var key in args.headers) {\n\t\t\tif ({}.hasOwnProperty.call(args.headers, key) && name.test(key)) return true\n\t\t}\n\t\treturn false\n\t}\n\n\treturn {\n\t\trequest: makeRequest(function(url, args, resolve, reject) {\n\t\t\tvar method = args.method != null ? args.method.toUpperCase() : \"GET\"\n\t\t\tvar body = args.body\n\t\t\tvar assumeJSON = (args.serialize == null || args.serialize === JSON.serialize) && !(body instanceof $window.FormData)\n\t\t\tvar responseType = args.responseType || (typeof args.extract === \"function\" ? \"\" : \"json\")\n\n\t\t\tvar xhr = new $window.XMLHttpRequest(), aborted = false\n\t\t\tvar original = xhr, replacedAbort\n\t\t\tvar abort = xhr.abort\n\n\t\t\txhr.abort = function() {\n\t\t\t\taborted = true\n\t\t\t\tabort.call(this)\n\t\t\t}\n\n\t\t\txhr.open(method, url, args.async !== false, typeof args.user === \"string\" ? args.user : undefined, typeof args.password === \"string\" ? args.password : undefined)\n\n\t\t\tif (assumeJSON && body != null && !hasHeader(args, /^content-type$/i)) {\n\t\t\t\txhr.setRequestHeader(\"Content-Type\", \"application/json; charset=utf-8\")\n\t\t\t}\n\t\t\tif (typeof args.deserialize !== \"function\" && !hasHeader(args, /^accept$/i)) {\n\t\t\t\txhr.setRequestHeader(\"Accept\", \"application/json, text/*\")\n\t\t\t}\n\t\t\tif (args.withCredentials) xhr.withCredentials = args.withCredentials\n\t\t\tif (args.timeout) xhr.timeout = args.timeout\n\t\t\txhr.responseType = responseType\n\n\t\t\tfor (var key in args.headers) {\n\t\t\t\tif ({}.hasOwnProperty.call(args.headers, key)) {\n\t\t\t\t\txhr.setRequestHeader(key, args.headers[key])\n\t\t\t\t}\n\t\t\t}\n\n\t\t\txhr.onreadystatechange = function(ev) {\n\t\t\t\t// Don't throw errors on xhr.abort().\n\t\t\t\tif (aborted) return\n\n\t\t\t\tif (ev.target.readyState === 4) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tvar success = (ev.target.status >= 200 && ev.target.status < 300) || ev.target.status === 304 || (/^file:\\/\\//i).test(url)\n\t\t\t\t\t\t// When the response type isn't \"\" or \"text\",\n\t\t\t\t\t\t// `xhr.responseText` is the wrong thing to use.\n\t\t\t\t\t\t// Browsers do the right thing and throw here, and we\n\t\t\t\t\t\t// should honor that and do the right thing by\n\t\t\t\t\t\t// preferring `xhr.response` where possible/practical.\n\t\t\t\t\t\tvar response = ev.target.response, message\n\n\t\t\t\t\t\tif (responseType === \"json\") {\n\t\t\t\t\t\t\t// For IE and Edge, which don't implement\n\t\t\t\t\t\t\t// `responseType: \"json\"`.\n\t\t\t\t\t\t\tif (!ev.target.responseType && typeof args.extract !== \"function\") response = JSON.parse(ev.target.responseText)\n\t\t\t\t\t\t} else if (!responseType || responseType === \"text\") {\n\t\t\t\t\t\t\t// Only use this default if it's text. If a parsed\n\t\t\t\t\t\t\t// document is needed on old IE and friends (all\n\t\t\t\t\t\t\t// unsupported), the user should use a custom\n\t\t\t\t\t\t\t// `config` instead. They're already using this at\n\t\t\t\t\t\t\t// their own risk.\n\t\t\t\t\t\t\tif (response == null) response = ev.target.responseText\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof args.extract === \"function\") {\n\t\t\t\t\t\t\tresponse = args.extract(ev.target, args)\n\t\t\t\t\t\t\tsuccess = true\n\t\t\t\t\t\t} else if (typeof args.deserialize === \"function\") {\n\t\t\t\t\t\t\tresponse = args.deserialize(response)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (success) resolve(response)\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\ttry { message = ev.target.responseText }\n\t\t\t\t\t\t\tcatch (e) { message = response }\n\t\t\t\t\t\t\tvar error = new Error(message)\n\t\t\t\t\t\t\terror.code = ev.target.status\n\t\t\t\t\t\t\terror.response = response\n\t\t\t\t\t\t\treject(error)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\treject(e)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (typeof args.config === \"function\") {\n\t\t\t\txhr = args.config(xhr, args, url) || xhr\n\n\t\t\t\t// Propagate the `abort` to any replacement XHR as well.\n\t\t\t\tif (xhr !== original) {\n\t\t\t\t\treplacedAbort = xhr.abort\n\t\t\t\t\txhr.abort = function() {\n\t\t\t\t\t\taborted = true\n\t\t\t\t\t\treplacedAbort.call(this)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (body == null) xhr.send()\n\t\t\telse if (typeof args.serialize === \"function\") xhr.send(args.serialize(body))\n\t\t\telse if (body instanceof $window.FormData) xhr.send(body)\n\t\t\telse xhr.send(JSON.stringify(body))\n\t\t}),\n\t\tjsonp: makeRequest(function(url, args, resolve, reject) {\n\t\t\tvar callbackName = args.callbackName || \"_mithril_\" + Math.round(Math.random() * 1e16) + \"_\" + callbackCount++\n\t\t\tvar script = $window.document.createElement(\"script\")\n\t\t\t$window[callbackName] = function(data) {\n\t\t\t\tdelete $window[callbackName]\n\t\t\t\tscript.parentNode.removeChild(script)\n\t\t\t\tresolve(data)\n\t\t\t}\n\t\t\tscript.onerror = function() {\n\t\t\t\tdelete $window[callbackName]\n\t\t\t\tscript.parentNode.removeChild(script)\n\t\t\t\treject(new Error(\"JSONP request failed\"))\n\t\t\t}\n\t\t\tscript.src = url + (url.indexOf(\"?\") < 0 ? \"?\" : \"&\") +\n\t\t\t\tencodeURIComponent(args.callbackKey || \"callback\") + \"=\" +\n\t\t\t\tencodeURIComponent(callbackName)\n\t\t\t$window.document.documentElement.appendChild(script)\n\t\t}),\n\t}\n}\n","\"use strict\"\n\nvar PromisePolyfill = require(\"./promise/promise\")\nvar mountRedraw = require(\"./mount-redraw\")\n\nmodule.exports = require(\"./request/request\")(window, PromisePolyfill, mountRedraw.redraw)\n","\"use strict\"\n\nmodule.exports = function(string) {\n\tif (string === \"\" || string == null) return {}\n\tif (string.charAt(0) === \"?\") string = string.slice(1)\n\n\tvar entries = string.split(\"&\"), counters = {}, data = {}\n\tfor (var i = 0; i < entries.length; i++) {\n\t\tvar entry = entries[i].split(\"=\")\n\t\tvar key = decodeURIComponent(entry[0])\n\t\tvar value = entry.length === 2 ? decodeURIComponent(entry[1]) : \"\"\n\n\t\tif (value === \"true\") value = true\n\t\telse if (value === \"false\") value = false\n\n\t\tvar levels = key.split(/\\]\\[?|\\[/)\n\t\tvar cursor = data\n\t\tif (key.indexOf(\"[\") > -1) levels.pop()\n\t\tfor (var j = 0; j < levels.length; j++) {\n\t\t\tvar level = levels[j], nextLevel = levels[j + 1]\n\t\t\tvar isNumber = nextLevel == \"\" || !isNaN(parseInt(nextLevel, 10))\n\t\t\tif (level === \"\") {\n\t\t\t\tvar key = levels.slice(0, j).join()\n\t\t\t\tif (counters[key] == null) {\n\t\t\t\t\tcounters[key] = Array.isArray(cursor) ? cursor.length : 0\n\t\t\t\t}\n\t\t\t\tlevel = counters[key]++\n\t\t\t}\n\t\t\t// Disallow direct prototype pollution\n\t\t\telse if (level === \"__proto__\") break\n\t\t\tif (j === levels.length - 1) cursor[level] = value\n\t\t\telse {\n\t\t\t\t// Read own properties exclusively to disallow indirect\n\t\t\t\t// prototype pollution\n\t\t\t\tvar desc = Object.getOwnPropertyDescriptor(cursor, level)\n\t\t\t\tif (desc != null) desc = desc.value\n\t\t\t\tif (desc == null) cursor[level] = desc = isNumber ? [] : {}\n\t\t\t\tcursor = desc\n\t\t\t}\n\t\t}\n\t}\n\treturn data\n}\n","\"use strict\"\n\nvar parseQueryString = require(\"../querystring/parse\")\n\n// Returns `{path, params}` from `url`\nmodule.exports = function(url) {\n\tvar queryIndex = url.indexOf(\"?\")\n\tvar hashIndex = url.indexOf(\"#\")\n\tvar queryEnd = hashIndex < 0 ? url.length : hashIndex\n\tvar pathEnd = queryIndex < 0 ? queryEnd : queryIndex\n\tvar path = url.slice(0, pathEnd).replace(/\\/{2,}/g, \"/\")\n\n\tif (!path) path = \"/\"\n\telse {\n\t\tif (path[0] !== \"/\") path = \"/\" + path\n\t\tif (path.length > 1 && path[path.length - 1] === \"/\") path = path.slice(0, -1)\n\t}\n\treturn {\n\t\tpath: path,\n\t\tparams: queryIndex < 0\n\t\t\t? {}\n\t\t\t: parseQueryString(url.slice(queryIndex + 1, queryEnd)),\n\t}\n}\n","\"use strict\"\n\nvar parsePathname = require(\"./parse\")\n\n// Compiles a template into a function that takes a resolved path (without query\n// strings) and returns an object containing the template parameters with their\n// parsed values. This expects the input of the compiled template to be the\n// output of `parsePathname`. Note that it does *not* remove query parameters\n// specified in the template.\nmodule.exports = function(template) {\n\tvar templateData = parsePathname(template)\n\tvar templateKeys = Object.keys(templateData.params)\n\tvar keys = []\n\tvar regexp = new RegExp(\"^\" + templateData.path.replace(\n\t\t// I escape literal text so people can use things like `:file.:ext` or\n\t\t// `:lang-:locale` in routes. This is all merged into one pass so I\n\t\t// don't also accidentally escape `-` and make it harder to detect it to\n\t\t// ban it from template parameters.\n\t\t/:([^\\/.-]+)(\\.{3}|\\.(?!\\.)|-)?|[\\\\^$*+.()|\\[\\]{}]/g,\n\t\tfunction(m, key, extra) {\n\t\t\tif (key == null) return \"\\\\\" + m\n\t\t\tkeys.push({k: key, r: extra === \"...\"})\n\t\t\tif (extra === \"...\") return \"(.*)\"\n\t\t\tif (extra === \".\") return \"([^/]+)\\\\.\"\n\t\t\treturn \"([^/]+)\" + (extra || \"\")\n\t\t}\n\t) + \"$\")\n\treturn function(data) {\n\t\t// First, check the params. Usually, there isn't any, and it's just\n\t\t// checking a static set.\n\t\tfor (var i = 0; i < templateKeys.length; i++) {\n\t\t\tif (templateData.params[templateKeys[i]] !== data.params[templateKeys[i]]) return false\n\t\t}\n\t\t// If no interpolations exist, let's skip all the ceremony\n\t\tif (!keys.length) return regexp.test(data.path)\n\t\tvar values = regexp.exec(data.path)\n\t\tif (values == null) return false\n\t\tfor (var i = 0; i < keys.length; i++) {\n\t\t\tdata.params[keys[i].k] = keys[i].r ? values[i + 1] : decodeURIComponent(values[i + 1])\n\t\t}\n\t\treturn true\n\t}\n}\n","\"use strict\"\n\nvar Vnode = require(\"../render/vnode\")\nvar m = require(\"../render/hyperscript\")\nvar Promise = require(\"../promise/promise\")\n\nvar buildPathname = require(\"../pathname/build\")\nvar parsePathname = require(\"../pathname/parse\")\nvar compileTemplate = require(\"../pathname/compileTemplate\")\nvar assign = require(\"../pathname/assign\")\n\nvar sentinel = {}\n\nmodule.exports = function($window, mountRedraw) {\n\tvar fireAsync\n\n\tfunction setPath(path, data, options) {\n\t\tpath = buildPathname(path, data)\n\t\tif (fireAsync != null) {\n\t\t\tfireAsync()\n\t\t\tvar state = options ? options.state : null\n\t\t\tvar title = options ? options.title : null\n\t\t\tif (options && options.replace) $window.history.replaceState(state, title, route.prefix + path)\n\t\t\telse $window.history.pushState(state, title, route.prefix + path)\n\t\t}\n\t\telse {\n\t\t\t$window.location.href = route.prefix + path\n\t\t}\n\t}\n\n\tvar currentResolver = sentinel, component, attrs, currentPath, lastUpdate\n\n\tvar SKIP = route.SKIP = {}\n\n\tfunction route(root, defaultRoute, routes) {\n\t\tif (root == null) throw new Error(\"Ensure the DOM element that was passed to `m.route` is not undefined\")\n\t\t// 0 = start\n\t\t// 1 = init\n\t\t// 2 = ready\n\t\tvar state = 0\n\n\t\tvar compiled = Object.keys(routes).map(function(route) {\n\t\t\tif (route[0] !== \"/\") throw new SyntaxError(\"Routes must start with a `/`\")\n\t\t\tif ((/:([^\\/\\.-]+)(\\.{3})?:/).test(route)) {\n\t\t\t\tthrow new SyntaxError(\"Route parameter names must be separated with either `/`, `.`, or `-`\")\n\t\t\t}\n\t\t\treturn {\n\t\t\t\troute: route,\n\t\t\t\tcomponent: routes[route],\n\t\t\t\tcheck: compileTemplate(route),\n\t\t\t}\n\t\t})\n\t\tvar callAsync = typeof setImmediate === \"function\" ? setImmediate : setTimeout\n\t\tvar p = Promise.resolve()\n\t\tvar scheduled = false\n\t\tvar onremove\n\n\t\tfireAsync = null\n\n\t\tif (defaultRoute != null) {\n\t\t\tvar defaultData = parsePathname(defaultRoute)\n\n\t\t\tif (!compiled.some(function (i) { return i.check(defaultData) })) {\n\t\t\t\tthrow new ReferenceError(\"Default route doesn't match any known routes\")\n\t\t\t}\n\t\t}\n\n\t\tfunction resolveRoute() {\n\t\t\tscheduled = false\n\t\t\t// Consider the pathname holistically. The prefix might even be invalid,\n\t\t\t// but that's not our problem.\n\t\t\tvar prefix = $window.location.hash\n\t\t\tif (route.prefix[0] !== \"#\") {\n\t\t\t\tprefix = $window.location.search + prefix\n\t\t\t\tif (route.prefix[0] !== \"?\") {\n\t\t\t\t\tprefix = $window.location.pathname + prefix\n\t\t\t\t\tif (prefix[0] !== \"/\") prefix = \"/\" + prefix\n\t\t\t\t}\n\t\t\t}\n\t\t\t// This seemingly useless `.concat()` speeds up the tests quite a bit,\n\t\t\t// since the representation is consistently a relatively poorly\n\t\t\t// optimized cons string.\n\t\t\tvar path = prefix.concat()\n\t\t\t\t.replace(/(?:%[a-f89][a-f0-9])+/gim, decodeURIComponent)\n\t\t\t\t.slice(route.prefix.length)\n\t\t\tvar data = parsePathname(path)\n\n\t\t\tassign(data.params, $window.history.state)\n\n\t\t\tfunction fail() {\n\t\t\t\tif (path === defaultRoute) throw new Error(\"Could not resolve default route \" + defaultRoute)\n\t\t\t\tsetPath(defaultRoute, null, {replace: true})\n\t\t\t}\n\n\t\t\tloop(0)\n\t\t\tfunction loop(i) {\n\t\t\t\t// 0 = init\n\t\t\t\t// 1 = scheduled\n\t\t\t\t// 2 = done\n\t\t\t\tfor (; i < compiled.length; i++) {\n\t\t\t\t\tif (compiled[i].check(data)) {\n\t\t\t\t\t\tvar payload = compiled[i].component\n\t\t\t\t\t\tvar matchedRoute = compiled[i].route\n\t\t\t\t\t\tvar localComp = payload\n\t\t\t\t\t\tvar update = lastUpdate = function(comp) {\n\t\t\t\t\t\t\tif (update !== lastUpdate) return\n\t\t\t\t\t\t\tif (comp === SKIP) return loop(i + 1)\n\t\t\t\t\t\t\tcomponent = comp != null && (typeof comp.view === \"function\" || typeof comp === \"function\")? comp : \"div\"\n\t\t\t\t\t\t\tattrs = data.params, currentPath = path, lastUpdate = null\n\t\t\t\t\t\t\tcurrentResolver = payload.render ? payload : null\n\t\t\t\t\t\t\tif (state === 2) mountRedraw.redraw()\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tstate = 2\n\t\t\t\t\t\t\t\tmountRedraw.redraw.sync()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// There's no understating how much I *wish* I could\n\t\t\t\t\t\t// use `async`/`await` here...\n\t\t\t\t\t\tif (payload.view || typeof payload === \"function\") {\n\t\t\t\t\t\t\tpayload = {}\n\t\t\t\t\t\t\tupdate(localComp)\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (payload.onmatch) {\n\t\t\t\t\t\t\tp.then(function () {\n\t\t\t\t\t\t\t\treturn payload.onmatch(data.params, path, matchedRoute)\n\t\t\t\t\t\t\t}).then(update, fail)\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse update(\"div\")\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfail()\n\t\t\t}\n\t\t}\n\n\t\t// Set it unconditionally so `m.route.set` and `m.route.Link` both work,\n\t\t// even if neither `pushState` nor `hashchange` are supported. It's\n\t\t// cleared if `hashchange` is used, since that makes it automatically\n\t\t// async.\n\t\tfireAsync = function() {\n\t\t\tif (!scheduled) {\n\t\t\t\tscheduled = true\n\t\t\t\tcallAsync(resolveRoute)\n\t\t\t}\n\t\t}\n\n\t\tif (typeof $window.history.pushState === \"function\") {\n\t\t\tonremove = function() {\n\t\t\t\t$window.removeEventListener(\"popstate\", fireAsync, false)\n\t\t\t}\n\t\t\t$window.addEventListener(\"popstate\", fireAsync, false)\n\t\t} else if (route.prefix[0] === \"#\") {\n\t\t\tfireAsync = null\n\t\t\tonremove = function() {\n\t\t\t\t$window.removeEventListener(\"hashchange\", resolveRoute, false)\n\t\t\t}\n\t\t\t$window.addEventListener(\"hashchange\", resolveRoute, false)\n\t\t}\n\n\t\treturn mountRedraw.mount(root, {\n\t\t\tonbeforeupdate: function() {\n\t\t\t\tstate = state ? 2 : 1\n\t\t\t\treturn !(!state || sentinel === currentResolver)\n\t\t\t},\n\t\t\toncreate: resolveRoute,\n\t\t\tonremove: onremove,\n\t\t\tview: function() {\n\t\t\t\tif (!state || sentinel === currentResolver) return\n\t\t\t\t// Wrap in a fragment to preserve existing key semantics\n\t\t\t\tvar vnode = [Vnode(component, attrs.key, attrs)]\n\t\t\t\tif (currentResolver) vnode = currentResolver.render(vnode[0])\n\t\t\t\treturn vnode\n\t\t\t},\n\t\t})\n\t}\n\troute.set = function(path, data, options) {\n\t\tif (lastUpdate != null) {\n\t\t\toptions = options || {}\n\t\t\toptions.replace = true\n\t\t}\n\t\tlastUpdate = null\n\t\tsetPath(path, data, options)\n\t}\n\troute.get = function() {return currentPath}\n\troute.prefix = \"#!\"\n\troute.Link = {\n\t\tview: function(vnode) {\n\t\t\tvar options = vnode.attrs.options\n\t\t\t// Remove these so they don't get overwritten\n\t\t\tvar attrs = {}, onclick, href\n\t\t\tassign(attrs, vnode.attrs)\n\t\t\t// The first two are internal, but the rest are magic attributes\n\t\t\t// that need censored to not screw up rendering.\n\t\t\tattrs.selector = attrs.options = attrs.key = attrs.oninit =\n\t\t\tattrs.oncreate = attrs.onbeforeupdate = attrs.onupdate =\n\t\t\tattrs.onbeforeremove = attrs.onremove = null\n\n\t\t\t// Do this now so we can get the most current `href` and `disabled`.\n\t\t\t// Those attributes may also be specified in the selector, and we\n\t\t\t// should honor that.\n\t\t\tvar child = m(vnode.attrs.selector || \"a\", attrs, vnode.children)\n\n\t\t\t// Let's provide a *right* way to disable a route link, rather than\n\t\t\t// letting people screw up accessibility on accident.\n\t\t\t//\n\t\t\t// The attribute is coerced so users don't get surprised over\n\t\t\t// `disabled: 0` resulting in a button that's somehow routable\n\t\t\t// despite being visibly disabled.\n\t\t\tif (child.attrs.disabled = Boolean(child.attrs.disabled)) {\n\t\t\t\tchild.attrs.href = null\n\t\t\t\tchild.attrs[\"aria-disabled\"] = \"true\"\n\t\t\t\t// If you *really* do want to do this on a disabled link, use\n\t\t\t\t// an `oncreate` hook to add it.\n\t\t\t\tchild.attrs.onclick = null\n\t\t\t} else {\n\t\t\t\tonclick = child.attrs.onclick\n\t\t\t\thref = child.attrs.href\n\t\t\t\tchild.attrs.href = route.prefix + href\n\t\t\t\tchild.attrs.onclick = function(e) {\n\t\t\t\t\tvar result\n\t\t\t\t\tif (typeof onclick === \"function\") {\n\t\t\t\t\t\tresult = onclick.call(e.currentTarget, e)\n\t\t\t\t\t} else if (onclick == null || typeof onclick !== \"object\") {\n\t\t\t\t\t\t// do nothing\n\t\t\t\t\t} else if (typeof onclick.handleEvent === \"function\") {\n\t\t\t\t\t\tonclick.handleEvent(e)\n\t\t\t\t\t}\n\n\t\t\t\t\t// Adapted from React Router's implementation:\n\t\t\t\t\t// https://github.com/ReactTraining/react-router/blob/520a0acd48ae1b066eb0b07d6d4d1790a1d02482/packages/react-router-dom/modules/Link.js\n\t\t\t\t\t//\n\t\t\t\t\t// Try to be flexible and intuitive in how we handle links.\n\t\t\t\t\t// Fun fact: links aren't as obvious to get right as you\n\t\t\t\t\t// would expect. There's a lot more valid ways to click a\n\t\t\t\t\t// link than this, and one might want to not simply click a\n\t\t\t\t\t// link, but right click or command-click it to copy the\n\t\t\t\t\t// link target, etc. Nope, this isn't just for blind people.\n\t\t\t\t\tif (\n\t\t\t\t\t\t// Skip if `onclick` prevented default\n\t\t\t\t\t\tresult !== false && !e.defaultPrevented &&\n\t\t\t\t\t\t// Ignore everything but left clicks\n\t\t\t\t\t\t(e.button === 0 || e.which === 0 || e.which === 1) &&\n\t\t\t\t\t\t// Let the browser handle `target=_blank`, etc.\n\t\t\t\t\t\t(!e.currentTarget.target || e.currentTarget.target === \"_self\") &&\n\t\t\t\t\t\t// No modifier keys\n\t\t\t\t\t\t!e.ctrlKey && !e.metaKey && !e.shiftKey && !e.altKey\n\t\t\t\t\t) {\n\t\t\t\t\t\te.preventDefault()\n\t\t\t\t\t\te.redraw = false\n\t\t\t\t\t\troute.set(href, null, options)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn child\n\t\t},\n\t}\n\troute.param = function(key) {\n\t\treturn attrs && key != null ? attrs[key] : attrs\n\t}\n\n\treturn route\n}\n","\"use strict\"\n\nvar mountRedraw = require(\"./mount-redraw\")\n\nmodule.exports = require(\"./api/router\")(window, mountRedraw)\n","\"use strict\"\n\nvar hyperscript = require(\"./hyperscript\")\nvar request = require(\"./request\")\nvar mountRedraw = require(\"./mount-redraw\")\n\nvar m = function m() { return hyperscript.apply(this, arguments) }\nm.m = hyperscript\nm.trust = hyperscript.trust\nm.fragment = hyperscript.fragment\nm.mount = mountRedraw.mount\nm.route = require(\"./route\")\nm.render = require(\"./render\")\nm.redraw = mountRedraw.redraw\nm.request = request.request\nm.jsonp = request.jsonp\nm.parseQueryString = require(\"./querystring/parse\")\nm.buildQueryString = require(\"./querystring/build\")\nm.parsePathname = require(\"./pathname/parse\")\nm.buildPathname = require(\"./pathname/build\")\nm.vnode = require(\"./render/vnode\")\nm.PromisePolyfill = require(\"./promise/polyfill\")\n\nmodule.exports = m\n","export const typeWriter = ({ text, onStart = () => { }, onTyped = str => { }, onFinished = () => { } }) => {\n    let animId = \"\";\n    let str = \"\";\n\n    onStart();\n\n    const t = (s = \"\", i = 0) => {\n        if (i > text.length) {\n            cancelAnimationFrame(animId);\n            onFinished();\n            return;\n        }\n\n        str = s + text.charAt(i);\n\n        i += 1;\n        onTyped(str);\n\n        requestAnimationFrame(() => t(str, i));\n    };\n\n    return {\n        start: () => (animId = requestAnimationFrame(() => t()))\n    };\n};","import m from \"mithril\";\nimport { typeWriter } from \"./effects\";\n\nlet mounted = false;\nlet isTyping = false;\nlet name = \"\";\nlet text = \"\";\nlet choices = [];\n\nconst primeGlobals = props => {\n  name = props.name;\n  text = \"\";\n  choices = [];\n\n  m.redraw();\n}\n\nconst callTypewriter = props => typeWriter({\n  text: props.text,\n  onStart: () => isTyping = true,\n  onTyped: str => {\n    text = str;\n    m.redraw();\n  },\n  onFinished: () => {\n    isTyping = false;\n    choices = props.choices.length ? props.choices : [];\n    m.redraw();\n  }\n}).start();\n\nconst callText = (props) => {\n\n  if (isTyping) return;\n\n  primeGlobals(props);\n  callTypewriter(props);\n};\n\nconst Shell = ({ attrs }) => {\n  return {\n    oninit: () => mounted = true,\n    onremove: () => {\n      mounted = false;\n      isTyping = false;\n      name = \"\";\n      text = \"\";\n      choices = [];\n    },\n    view: () => m(\"div\", { class: \"uiShell\" }, text &&\n      m(\"div\", { class: \"dialogueBoxOuter\" }, [\n        m(\"div\", { class: \"dialogue\" }, [\n          m(\"span\", name ? `${name}:` : \"\"),\n          m(\"span\", name ? `\"${text}\"` : text),\n          m(\n            \"div\",\n            { class: \"choiceWindow\" },\n            choices.map(choice => {\n              return m(\n                \"button\",\n                {\n                  class: \"choiceBox\",\n                  onclick: () => attrs.onChoiceSelected(choice)\n                },\n                choice.text\n              );\n            })\n          ),\n          isTyping ? \"\" : m(\"span\", { class: \"arrow\" })\n        ])\n      ]))\n  };\n};\n\nexport default {\n  isBusy: () => isTyping,\n  mount: (attrs = {}) =>\n    m.mount(document.getElementById(\"ui\"), {\n      view: () => m(Shell, attrs)\n    }),\n  unmount: () => m.mount(document.getElementById(\"ui\"), null),\n  callText: props => {\n    if (!mounted) return;\n\n    callText({\n      ...props\n    })\n  }\n};\n","// TODO: Ensure you're definitely calling allOff and no events are hanging on\r\n// at load or scene change.\r\nimport { emit, EV_UPDATECONVOTRIGGER, EV_GIVEQUEST } from \"./events\";\r\n\r\nexport const MODES = {\r\n  NOTRUNNING: 100,\r\n  NEXTNODE: 200,\r\n  AWAITINGINPUT: 300,\r\n  JUSTFINISHED: 400,\r\n  COMPLETED: 500\r\n}\r\n\r\nexport default ({\r\n  conversationData,\r\n  onChatStarted = (node, props) => { },\r\n  onChatNext = (node, props) => { },\r\n  onChatComplete = lastPositionSaved => { },\r\n  onChainProgress = lastNodeId => { },\r\n  onChatCancelled = () => { }\r\n}) => {\r\n  let index = 0;\r\n  let currentNode = conversationData[index];\r\n  let isRunning = false;\r\n  let isComplete = false;\r\n\r\n  const displayNode = queriedNode => {\r\n    if (queriedNode) {\r\n      currentNode = queriedNode;\r\n      index = queriedNode.index;\r\n      return queriedNode;\r\n    } else {\r\n      throw \"No node match.\";\r\n    }\r\n  };\r\n\r\n  const queryNode = query => {\r\n    const queriedNode = conversationData.length\r\n      ? conversationData.filter(node => query === node.id)[0]\r\n      : null;\r\n\r\n    return displayNode(queriedNode);\r\n  };\r\n\r\n  const start = (query, props = {}) => {\r\n    const queriedNode = queryNode(query);\r\n\r\n    isRunning = true;\r\n    isComplete = false;\r\n\r\n    onChatStarted(queriedNode, props);\r\n\r\n    return {\r\n      ...displayNode(queriedNode),\r\n      mode: MODES.NEXTNODE\r\n    };\r\n  };\r\n\r\n  const goToExact = (query, props = {}) => {\r\n    const queriedNode = queryNode(query);\r\n\r\n    onChatNext(queriedNode, props);\r\n\r\n    return {\r\n      ...displayNode(queriedNode),\r\n      mode: MODES.NEXTNODE\r\n    };\r\n  };\r\n\r\n  const goToNext = (props = {}) => {\r\n    // We need to run this 'after' the finish so it avoids chained exec on exit.\r\n    if (!isRunning) return {\r\n      mode: MODES.NOTRUNNING\r\n    };\r\n\r\n    if (isComplete) {\r\n      isRunning = false;\r\n      return {\r\n        mode: MODES.COMPLETED\r\n      };\r\n    }\r\n\r\n    // TODO: Beware, if you're not checking for existent choices, this will error out,\r\n    // or do something a little funky. May want to check for choices here instead?\r\n    const { id, to, choices, actions, dataActions } = currentNode;\r\n\r\n    // Wait if choices are presented.\r\n    if (choices.length) return {\r\n      ...currentNode,\r\n      mode: MODES.AWAITINGINPUT\r\n    }\r\n\r\n    // TODO: Consts please.\r\n    if (\r\n      actions.some(action => action === \"endConversation\") ||\r\n      (choices.length === 0 && !to)\r\n    ) {\r\n      if (actions.some(action => action === \"save\")) {\r\n        onChainProgress(id);\r\n      }\r\n\r\n      if (actions.some(action => action === \"cancel\")) {\r\n        onChatCancelled();\r\n      }\r\n\r\n      if (dataActions && dataActions.length) {\r\n        dataActions.forEach(d => {\r\n          // TODO: Might be best to use a 'type' rather than id\r\n          switch(d.id) {\r\n            case \"giveQuest\":\r\n              emit(EV_GIVEQUEST, d);\r\n              break;\r\n            case \"updateConvoTrigger\":\r\n              emit(EV_UPDATECONVOTRIGGER, d);\r\n              break;\r\n          }\r\n        })\r\n      }\r\n\r\n      isComplete = true;\r\n      onChatComplete(id);\r\n      console.log(\"End reached, close the convo.\");\r\n      return {\r\n        ...currentNode,\r\n        mode: MODES.JUSTFINISHED\r\n      }\r\n    }\r\n\r\n    return {\r\n      ...goToExact(to, props),\r\n      mode: MODES.NEXTNODE\r\n    };\r\n  };\r\n\r\n  return {\r\n    isComplete: () => isComplete,\r\n    isRunning: () => isRunning,\r\n    currentIndex: () => index,\r\n    start,\r\n    goToExact,\r\n    goToNext\r\n  };\r\n};\r\n","import { keyPressed } from \"kontra\";\n\nexport default (key, cb = () => {}) => {\n  let pushed = false;\n\n  return props => {\n    if (!pushed && keyPressed(key)) {\n      cb(props);\n      pushed = true;\n    } else if (pushed && !keyPressed(\"e\")) {\n      pushed = false;\n    }\n  };\n};\n","import { setStoreItem, dataAssets } from \"kontra\";\r\nimport dialogue from \"../ui/dialogue\";\r\nimport { emit, EV_CONVOEND } from \"../common/events\";\r\nimport ConversationIterator, { MODES } from \"../common/conversationIterator\";\r\nimport onPush from \"../input/onPush\";\r\n\r\nexport default ({\r\n  id,\r\n  startId,\r\n  onEntry = () => { },\r\n  onExit = () => { }\r\n}) => {\r\n\r\n  console.log(\"Start convo.\");\r\n\r\n  let isComplete = false;\r\n\r\n  const dataKey = \"assets/gameData/conversationData.json\";\r\n  const conversationData = dataAssets[dataKey];\r\n\r\n  const conversationController = ConversationIterator({\r\n    conversationData,\r\n    onChatComplete: exitId => {\r\n      dialogue.unmount();\r\n      emit(EV_CONVOEND, { exitId })\r\n    },\r\n    onChainProgress: lastNodeId => setStoreItem(\"progress\", {\r\n      storyProgress: lastNodeId\r\n    })\r\n  });\r\n\r\n  const onDisplayText = ({ actor: name, text, choices }) =>\r\n    dialogue.callText({ name, text, choices });\r\n\r\n  const onInteractionPushed =\r\n    onPush(\"e\", () => {\r\n\r\n      if (dialogue.isBusy()) return;\r\n\r\n      const { mode, ...rest } = !conversationController.isRunning() ?\r\n        conversationController.start(startId, {\r\n          startId\r\n        }) : conversationController.goToNext();\r\n\r\n      if (mode === MODES.NEXTNODE) {\r\n        onDisplayText(rest);\r\n      }\r\n\r\n      isComplete = mode === MODES.JUSTFINISHED || mode === MODES.COMPLETED;\r\n    });\r\n\r\n  dialogue.mount({\r\n    onChoiceSelected: choice => {\r\n      console.log(\"Selected:\");\r\n      console.log(choice);\r\n      const { mode, ...rest } = conversationController.goToExact(choice.to);\r\n\r\n      if (mode === MODES.NEXTNODE) {\r\n        onDisplayText(rest);\r\n      }\r\n\r\n      isComplete = mode === MODES.JUSTFINISHED || mode === MODES.COMPLETED;\r\n    }\r\n  });\r\n\r\n  return {\r\n    id: \"conversation\",\r\n    isComplete: () => isComplete,\r\n    enter: props => onEntry(),\r\n    update: () => onInteractionPushed(),\r\n    exit: () => onExit()\r\n  };\r\n};\r\n","import { dataAssets, getStoreItem } from \"kontra\";\r\nimport m from \"mithril\";\r\nimport { ENTITY_TYPE } from \"../common/consts\";\r\nimport { groupBy } from \"../common/helpers\";\r\n\r\nlet mounted = false;\r\n\r\n/* still deciding how to work the UI either with\r\nsngular instances of mithril or otherwise. */\r\nconst Shell = ({ attrs }) => {\r\n  // TODO: May be better to do a query method in the store instead as it's more flexible.\r\n  const itemsInStore = getStoreItem(\"entities\").filter(\r\n    x => x.type === ENTITY_TYPE.PICKUP\r\n  );\r\n\r\n  const dataKey = \"assets/gameData/entityData.json\";\r\n  const itemsInData = dataAssets[dataKey];\r\n\r\n  const groupedItems = groupBy(itemsInStore, \"id\");\r\n  const remapped = Object.entries(groupedItems).map(([k, v], i) => {\r\n    console.log(k, v);\r\n    return {\r\n      id: k,\r\n      data: v,\r\n      qty: v.length\r\n    };\r\n  });\r\n\r\n  return {\r\n    oninit: () => (mounted = true),\r\n    onremove: () => (mounted = false),\r\n    view: () =>\r\n      m(\"div\", { class: \"uiShell\" }, [\r\n        m(\"div\", { class: \"dialogueBoxOuter\" }, [\r\n          m(\"div\", { class: \"dialogue\" }, [\r\n            remapped.length\r\n              ? m(\r\n                  \"dl\",\r\n                  { class: \"itemListing\" },\r\n                  remapped.map(item => {\r\n                    const data = itemsInData.find(({ id }) => id === item.id);\r\n                    const qty = item ? item.qty : 0;\r\n\r\n                    return m(\r\n                      \"dd\",\r\n                      {\r\n                        class: \"itemNode\",\r\n                        onclick: () => attrs.onItemSelected(data)\r\n                      },\r\n                      [\r\n                        m(\"img\", { src: data.thumb }),\r\n                        m(\"h4\", `${data.name}: x${qty}`),\r\n                        m(\"h5\", data.description)\r\n                      ]\r\n                    );\r\n                  })\r\n                )\r\n              : m(\"p\", \"No items.\"),\r\n            m(\r\n              \"div\",\r\n              { class: \"choiceWindow\" },\r\n              m(\r\n                \"button\",\r\n                {\r\n                  class: \"choiceBox\",\r\n                  onclick: () => attrs.onInventoryClosed()\r\n                },\r\n                \"Close\"\r\n              )\r\n            )\r\n          ])\r\n        ])\r\n      ])\r\n  };\r\n};\r\n\r\nexport default {\r\n  isBusy: () => mounted,\r\n  mount: (attrs = {}) => {\r\n    m.mount(document.getElementById(\"ui\"), {\r\n      view: () => m(Shell, attrs)\r\n    });\r\n  },\r\n  unmount: () => m.mount(document.getElementById(\"ui\"), null)\r\n};\r\n","import { dataAssets, getStoreItem } from \"kontra\";\r\nimport m from \"mithril\";\r\n\r\nlet mounted = false;\r\n\r\n/* still deciding how to work the UI either with\r\nsngular instances of mithril or otherwise. */\r\nconst Shell = ({ attrs }) => {\r\n    const questsInStore = getStoreItem(\"quests\");\r\n    const dataKey = \"assets/gameData/questData.json\";\r\n    const questsInData = dataAssets[dataKey];\r\n    \r\n    return {\r\n        oninit: () => mounted = true,\r\n        onremove: () => mounted = false,\r\n        view: () =>\r\n            m(\"div\", { class: \"uiShell\" }, [\r\n                m(\"div\", { class: \"dialogueBoxOuter\" }, [\r\n                    m(\"div\", { class: \"dialogue\" }, [\r\n                        questsInStore.length ? m(\"dl\",\r\n                            { class: \"questListing\" },\r\n                            questsInStore.map(({ props }) => {\r\n                                const data = questsInData.find(({ id }) => id === props.questId);\r\n                                const currentSegment = data.parts.find(p => p.index === props.questPart);\r\n\r\n                                return m(\"dd\", {\r\n                                    class: \"questNode\",\r\n                                    onclick: () => attrs.onQuestSelected(data)\r\n                                }, [\r\n                                    m(\"h4\", data.name),\r\n                                    m(\"h5\", currentSegment.description)\r\n                                ])\r\n                            })\r\n                        ) : m(\"p\", \"No quests.\"),\r\n                        m(\"div\",\r\n                            { class: \"choiceWindow\" },\r\n                            m(\r\n                                \"button\",\r\n                                {\r\n                                    class: \"choiceBox\",\r\n                                    onclick: () => attrs.onQuestlogClosed()\r\n                                },\r\n                                \"Close\"\r\n                            )\r\n                        )\r\n                    ])\r\n                ])\r\n            ])\r\n    }\r\n}\r\n\r\nexport default {\r\n    isBusy: () => mounted,\r\n    mount: (attrs = {}) => {\r\n        m.mount(document.getElementById(\"ui\"), {\r\n            view: () => m(Shell, attrs)\r\n        })\r\n    },\r\n    unmount: () => m.mount(document.getElementById(\"ui\"), null)\r\n}","import inventory from \"../ui/inventory\";\r\nimport questlog from \"../ui/questlog\";\r\nimport onPush from \"../input/onPush\";\r\n\r\nexport default ({\r\n  id,\r\n  reactionManager,\r\n  onEntry = () => {},\r\n  onExit = () => {}\r\n}) => {\r\n  let isComplete = false;\r\n  let interactionCooldown = false;\r\n\r\n  /* TODO: Use consts on keys also */\r\n  const onInteractionPushed = onPush(\"e\", ({ origin, collisions = [] }) => {\r\n    if (collisions.length && origin.controlledByUser) {\r\n      if (!interactionCooldown) {\r\n        /* Collision usually pre-sorted by this point, it's not up to the state\r\n        to handle this though. */\r\n        const interactible = collisions[0];\r\n        const reactionData = reactionManager.get(interactible.type);\r\n        /* Not all things will have a reaction set, plus they might expect\r\n        different properties to be passed in future. */\r\n        if (reactionData) {\r\n          reactionData.reactionEvent(interactible, [interactible, origin]);\r\n        }\r\n      } else {\r\n        interactionCooldown = false;\r\n      }\r\n    }\r\n  });\r\n\r\n  const onAttackPushed = onPush(\"space\", ({ origin, collisions = [] }) => {\r\n    collisions.map(col => {\r\n      if (typeof col.onAttacked === \"function\") {\r\n        col.onAttacked({\r\n          origin\r\n        });\r\n      }\r\n    });\r\n  });\r\n\r\n  /* Technically, the inventory should only be openable in the field (or battle, but that's\r\n  out of this scope). Note: You might want the inventory to be a whole new state, but doing\r\n  it this way means you can overlay it across the game whilst you play. Whatever you need\r\n  basically. You might even want to life this to the index like the other reactions, in fact\r\n  that might make more sense. */\r\n  const onInventoryOpened = onPush(\"i\", () => {\r\n    if (inventory.isBusy()) return;\r\n\r\n    /* Get you a list of all items that are being held in data */\r\n    inventory.mount({\r\n      onInventoryClosed: () => inventory.unmount(),\r\n      onItemSelected: itemData => {\r\n        console.log(itemData);\r\n      }\r\n    });\r\n\r\n    // Don't forget to unmount it when it's done also!\r\n  });\r\n\r\n  const onQuestlogOpened = onPush(\"q\", () => {\r\n    if (questlog.isBusy()) return;\r\n\r\n    questlog.mount({\r\n      onQuestlogClosed: () => questlog.unmount(),\r\n      onQuestSelected: questData => {\r\n        console.log(questData)\r\n      }\r\n    });\r\n  });\r\n\r\n  return {\r\n    id,\r\n    isComplete: () => isComplete,\r\n    enter: props => onEntry(),\r\n    update: props => {\r\n      // TODO: Careful these don't conflict and do weird things (inventory in convo, etc, do not want!)\r\n      onInteractionPushed(props);\r\n      onAttackPushed(props);\r\n      onInventoryOpened();\r\n      onQuestlogOpened();\r\n    },\r\n    exit: () => onExit()\r\n  };\r\n};\r\n","export default ({ id, ctx, direction = 1, onFadeComplete = () => {} }) => {\n  // https://stackoverflow.com/questions/19258169/fadein-fadeout-in-html5-canvas\n  let isComplete = false;\n  let alpha = direction < 0 ? 1 : 0,\n    delta = 0.05;\n\n  //ctx.globalAlpha = direction < 0 ? 1 : 0;\n\n  // Under heavy testing\n  const curtainEl = document.getElementById(\"curtain\");\n  curtainEl.style.opacity = direction < 0 ? 1 : 0;\n\n  return {\n    id,\n    isComplete: () => isComplete,\n    enter: props => {},\n    update: () => {\n      isComplete =\n        (direction > 0 && alpha >= 1) || (direction < 0 && alpha <= -1);\n\n      alpha = direction < 0 ? alpha - delta : alpha + delta;\n\n      //ctx.clearRect(0, 0, ctx.width, ctx.height);\n      //ctx.globalAlpha = isComplete ? Math.round(alpha) : alpha;\n\n      curtainEl.style.opacity = isComplete ? Math.round(alpha) : alpha;\n    },\n    exit: () => {\n      //ctx.globalAlpha = direction < 0 ? 0 : 1;\n      curtainEl.style.opacity = direction < 0 ? 0 : 1;\n\n      if (direction === 0) {\n        curtainEl.remove();\n      }\n\n      onFadeComplete();\n    }\n  };\n};\n","export default ({ sceneObject: Scene }) => {\n  let currentScene = null;\n\n  return {\n    loadScene: props => {\n      if (currentScene) currentScene.stop();\n\n      currentScene = Scene(props);\n      currentScene.start();\n    }\n  };\n};\n","/* Note: This isn't a true stack-based FSM. It allows for you to remove\r\nstates at any level which could lead to big problems so keep an eye on it. */\r\nexport default () => {\r\n  let states = [];\r\n  const top = arr => arr[arr.length - 1];\r\n\r\n  return {\r\n    push: (state, props) => {\r\n      if (!states.some(s => s.id === state.id)) {\r\n        states.push(state);\r\n        top(states).enter(props);\r\n      }\r\n    },\r\n    update: props => {\r\n      const currentState = top(states);\r\n      if (!currentState) return;\r\n\r\n      currentState.update(props);\r\n\r\n      if (currentState.isComplete()) {\r\n        currentState.exit();\r\n        //states.pop(); ???\r\n        // Careful doing this. Kind of breaks the idea of state. Look in to\r\n        // other AI methods rather than state machines as I think they suck\r\n        // when it comes to AI. Fine with other things like curtains though.\r\n        states = states.filter(x => x.id !== currentState.id);\r\n      }\r\n    },\r\n    pop: () => {\r\n      const currentState = top(states);\r\n      currentState.exit();\r\n      states.pop();\r\n    },\r\n    popState: id => {\r\n      const currentState = states.find(x => x.id === id);\r\n\r\n      if (!currentState) return;\r\n\r\n      currentState.exit();\r\n      states = states.filter(x => x.id !== id);\r\n    },\r\n    clearStates: () => states.length = 0\r\n  };\r\n};\r\n","import { getNormal } from \"../common/helpers\";\r\n\r\nexport const moveSprite = ({\r\n  dir,\r\n  sprite,\r\n  checkCollision = () => {\r\n    return false;\r\n  }\r\n}) => {\r\n  /* Normalise so you don't go super fast diagonally */\r\n  const directionNormal = getNormal(dir);\r\n\r\n  /// For collisions with tiles\r\n  let oldPos = {\r\n    x: sprite.x,\r\n    y: sprite.y\r\n  };\r\n\r\n  // Move X then check X (careful editing directly, might lead to issues with camera)\r\n  sprite.x += directionNormal.x;\r\n\r\n  // Collider check (const layer names please)\r\n  const collidedWithX = checkCollision(sprite);\r\n\r\n  if (sprite.collidesWithTiles && collidedWithX) {\r\n    sprite.x = oldPos.x;\r\n    sprite.y = oldPos.y;\r\n  }\r\n\r\n  // Update old pos ref\r\n  oldPos = {\r\n    x: sprite.x,\r\n    y: sprite.y\r\n  };\r\n\r\n  // Move Y then check Y (careful editing directly, might lead to issues with camera)\r\n  sprite.y += directionNormal.y;\r\n\r\n  // Collider check against tiles\r\n  const collidedWithY = checkCollision(sprite);\r\n\r\n  if (sprite.collidesWithTiles && collidedWithY) {\r\n    sprite.x = oldPos.x;\r\n    sprite.y = oldPos.y;\r\n  }\r\n\r\n  return {\r\n    directionNormal\r\n  };\r\n};\r\n\r\nexport const flipSprite = ({ direction, sprite }) => {\r\n  if (direction.x < 0 && sprite.scaleX > 0) {\r\n    sprite.setScale(-1, 1);\r\n  } else if (direction.x > 0 && sprite.scaleX < 0) {\r\n    sprite.setScale(1, 1);\r\n  }\r\n};\r\n","import StateMachine from \"../managers/stateManager\";\r\nimport { moveSprite, flipSprite } from \"../common/spriteFunctions\";\r\nimport { uniqueId } from \"../common/helpers\";\r\nimport { Sprite, imageAssets, SpriteSheet, keyPressed } from \"kontra\";\r\n\r\n// Really important TODO: Split sprites out so they aren't sharing the same\r\n// properties. Do you really need a ladder to animate for example? Just give it\r\n// a 'static' flag or no animations full stop.\r\n// TODO: Can we make sure we don't use the 'controlled by user' nonsense in the data anymore. What\r\n// if I want to use a different entity for the player?\r\nexport default ({\r\n  id,\r\n  x,\r\n  y,\r\n  z = 1,\r\n  customProperties = {},\r\n  entityData = null,\r\n  collisionMethod = (layer, sprite) => {}\r\n}) => {\r\n  if (!id) {\r\n    throw new Error(\r\n      \"Entity is fairly useless without an id, you should add one.\"\r\n    );\r\n  }\r\n\r\n  const entityStateMachine = StateMachine();\r\n\r\n  const {\r\n    name,\r\n    type,\r\n    animations,\r\n    frameWidth,\r\n    frameHeight,\r\n    sheet,\r\n    collisionBodyOptions = null,\r\n    manualAnimation = false,\r\n    controlledByUser = false,\r\n    collidesWithTiles = true,\r\n    collidesWithPlayer = false\r\n  } = entityData;\r\n\r\n  let spriteSheet = SpriteSheet({\r\n    image: imageAssets[sheet],\r\n    frameWidth,\r\n    frameHeight,\r\n    animations\r\n  });\r\n\r\n  /* These are passable to states so they can act accordingly */\r\n  let dir = { x: 0, y: 0 }; // AI (to add later)\r\n  let targetDestination = null;\r\n  let movementDisabled = false;\r\n\r\n  /* Id should really be named 'class' since its re-used. */\r\n  const sprite = Sprite({\r\n    instId: uniqueId(id),\r\n    id,\r\n    type,\r\n    name,\r\n    x,\r\n    y,\r\n    z,\r\n    anchor: { x: 0.5, y: 0.5 },\r\n    customProperties,\r\n    radius: 2,\r\n    animations: spriteSheet.animations,\r\n    collidesWithTiles,\r\n    controlledByUser,\r\n    collisionBodyOptions,\r\n    collidesWithPlayer,\r\n    manualAnimation,\r\n    onAttacked: () => {\r\n      // Push an internal state for damage effect (whatever that's going to be)\r\n      console.log(id);\r\n    },\r\n    onConvoEnter: () => (movementDisabled = true),\r\n    onConvoExit: () => (movementDisabled = false),\r\n    lookAt: ({ x, y }) => {\r\n      flipSprite({\r\n        direction: {\r\n          x: sprite.x > x ? -1 : 1,\r\n          y: sprite.y > y ? -1 : 1\r\n        },\r\n        sprite\r\n      });\r\n    },\r\n    update: () => {\r\n      entityStateMachine.update();\r\n\r\n      /* Movement - Massively a work in progress - TODO: Sort out data and splitting out concerns of sprite types. \r\n      targestDestination prop may or may not be an AI thing, as we might want to automatically move the player\r\n      to a location. So make sure it's accessible by all entities further up. */\r\n      if (targetDestination !== null) {\r\n        /* You could also stick pathfinding in here or in AI when it's implemented */\r\n        dir = {\r\n          x: sprite.x > targetDestination.x ? -1 : 1,\r\n          y: sprite.y > targetDestination.y ? -1 : 1\r\n        };\r\n      } else if (controlledByUser && targetDestination == null) {\r\n        dir = {\r\n          x: keyPressed(\"a\") ? -1 : keyPressed(\"d\") ? 1 : 0,\r\n          y: keyPressed(\"w\") ? -1 : keyPressed(\"s\") ? 1 : 0\r\n        };\r\n      } else {\r\n        // This is literally just to stop things like ladders moving. It shouldn't be done this\r\n        // way at all so refactor all of this asap.\r\n        dir = {\r\n          x: 0,\r\n          y: 0\r\n        };\r\n      }\r\n\r\n      // TODO: Not really needed any more\r\n      const { directionNormal } = moveSprite({\r\n        dir:\r\n          movementDisabled && targetDestination === null ? { x: 0, y: 0 } : dir,\r\n        sprite,\r\n        checkCollision: (sprite) => collisionMethod(\"collision\", sprite)\r\n      });\r\n\r\n      // Flip the sprite on movement\r\n      flipSprite({ direction: directionNormal, sprite });\r\n\r\n      // Do some animations\r\n      const isMoving = directionNormal.x !== 0 || directionNormal.y !== 0;\r\n\r\n      if (!sprite.manualAnimation) {\r\n        sprite.playAnimation(isMoving ? \"walk\" : \"idle\");\r\n      }\r\n\r\n      // Call this to ensure animations are player\r\n      sprite.advance();\r\n    }\r\n  });\r\n\r\n  return sprite;\r\n};\r\n","export default ({\r\n  props,\r\n  onEntry = () => {},\r\n  onUpdate = () => {},\r\n  onExit = () => {}\r\n}) => {\r\n  let isComplete = false;\r\n\r\n  return {\r\n    id: \"idle\",\r\n    isComplete: () => isComplete,\r\n    enter: props => onEntry(),\r\n    update: () => {\r\n      props.sprite.playAnimation(\"idle\");\r\n      props.sprite.advance();\r\n      onUpdate();\r\n    },\r\n    exit: () => onExit()\r\n  };\r\n};\r\n","import StateMachine from \"../../managers/stateManager\";\r\nimport aiIdleState from \"../../states/aiIdleState\";\r\n\r\nexport default () => {\r\n  const entityStateMachine = StateMachine();\r\n  let brainData = {};\r\n\r\n  const behaviours = {\r\n    talkMode: () => {\r\n      // Or, talk animation?\r\n      entityStateMachine.push(\r\n        aiIdleState({\r\n          props: {\r\n            sprite: brainData.sprite\r\n          }\r\n        })\r\n      );\r\n    },\r\n    idle: () => {\r\n      entityStateMachine.push(\r\n        aiIdleState({\r\n          props: {\r\n            sprite: brainData.sprite\r\n          }\r\n        })\r\n      );\r\n    }\r\n  };\r\n\r\n  return {\r\n    bootstrap: props => (brainData = { ...props }),\r\n    update: () => entityStateMachine.update(),\r\n    start: () => behaviours.idle(),\r\n    onConvoEnter: () => {\r\n      entityStateMachine.clearStates();\r\n      behaviours.talkMode();\r\n    },\r\n    onConvoExit: () => {\r\n      entityStateMachine.clearStates();\r\n      behaviours.idle();\r\n    }\r\n  };\r\n};\r\n","/**\n * Represents a single instance of EasyStar.\n * A path that is in the queue to eventually be found.\n */\nmodule.exports = function() {\n    this.pointsToAvoid = {};\n    this.startX;\n    this.callback;\n    this.startY;\n    this.endX;\n    this.endY;\n    this.nodeHash = {};\n    this.openList;\n};","/**\n* A simple Node that represents a single tile on the grid.\n* @param {Object} parent The parent node.\n* @param {Number} x The x position on the grid.\n* @param {Number} y The y position on the grid.\n* @param {Number} costSoFar How far this node is in moves*cost from the start.\n* @param {Number} simpleDistanceToTarget Manhatten distance to the end point.\n**/\nmodule.exports = function(parent, x, y, costSoFar, simpleDistanceToTarget) {\n    this.parent = parent;\n    this.x = x;\n    this.y = y;\n    this.costSoFar = costSoFar;\n    this.simpleDistanceToTarget = simpleDistanceToTarget;\n\n    /**\n    * @return {Number} Best guess distance of a cost using this node.\n    **/\n    this.bestGuessDistance = function() {\n        return this.costSoFar + this.simpleDistanceToTarget;\n    }\n};","// Generated by CoffeeScript 1.8.0\n(function() {\n  var Heap, defaultCmp, floor, heapify, heappop, heappush, heappushpop, heapreplace, insort, min, nlargest, nsmallest, updateItem, _siftdown, _siftup;\n\n  floor = Math.floor, min = Math.min;\n\n\n  /*\n  Default comparison function to be used\n   */\n\n  defaultCmp = function(x, y) {\n    if (x < y) {\n      return -1;\n    }\n    if (x > y) {\n      return 1;\n    }\n    return 0;\n  };\n\n\n  /*\n  Insert item x in list a, and keep it sorted assuming a is sorted.\n  \n  If x is already in a, insert it to the right of the rightmost x.\n  \n  Optional args lo (default 0) and hi (default a.length) bound the slice\n  of a to be searched.\n   */\n\n  insort = function(a, x, lo, hi, cmp) {\n    var mid;\n    if (lo == null) {\n      lo = 0;\n    }\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    if (lo < 0) {\n      throw new Error('lo must be non-negative');\n    }\n    if (hi == null) {\n      hi = a.length;\n    }\n    while (lo < hi) {\n      mid = floor((lo + hi) / 2);\n      if (cmp(x, a[mid]) < 0) {\n        hi = mid;\n      } else {\n        lo = mid + 1;\n      }\n    }\n    return ([].splice.apply(a, [lo, lo - lo].concat(x)), x);\n  };\n\n\n  /*\n  Push item onto heap, maintaining the heap invariant.\n   */\n\n  heappush = function(array, item, cmp) {\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    array.push(item);\n    return _siftdown(array, 0, array.length - 1, cmp);\n  };\n\n\n  /*\n  Pop the smallest item off the heap, maintaining the heap invariant.\n   */\n\n  heappop = function(array, cmp) {\n    var lastelt, returnitem;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    lastelt = array.pop();\n    if (array.length) {\n      returnitem = array[0];\n      array[0] = lastelt;\n      _siftup(array, 0, cmp);\n    } else {\n      returnitem = lastelt;\n    }\n    return returnitem;\n  };\n\n\n  /*\n  Pop and return the current smallest value, and add the new item.\n  \n  This is more efficient than heappop() followed by heappush(), and can be\n  more appropriate when using a fixed size heap. Note that the value\n  returned may be larger than item! That constrains reasonable use of\n  this routine unless written as part of a conditional replacement:\n      if item > array[0]\n        item = heapreplace(array, item)\n   */\n\n  heapreplace = function(array, item, cmp) {\n    var returnitem;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    returnitem = array[0];\n    array[0] = item;\n    _siftup(array, 0, cmp);\n    return returnitem;\n  };\n\n\n  /*\n  Fast version of a heappush followed by a heappop.\n   */\n\n  heappushpop = function(array, item, cmp) {\n    var _ref;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    if (array.length && cmp(array[0], item) < 0) {\n      _ref = [array[0], item], item = _ref[0], array[0] = _ref[1];\n      _siftup(array, 0, cmp);\n    }\n    return item;\n  };\n\n\n  /*\n  Transform list into a heap, in-place, in O(array.length) time.\n   */\n\n  heapify = function(array, cmp) {\n    var i, _i, _j, _len, _ref, _ref1, _results, _results1;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    _ref1 = (function() {\n      _results1 = [];\n      for (var _j = 0, _ref = floor(array.length / 2); 0 <= _ref ? _j < _ref : _j > _ref; 0 <= _ref ? _j++ : _j--){ _results1.push(_j); }\n      return _results1;\n    }).apply(this).reverse();\n    _results = [];\n    for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n      i = _ref1[_i];\n      _results.push(_siftup(array, i, cmp));\n    }\n    return _results;\n  };\n\n\n  /*\n  Update the position of the given item in the heap.\n  This function should be called every time the item is being modified.\n   */\n\n  updateItem = function(array, item, cmp) {\n    var pos;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    pos = array.indexOf(item);\n    if (pos === -1) {\n      return;\n    }\n    _siftdown(array, 0, pos, cmp);\n    return _siftup(array, pos, cmp);\n  };\n\n\n  /*\n  Find the n largest elements in a dataset.\n   */\n\n  nlargest = function(array, n, cmp) {\n    var elem, result, _i, _len, _ref;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    result = array.slice(0, n);\n    if (!result.length) {\n      return result;\n    }\n    heapify(result, cmp);\n    _ref = array.slice(n);\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n      elem = _ref[_i];\n      heappushpop(result, elem, cmp);\n    }\n    return result.sort(cmp).reverse();\n  };\n\n\n  /*\n  Find the n smallest elements in a dataset.\n   */\n\n  nsmallest = function(array, n, cmp) {\n    var elem, i, los, result, _i, _j, _len, _ref, _ref1, _results;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    if (n * 10 <= array.length) {\n      result = array.slice(0, n).sort(cmp);\n      if (!result.length) {\n        return result;\n      }\n      los = result[result.length - 1];\n      _ref = array.slice(n);\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        elem = _ref[_i];\n        if (cmp(elem, los) < 0) {\n          insort(result, elem, 0, null, cmp);\n          result.pop();\n          los = result[result.length - 1];\n        }\n      }\n      return result;\n    }\n    heapify(array, cmp);\n    _results = [];\n    for (i = _j = 0, _ref1 = min(n, array.length); 0 <= _ref1 ? _j < _ref1 : _j > _ref1; i = 0 <= _ref1 ? ++_j : --_j) {\n      _results.push(heappop(array, cmp));\n    }\n    return _results;\n  };\n\n  _siftdown = function(array, startpos, pos, cmp) {\n    var newitem, parent, parentpos;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    newitem = array[pos];\n    while (pos > startpos) {\n      parentpos = (pos - 1) >> 1;\n      parent = array[parentpos];\n      if (cmp(newitem, parent) < 0) {\n        array[pos] = parent;\n        pos = parentpos;\n        continue;\n      }\n      break;\n    }\n    return array[pos] = newitem;\n  };\n\n  _siftup = function(array, pos, cmp) {\n    var childpos, endpos, newitem, rightpos, startpos;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    endpos = array.length;\n    startpos = pos;\n    newitem = array[pos];\n    childpos = 2 * pos + 1;\n    while (childpos < endpos) {\n      rightpos = childpos + 1;\n      if (rightpos < endpos && !(cmp(array[childpos], array[rightpos]) < 0)) {\n        childpos = rightpos;\n      }\n      array[pos] = array[childpos];\n      pos = childpos;\n      childpos = 2 * pos + 1;\n    }\n    array[pos] = newitem;\n    return _siftdown(array, startpos, pos, cmp);\n  };\n\n  Heap = (function() {\n    Heap.push = heappush;\n\n    Heap.pop = heappop;\n\n    Heap.replace = heapreplace;\n\n    Heap.pushpop = heappushpop;\n\n    Heap.heapify = heapify;\n\n    Heap.updateItem = updateItem;\n\n    Heap.nlargest = nlargest;\n\n    Heap.nsmallest = nsmallest;\n\n    function Heap(cmp) {\n      this.cmp = cmp != null ? cmp : defaultCmp;\n      this.nodes = [];\n    }\n\n    Heap.prototype.push = function(x) {\n      return heappush(this.nodes, x, this.cmp);\n    };\n\n    Heap.prototype.pop = function() {\n      return heappop(this.nodes, this.cmp);\n    };\n\n    Heap.prototype.peek = function() {\n      return this.nodes[0];\n    };\n\n    Heap.prototype.contains = function(x) {\n      return this.nodes.indexOf(x) !== -1;\n    };\n\n    Heap.prototype.replace = function(x) {\n      return heapreplace(this.nodes, x, this.cmp);\n    };\n\n    Heap.prototype.pushpop = function(x) {\n      return heappushpop(this.nodes, x, this.cmp);\n    };\n\n    Heap.prototype.heapify = function() {\n      return heapify(this.nodes, this.cmp);\n    };\n\n    Heap.prototype.updateItem = function(x) {\n      return updateItem(this.nodes, x, this.cmp);\n    };\n\n    Heap.prototype.clear = function() {\n      return this.nodes = [];\n    };\n\n    Heap.prototype.empty = function() {\n      return this.nodes.length === 0;\n    };\n\n    Heap.prototype.size = function() {\n      return this.nodes.length;\n    };\n\n    Heap.prototype.clone = function() {\n      var heap;\n      heap = new Heap();\n      heap.nodes = this.nodes.slice(0);\n      return heap;\n    };\n\n    Heap.prototype.toArray = function() {\n      return this.nodes.slice(0);\n    };\n\n    Heap.prototype.insert = Heap.prototype.push;\n\n    Heap.prototype.top = Heap.prototype.peek;\n\n    Heap.prototype.front = Heap.prototype.peek;\n\n    Heap.prototype.has = Heap.prototype.contains;\n\n    Heap.prototype.copy = Heap.prototype.clone;\n\n    return Heap;\n\n  })();\n\n  (function(root, factory) {\n    if (typeof define === 'function' && define.amd) {\n      return define([], factory);\n    } else if (typeof exports === 'object') {\n      return module.exports = factory();\n    } else {\n      return root.Heap = factory();\n    }\n  })(this, function() {\n    return Heap;\n  });\n\n}).call(this);\n","module.exports = require('./lib/heap');\n","/**\n*   EasyStar.js\n*   github.com/prettymuchbryce/EasyStarJS\n*   Licensed under the MIT license.\n*\n*   Implementation By Bryce Neal (@prettymuchbryce)\n**/\n\nvar EasyStar = {}\nvar Instance = require('./instance');\nvar Node = require('./node');\nvar Heap = require('heap');\n\nconst CLOSED_LIST = 0;\nconst OPEN_LIST = 1;\n\nmodule.exports = EasyStar;\n\nvar nextInstanceId = 1;\n\nEasyStar.js = function() {\n    var STRAIGHT_COST = 1.0;\n    var DIAGONAL_COST = 1.4;\n    var syncEnabled = false;\n    var pointsToAvoid = {};\n    var collisionGrid;\n    var costMap = {};\n    var pointsToCost = {};\n    var directionalConditions = {};\n    var allowCornerCutting = true;\n    var iterationsSoFar;\n    var instances = {};\n    var instanceQueue = [];\n    var iterationsPerCalculation = Number.MAX_VALUE;\n    var acceptableTiles;\n    var diagonalsEnabled = false;\n\n    /**\n    * Sets the collision grid that EasyStar uses.\n    *\n    * @param {Array|Number} tiles An array of numbers that represent\n    * which tiles in your grid should be considered\n    * acceptable, or \"walkable\".\n    **/\n    this.setAcceptableTiles = function(tiles) {\n        if (tiles instanceof Array) {\n            // Array\n            acceptableTiles = tiles;\n        } else if (!isNaN(parseFloat(tiles)) && isFinite(tiles)) {\n            // Number\n            acceptableTiles = [tiles];\n        }\n    };\n\n    /**\n    * Enables sync mode for this EasyStar instance..\n    * if you're into that sort of thing.\n    **/\n    this.enableSync = function() {\n        syncEnabled = true;\n    };\n\n    /**\n    * Disables sync mode for this EasyStar instance.\n    **/\n    this.disableSync = function() {\n        syncEnabled = false;\n    };\n\n    /**\n     * Enable diagonal pathfinding.\n     */\n    this.enableDiagonals = function() {\n        diagonalsEnabled = true;\n    }\n\n    /**\n     * Disable diagonal pathfinding.\n     */\n    this.disableDiagonals = function() {\n        diagonalsEnabled = false;\n    }\n\n    /**\n    * Sets the collision grid that EasyStar uses.\n    *\n    * @param {Array} grid The collision grid that this EasyStar instance will read from.\n    * This should be a 2D Array of Numbers.\n    **/\n    this.setGrid = function(grid) {\n        collisionGrid = grid;\n\n        //Setup cost map\n        for (var y = 0; y < collisionGrid.length; y++) {\n            for (var x = 0; x < collisionGrid[0].length; x++) {\n                if (!costMap[collisionGrid[y][x]]) {\n                    costMap[collisionGrid[y][x]] = 1\n                }\n            }\n        }\n    };\n\n    /**\n    * Sets the tile cost for a particular tile type.\n    *\n    * @param {Number} The tile type to set the cost for.\n    * @param {Number} The multiplicative cost associated with the given tile.\n    **/\n    this.setTileCost = function(tileType, cost) {\n        costMap[tileType] = cost;\n    };\n\n    /**\n    * Sets the an additional cost for a particular point.\n    * Overrides the cost from setTileCost.\n    *\n    * @param {Number} x The x value of the point to cost.\n    * @param {Number} y The y value of the point to cost.\n    * @param {Number} The multiplicative cost associated with the given point.\n    **/\n    this.setAdditionalPointCost = function(x, y, cost) {\n        if (pointsToCost[y] === undefined) {\n            pointsToCost[y] = {};\n        }\n        pointsToCost[y][x] = cost;\n    };\n\n    /**\n    * Remove the additional cost for a particular point.\n    *\n    * @param {Number} x The x value of the point to stop costing.\n    * @param {Number} y The y value of the point to stop costing.\n    **/\n    this.removeAdditionalPointCost = function(x, y) {\n        if (pointsToCost[y] !== undefined) {\n            delete pointsToCost[y][x];\n        }\n    }\n\n    /**\n    * Remove all additional point costs.\n    **/\n    this.removeAllAdditionalPointCosts = function() {\n        pointsToCost = {};\n    }\n\n    /**\n    * Sets a directional condition on a tile\n    *\n    * @param {Number} x The x value of the point.\n    * @param {Number} y The y value of the point.\n    * @param {Array.<String>} allowedDirections A list of all the allowed directions that can access\n    * the tile.\n    **/\n    this.setDirectionalCondition = function(x, y, allowedDirections) {\n        if (directionalConditions[y] === undefined) {\n            directionalConditions[y] = {};\n        }\n        directionalConditions[y][x] = allowedDirections;\n    };\n\n    /**\n    * Remove all directional conditions\n    **/\n    this.removeAllDirectionalConditions = function() {\n        directionalConditions = {};\n    };\n\n    /**\n    * Sets the number of search iterations per calculation.\n    * A lower number provides a slower result, but more practical if you\n    * have a large tile-map and don't want to block your thread while\n    * finding a path.\n    *\n    * @param {Number} iterations The number of searches to prefrom per calculate() call.\n    **/\n    this.setIterationsPerCalculation = function(iterations) {\n        iterationsPerCalculation = iterations;\n    };\n\n    /**\n    * Avoid a particular point on the grid,\n    * regardless of whether or not it is an acceptable tile.\n    *\n    * @param {Number} x The x value of the point to avoid.\n    * @param {Number} y The y value of the point to avoid.\n    **/\n    this.avoidAdditionalPoint = function(x, y) {\n        if (pointsToAvoid[y] === undefined) {\n            pointsToAvoid[y] = {};\n        }\n        pointsToAvoid[y][x] = 1;\n    };\n\n    /**\n    * Stop avoiding a particular point on the grid.\n    *\n    * @param {Number} x The x value of the point to stop avoiding.\n    * @param {Number} y The y value of the point to stop avoiding.\n    **/\n    this.stopAvoidingAdditionalPoint = function(x, y) {\n        if (pointsToAvoid[y] !== undefined) {\n            delete pointsToAvoid[y][x];\n        }\n    };\n\n    /**\n    * Enables corner cutting in diagonal movement.\n    **/\n    this.enableCornerCutting = function() {\n        allowCornerCutting = true;\n    };\n\n    /**\n    * Disables corner cutting in diagonal movement.\n    **/\n    this.disableCornerCutting = function() {\n        allowCornerCutting = false;\n    };\n\n    /**\n    * Stop avoiding all additional points on the grid.\n    **/\n    this.stopAvoidingAllAdditionalPoints = function() {\n        pointsToAvoid = {};\n    };\n\n    /**\n    * Find a path.\n    *\n    * @param {Number} startX The X position of the starting point.\n    * @param {Number} startY The Y position of the starting point.\n    * @param {Number} endX The X position of the ending point.\n    * @param {Number} endY The Y position of the ending point.\n    * @param {Function} callback A function that is called when your path\n    * is found, or no path is found.\n    * @return {Number} A numeric, non-zero value which identifies the created instance. This value can be passed to cancelPath to cancel the path calculation.\n    *\n    **/\n    this.findPath = function(startX, startY, endX, endY, callback) {\n        // Wraps the callback for sync vs async logic\n        var callbackWrapper = function(result) {\n            if (syncEnabled) {\n                callback(result);\n            } else {\n                setTimeout(function() {\n                    callback(result);\n                });\n            }\n        }\n\n        // No acceptable tiles were set\n        if (acceptableTiles === undefined) {\n            throw new Error(\"You can't set a path without first calling setAcceptableTiles() on EasyStar.\");\n        }\n        // No grid was set\n        if (collisionGrid === undefined) {\n            throw new Error(\"You can't set a path without first calling setGrid() on EasyStar.\");\n        }\n\n        // Start or endpoint outside of scope.\n        if (startX < 0 || startY < 0 || endX < 0 || endY < 0 ||\n        startX > collisionGrid[0].length-1 || startY > collisionGrid.length-1 ||\n        endX > collisionGrid[0].length-1 || endY > collisionGrid.length-1) {\n            throw new Error(\"Your start or end point is outside the scope of your grid.\");\n        }\n\n        // Start and end are the same tile.\n        if (startX===endX && startY===endY) {\n            callbackWrapper([]);\n            return;\n        }\n\n        // End point is not an acceptable tile.\n        var endTile = collisionGrid[endY][endX];\n        var isAcceptable = false;\n        for (var i = 0; i < acceptableTiles.length; i++) {\n            if (endTile === acceptableTiles[i]) {\n                isAcceptable = true;\n                break;\n            }\n        }\n\n        if (isAcceptable === false) {\n            callbackWrapper(null);\n            return;\n        }\n\n        // Create the instance\n        var instance = new Instance();\n        instance.openList = new Heap(function(nodeA, nodeB) {\n            return nodeA.bestGuessDistance() - nodeB.bestGuessDistance();\n        });\n        instance.isDoneCalculating = false;\n        instance.nodeHash = {};\n        instance.startX = startX;\n        instance.startY = startY;\n        instance.endX = endX;\n        instance.endY = endY;\n        instance.callback = callbackWrapper;\n\n        instance.openList.push(coordinateToNode(instance, instance.startX,\n            instance.startY, null, STRAIGHT_COST));\n\n        var instanceId = nextInstanceId ++;\n        instances[instanceId] = instance;\n        instanceQueue.push(instanceId);\n        return instanceId;\n    };\n\n    /**\n     * Cancel a path calculation.\n     *\n     * @param {Number} instanceId The instance ID of the path being calculated\n     * @return {Boolean} True if an instance was found and cancelled.\n     *\n     **/\n    this.cancelPath = function(instanceId) {\n        if (instanceId in instances) {\n            delete instances[instanceId];\n            // No need to remove it from instanceQueue\n            return true;\n        }\n        return false;\n    };\n\n    /**\n    * This method steps through the A* Algorithm in an attempt to\n    * find your path(s). It will search 4-8 tiles (depending on diagonals) for every calculation.\n    * You can change the number of calculations done in a call by using\n    * easystar.setIteratonsPerCalculation().\n    **/\n    this.calculate = function() {\n        if (instanceQueue.length === 0 || collisionGrid === undefined || acceptableTiles === undefined) {\n            return;\n        }\n        for (iterationsSoFar = 0; iterationsSoFar < iterationsPerCalculation; iterationsSoFar++) {\n            if (instanceQueue.length === 0) {\n                return;\n            }\n\n            if (syncEnabled) {\n                // If this is a sync instance, we want to make sure that it calculates synchronously.\n                iterationsSoFar = 0;\n            }\n\n            var instanceId = instanceQueue[0];\n            var instance = instances[instanceId];\n            if (typeof instance == 'undefined') {\n                // This instance was cancelled\n                instanceQueue.shift();\n                continue;\n            }\n\n            // Couldn't find a path.\n            if (instance.openList.size() === 0) {\n                instance.callback(null);\n                delete instances[instanceId];\n                instanceQueue.shift();\n                continue;\n            }\n\n            var searchNode = instance.openList.pop();\n\n            // Handles the case where we have found the destination\n            if (instance.endX === searchNode.x && instance.endY === searchNode.y) {\n                var path = [];\n                path.push({x: searchNode.x, y: searchNode.y});\n                var parent = searchNode.parent;\n                while (parent!=null) {\n                    path.push({x: parent.x, y:parent.y});\n                    parent = parent.parent;\n                }\n                path.reverse();\n                var ip = path;\n                instance.callback(ip);\n                delete instances[instanceId];\n                instanceQueue.shift();\n                continue;\n            }\n\n            searchNode.list = CLOSED_LIST;\n\n            if (searchNode.y > 0) {\n                checkAdjacentNode(instance, searchNode,\n                    0, -1, STRAIGHT_COST * getTileCost(searchNode.x, searchNode.y-1));\n            }\n            if (searchNode.x < collisionGrid[0].length-1) {\n                checkAdjacentNode(instance, searchNode,\n                    1, 0, STRAIGHT_COST * getTileCost(searchNode.x+1, searchNode.y));\n            }\n            if (searchNode.y < collisionGrid.length-1) {\n                checkAdjacentNode(instance, searchNode,\n                    0, 1, STRAIGHT_COST * getTileCost(searchNode.x, searchNode.y+1));\n            }\n            if (searchNode.x > 0) {\n                checkAdjacentNode(instance, searchNode,\n                    -1, 0, STRAIGHT_COST * getTileCost(searchNode.x-1, searchNode.y));\n            }\n            if (diagonalsEnabled) {\n                if (searchNode.x > 0 && searchNode.y > 0) {\n\n                    if (allowCornerCutting ||\n                        (isTileWalkable(collisionGrid, acceptableTiles, searchNode.x, searchNode.y-1, searchNode) &&\n                        isTileWalkable(collisionGrid, acceptableTiles, searchNode.x-1, searchNode.y, searchNode))) {\n\n                        checkAdjacentNode(instance, searchNode,\n                            -1, -1, DIAGONAL_COST * getTileCost(searchNode.x-1, searchNode.y-1));\n                    }\n                }\n                if (searchNode.x < collisionGrid[0].length-1 && searchNode.y < collisionGrid.length-1) {\n\n                    if (allowCornerCutting ||\n                        (isTileWalkable(collisionGrid, acceptableTiles, searchNode.x, searchNode.y+1, searchNode) &&\n                        isTileWalkable(collisionGrid, acceptableTiles, searchNode.x+1, searchNode.y, searchNode))) {\n\n                        checkAdjacentNode(instance, searchNode,\n                            1, 1, DIAGONAL_COST * getTileCost(searchNode.x+1, searchNode.y+1));\n                    }\n                }\n                if (searchNode.x < collisionGrid[0].length-1 && searchNode.y > 0) {\n\n                    if (allowCornerCutting ||\n                        (isTileWalkable(collisionGrid, acceptableTiles, searchNode.x, searchNode.y-1, searchNode) &&\n                        isTileWalkable(collisionGrid, acceptableTiles, searchNode.x+1, searchNode.y, searchNode))) {\n\n                        checkAdjacentNode(instance, searchNode,\n                            1, -1, DIAGONAL_COST * getTileCost(searchNode.x+1, searchNode.y-1));\n                    }\n                }\n                if (searchNode.x > 0 && searchNode.y < collisionGrid.length-1) {\n\n                    if (allowCornerCutting ||\n                        (isTileWalkable(collisionGrid, acceptableTiles, searchNode.x, searchNode.y+1, searchNode) &&\n                        isTileWalkable(collisionGrid, acceptableTiles, searchNode.x-1, searchNode.y, searchNode))) {\n\n                        checkAdjacentNode(instance, searchNode,\n                            -1, 1, DIAGONAL_COST * getTileCost(searchNode.x-1, searchNode.y+1));\n                    }\n                }\n            }\n\n        }\n    };\n\n    // Private methods follow\n    var checkAdjacentNode = function(instance, searchNode, x, y, cost) {\n        var adjacentCoordinateX = searchNode.x+x;\n        var adjacentCoordinateY = searchNode.y+y;\n\n        if ((pointsToAvoid[adjacentCoordinateY] === undefined ||\n             pointsToAvoid[adjacentCoordinateY][adjacentCoordinateX] === undefined) &&\n            isTileWalkable(collisionGrid, acceptableTiles, adjacentCoordinateX, adjacentCoordinateY, searchNode)) {\n            var node = coordinateToNode(instance, adjacentCoordinateX,\n                adjacentCoordinateY, searchNode, cost);\n\n            if (node.list === undefined) {\n                node.list = OPEN_LIST;\n                instance.openList.push(node);\n            } else if (searchNode.costSoFar + cost < node.costSoFar) {\n                node.costSoFar = searchNode.costSoFar + cost;\n                node.parent = searchNode;\n                instance.openList.updateItem(node);\n            }\n        }\n    };\n\n    // Helpers\n    var isTileWalkable = function(collisionGrid, acceptableTiles, x, y, sourceNode) {\n        var directionalCondition = directionalConditions[y] && directionalConditions[y][x];\n        if (directionalCondition) {\n            var direction = calculateDirection(sourceNode.x - x, sourceNode.y - y)\n            var directionIncluded = function () {\n                for (var i = 0; i < directionalCondition.length; i++) {\n                    if (directionalCondition[i] === direction) return true\n                }\n                return false\n            }\n            if (!directionIncluded()) return false\n        }\n        for (var i = 0; i < acceptableTiles.length; i++) {\n            if (collisionGrid[y][x] === acceptableTiles[i]) {\n                return true;\n            }\n        }\n\n        return false;\n    };\n\n    /**\n     * -1, -1 | 0, -1  | 1, -1\n     * -1,  0 | SOURCE | 1,  0\n     * -1,  1 | 0,  1  | 1,  1\n     */\n    var calculateDirection = function (diffX, diffY) {\n        if (diffX === 0 && diffY === -1) return EasyStar.TOP\n        else if (diffX === 1 && diffY === -1) return EasyStar.TOP_RIGHT\n        else if (diffX === 1 && diffY === 0) return EasyStar.RIGHT\n        else if (diffX === 1 && diffY === 1) return EasyStar.BOTTOM_RIGHT\n        else if (diffX === 0 && diffY === 1) return EasyStar.BOTTOM\n        else if (diffX === -1 && diffY === 1) return EasyStar.BOTTOM_LEFT\n        else if (diffX === -1 && diffY === 0) return EasyStar.LEFT\n        else if (diffX === -1 && diffY === -1) return EasyStar.TOP_LEFT\n        throw new Error('These differences are not valid: ' + diffX + ', ' + diffY)\n    };\n\n    var getTileCost = function(x, y) {\n        return (pointsToCost[y] && pointsToCost[y][x]) || costMap[collisionGrid[y][x]]\n    };\n\n    var coordinateToNode = function(instance, x, y, parent, cost) {\n        if (instance.nodeHash[y] !== undefined) {\n            if (instance.nodeHash[y][x] !== undefined) {\n                return instance.nodeHash[y][x];\n            }\n        } else {\n            instance.nodeHash[y] = {};\n        }\n        var simpleDistanceToTarget = getDistance(x, y, instance.endX, instance.endY);\n        if (parent!==null) {\n            var costSoFar = parent.costSoFar + cost;\n        } else {\n            costSoFar = 0;\n        }\n        var node = new Node(parent,x,y,costSoFar,simpleDistanceToTarget);\n        instance.nodeHash[y][x] = node;\n        return node;\n    };\n\n    var getDistance = function(x1,y1,x2,y2) {\n        if (diagonalsEnabled) {\n            // Octile distance\n            var dx = Math.abs(x1 - x2);\n            var dy = Math.abs(y1 - y2);\n            if (dx < dy) {\n                return DIAGONAL_COST * dx + dy;\n            } else {\n                return DIAGONAL_COST * dy + dx;\n            }\n        } else {\n            // Manhattan distance\n            var dx = Math.abs(x1 - x2);\n            var dy = Math.abs(y1 - y2);\n            return (dx + dy);\n        }\n    };\n}\n\nEasyStar.TOP = 'TOP'\nEasyStar.TOP_RIGHT = 'TOP_RIGHT'\nEasyStar.RIGHT = 'RIGHT'\nEasyStar.BOTTOM_RIGHT = 'BOTTOM_RIGHT'\nEasyStar.BOTTOM = 'BOTTOM'\nEasyStar.BOTTOM_LEFT = 'BOTTOM_LEFT'\nEasyStar.LEFT = 'LEFT'\nEasyStar.TOP_LEFT = 'TOP_LEFT'\n","import EasyStar from \"easystarjs\";\r\n\r\nexport const findPath = ({ aiPathGrid, tx, ty, rx, ry, walkableId }) => {\r\n  return new Promise(resolve => {\r\n    // TODO: Not sure you'll want to do this every single time, seems intensive.\r\n    const easystar = new EasyStar.js();\r\n\r\n    easystar.enableDiagonals();\r\n    easystar.enableCornerCutting();\r\n    easystar.setGrid(aiPathGrid);\r\n    easystar.setAcceptableTiles([walkableId]);\r\n\r\n    easystar.findPath(tx, ty, rx, ry, function(path) {\r\n      if (path === null || path !== null && path.length === 0) {\r\n        // console.log(\"Path was not found.\");\r\n\r\n        resolve([]);\r\n      } else {\r\n        // console.log(\r\n        //   \"Path was found. The first Point is \" + path[0].x + \" \" + path[0].y\r\n        // );\r\n\r\n        resolve(path);\r\n      }\r\n    });\r\n\r\n    // Just calculate once (if you run in to issues, may need to do it every frame. Def so for a changing map landscape)\r\n    easystar.calculate();\r\n  });\r\n};\r\n\r\nexport const wait = ms => {\r\n  return new Promise(resolve => setTimeout(resolve, ms));\r\n};\r\n","import { Vector } from \"kontra\";\r\nimport { Queue } from \"../common/helpers\";\r\nimport { flipSprite } from \"../common/spriteFunctions\";\r\nimport { getRandomIntInclusive } from \"../common/helpers\";\r\nimport { findPath } from \"../common/aiHelpers\";\r\n\r\nexport default ({ props, onEntry = () => {}, onExit = () => {} }) => {\r\n  const destQueue = Queue();\r\n  const { aiPathGrid, sprite } = props;\r\n\r\n  // TODO: Stick in a config (you may have one than one in future also).\r\n  const walkableId = 102;\r\n  const tx = Math.floor(sprite.x / 16);\r\n  const ty = Math.floor(sprite.y / 16);\r\n  let walkableTiles = [];\r\n\r\n  // We need to grab a random point on the aiPathGrid but only if it's walkable.\r\n  for (let i = 0; i < aiPathGrid.length; i++) {\r\n    for (let j = 0; j < aiPathGrid[i].length; j++) {\r\n      if (aiPathGrid[i][j] === walkableId) {\r\n        walkableTiles.push(Vector(j, i));\r\n      }\r\n    }\r\n  }\r\n\r\n  if (!walkableTiles.length) {\r\n    throw \"No walkable tiles were found.\"; // TODO: const errors please\r\n  }\r\n\r\n  const randomWalkable =\r\n    walkableTiles[getRandomIntInclusive(0, walkableTiles.length - 1)];\r\n\r\n  let rx = randomWalkable.x;\r\n  let ry = randomWalkable.y;\r\n  let isComplete = false;\r\n  let current = Vector(sprite.x, sprite.y);\r\n  let tileDest = null;\r\n  let destination = null;\r\n\r\n  return {\r\n    id: \"followPath\",\r\n    isComplete: () => isComplete,\r\n    enter: async props => {\r\n      // TODO: This isn't a hugely performant method. ES should be running at all times\r\n      // and instantiate only once.\r\n      const calculatedPath = await findPath({\r\n        aiPathGrid,\r\n        tx,\r\n        ty,\r\n        rx,\r\n        ry,\r\n        walkableId\r\n      });\r\n\r\n      // Exit early on errored path (could be a sign of something sinister)\r\n      if (!calculatedPath.length) {\r\n        isComplete = true;\r\n        return;\r\n      }\r\n\r\n      // Let set to '1' to avoid pointless backtrack on first segment\r\n      // Give the destination a little variation as well to make it more natural\r\n      for (let i = 1; i < calculatedPath.length; i++) {\r\n        destQueue.enqueue(\r\n          Vector(\r\n            calculatedPath[i].x * 16 + getRandomIntInclusive(0, 16),\r\n            calculatedPath[i].y * 16 + getRandomIntInclusive(0, 16)\r\n          )\r\n        );\r\n      }\r\n\r\n      tileDest = destQueue.dequeue();\r\n      destination = Vector(tileDest.x, tileDest.y);\r\n\r\n      onEntry();\r\n    },\r\n    update: () => {\r\n      if (!destination) {\r\n        isComplete = true;\r\n        return;\r\n      }\r\n\r\n      // Note: No need for acc at this stage\r\n      let vel = Vector(0, 0);\r\n\r\n      // Current vector towards target\r\n      let distanceToTarget = destination.subtract(current).length();\r\n\r\n      // Cease all movement if arrived, otherwise just carry on\r\n      if (distanceToTarget > 1) {\r\n        vel = destination.subtract(current).normalize().scale(0.75);\r\n        sprite.x += vel.x;\r\n        sprite.y += vel.y;\r\n        current = Vector(sprite.x, sprite.y);\r\n      } else {\r\n        destination = destQueue.dequeue();\r\n      }\r\n\r\n      flipSprite({ direction: vel, sprite });\r\n\r\n      // Do some animations\r\n      const isMoving = vel.x !== 0 || vel.y !== 0;\r\n\r\n      if (!sprite.manualAnimation) {\r\n        sprite.playAnimation(isMoving ? \"walk\" : \"idle\");\r\n      }\r\n\r\n      // Call this to ensure animations are player\r\n      sprite.advance();\r\n    },\r\n    exit: () => onExit()\r\n  };\r\n};\r\n","import StateMachine from \"../../managers/stateManager\";\r\nimport { wait } from \"../../common/aiHelpers\";\r\nimport { getRandomIntInclusive } from \"../../common/helpers\";\r\nimport aiFollowPathState from \"../../states/aiFollowPathState\";\r\nimport aiIdleState from \"../../states/aiIdleState\";\r\n\r\nexport default () => {\r\n  const entityStateMachine = StateMachine();\r\n  let brainData = {};\r\n\r\n  const behaviours = {\r\n    talkMode: () => {\r\n      entityStateMachine.push(\r\n        aiIdleState({\r\n          props: {\r\n            sprite: brainData.sprite\r\n          }\r\n        })\r\n      );\r\n    },\r\n    idleAndRoam: () => {\r\n      entityStateMachine.push(\r\n        aiIdleState({\r\n          props: {\r\n            sprite: brainData.sprite\r\n          },\r\n          onEntry: async () => {\r\n            // Sticking this here rather than in update. No idea if it's right.\r\n            await wait(getRandomIntInclusive(500, 1500));\r\n            entityStateMachine.popState(\"idle\");\r\n          },\r\n          onExit: () => behaviours.followPath()\r\n        })\r\n      );\r\n    },\r\n    followPath: () => {\r\n      entityStateMachine.push(\r\n        aiFollowPathState({\r\n          props: brainData,\r\n          onExit: () => {\r\n            // Hmm... this is a bit weird I feel...\r\n            behaviours.idleAndRoam();\r\n          }\r\n        })\r\n      );\r\n    }\r\n  };\r\n\r\n  return {\r\n    bootstrap: props => (brainData = { ...props }),\r\n    update: () => entityStateMachine.update(),\r\n    start: () => behaviours.idleAndRoam(),\r\n    onConvoEnter: () => {\r\n      // TODO: Bug, sometimes stops animations when you clear state like this.\r\n      entityStateMachine.clearStates();\r\n      behaviours.talkMode();\r\n    },\r\n    onConvoExit: () => {\r\n      entityStateMachine.clearStates();\r\n      behaviours.idleAndRoam();\r\n    }\r\n  };\r\n};\r\n","import talkOnly from \"./scripts/talkOnly\";\r\nimport npcRoam from \"./scripts/npcRoam\";\r\n\r\nexport default useScript => {\r\n  const scriptList = [\r\n    {\r\n      id: \"talkOnly\",\r\n      scr: talkOnly\r\n    },\r\n    {\r\n      id: \"npcRoam\",\r\n      scr: npcRoam\r\n    }\r\n  ];\r\n\r\n  const loadedScript = useScript\r\n    ? scriptList.find(x => x.id === useScript).scr()\r\n    : scriptList[0].scr();\r\n\r\n  return {\r\n    bootstrap: props => loadedScript.bootstrap(props),\r\n    start: () => loadedScript.start(),\r\n    update: () => loadedScript.update(),\r\n    onConvoEnter: () => loadedScript.onConvoEnter(),\r\n    onConvoExit: () => loadedScript.onConvoExit(),\r\n    onBattleEnter: () => {},\r\n    onBattleExit: () => {}\r\n  };\r\n};\r\n","import { flipSprite } from \"../common/spriteFunctions\";\r\nimport { uniqueId } from \"../common/helpers\";\r\nimport { Sprite, imageAssets, SpriteSheet } from \"kontra\";\r\nimport aiLoader from \"../ai/aiLoader\";\r\n\r\nexport default ({\r\n  id,\r\n  x,\r\n  y,\r\n  z = 1,\r\n  customProperties = {},\r\n  entityData = null,\r\n  aiPathGrid = null,\r\n  collisionMethod = (layer, sprite) => {}\r\n}) => {\r\n  if (!id) {\r\n    throw new Error(\r\n      \"Entity is fairly useless without an id, you should add one.\"\r\n    );\r\n  }\r\n\r\n  const {\r\n    aiScript,\r\n    name,\r\n    type,\r\n    animations,\r\n    frameWidth,\r\n    frameHeight,\r\n    sheet,\r\n    collisionBodyOptions = null,\r\n    manualAnimation = false,\r\n    controlledByUser = false,\r\n    collidesWithTiles = true,\r\n    collidesWithPlayer = true\r\n  } = entityData;\r\n\r\n  let spriteSheet = SpriteSheet({\r\n    image: imageAssets[sheet],\r\n    frameWidth,\r\n    frameHeight,\r\n    animations\r\n  });\r\n\r\n  const ai = aiLoader(aiScript);\r\n\r\n  const sprite = Sprite({\r\n    instId: uniqueId(id),\r\n    id,\r\n    type,\r\n    name,\r\n    x,\r\n    y,\r\n    z,\r\n    anchor: { x: 0.5, y: 0.5 },\r\n    customProperties,\r\n    radius: 1,\r\n    animations: spriteSheet.animations,\r\n    collidesWithTiles,\r\n    controlledByUser,\r\n    collisionBodyOptions,\r\n    collidesWithPlayer,\r\n    manualAnimation,\r\n    onConvoEnter: () => ai.onConvoEnter(),\r\n    onConvoExit: () => ai.onConvoExit(),\r\n    lookAt: ({ x, y }) => {\r\n      flipSprite({\r\n        direction: {\r\n          x: sprite.x > x ? -1 : 1,\r\n          y: sprite.y > y ? -1 : 1\r\n        },\r\n        sprite\r\n      });\r\n    },\r\n    update: () => ai.update()\r\n  });\r\n\r\n  ai.bootstrap({ sprite, aiPathGrid });\r\n  ai.start();\r\n\r\n  return sprite;\r\n};\r\n","import { uniqueId } from \"../common/helpers\";\r\nimport { Sprite, imageAssets, SpriteSheet } from \"kontra\";\r\n\r\nexport default ({\r\n  id,\r\n  x,\r\n  y,\r\n  z = 1,\r\n  customProperties = {},\r\n  entityData = null,\r\n  collisionMethod = (layer, sprite) => {}\r\n}) => {\r\n  if (!id) {\r\n    throw new Error(\r\n      \"Entity is fairly useless without an id, you should add one.\"\r\n    );\r\n  }\r\n\r\n  const {\r\n    name,\r\n    type,\r\n    animations,\r\n    frameWidth,\r\n    frameHeight,\r\n    sheet,\r\n    collisionBodyOptions = null,\r\n    manualAnimation = false,\r\n    controlledByUser = false,\r\n    collidesWithTiles = true,\r\n    collidesWithPlayer = true\r\n  } = entityData;\r\n\r\n  let spriteSheet = SpriteSheet({\r\n    image: imageAssets[sheet],\r\n    frameWidth,\r\n    frameHeight,\r\n    animations\r\n  });\r\n\r\n  /* Id should really be named 'class' since its re-used. */\r\n  const sprite = Sprite({\r\n    instId: uniqueId(id),\r\n    id,\r\n    type,\r\n    name,\r\n    x,\r\n    y,\r\n    z,\r\n    anchor: { x: 0.5, y: 0.5 },\r\n    customProperties,\r\n    radius: 1,\r\n    animations: spriteSheet.animations,\r\n    collidesWithTiles,\r\n    controlledByUser,\r\n    collisionBodyOptions,\r\n    collidesWithPlayer,\r\n    manualAnimation,\r\n    onAttacked: () => {\r\n      // Push an internal state for damage effect (whatever that's going to be)\r\n      console.log(id);\r\n    },\r\n    update: () => {\r\n      // Static entities may still have anims so add them in later.\r\n      // Anim code...\r\n      // Call this to ensure animations are player\r\n      sprite.advance();\r\n    }\r\n  });\r\n\r\n  return sprite;\r\n};\r\n","import { uniqueId } from \"../common/helpers\";\r\nimport { Sprite, imageAssets, SpriteSheet } from \"kontra\";\r\n\r\nexport default ({\r\n  id,\r\n  x,\r\n  y,\r\n  z = 1,\r\n  customProperties = {},\r\n  entityData = null,\r\n  collisionMethod = (layer, sprite) => {}\r\n}) => {\r\n  if (!id) {\r\n    throw new Error(\r\n      \"Entity is fairly useless without an id, you should add one.\"\r\n    );\r\n  }\r\n\r\n  const {\r\n    name,\r\n    type,\r\n    animations,\r\n    frameWidth,\r\n    frameHeight,\r\n    sheet,\r\n    collisionBodyOptions = null,\r\n    manualAnimation = false,\r\n    controlledByUser = false,\r\n    collidesWithTiles = true,\r\n    collidesWithPlayer = true\r\n  } = entityData;\r\n\r\n  let spriteSheet = SpriteSheet({\r\n    image: imageAssets[sheet],\r\n    frameWidth,\r\n    frameHeight,\r\n    animations\r\n  });\r\n\r\n  /* Id should really be named 'class' since its re-used. */\r\n  const sprite = Sprite({\r\n    instId: uniqueId(id),\r\n    id,\r\n    type,\r\n    name,\r\n    x,\r\n    y,\r\n    z,\r\n    anchor: { x: 0.5, y: 0.5 },\r\n    customProperties,\r\n    radius: 1,\r\n    animations: spriteSheet.animations,\r\n    collidesWithTiles,\r\n    controlledByUser,\r\n    collisionBodyOptions,\r\n    collidesWithPlayer,\r\n    manualAnimation,\r\n    onAttacked: () => {\r\n      // Push an internal state for damage effect (whatever that's going to be)\r\n      console.log(id);\r\n    },\r\n    update: () => {\r\n      // Static entities may still have anims so add them in later.\r\n      // Anim code...\r\n      // Call this to ensure animations are player\r\n      sprite.advance();\r\n    }\r\n  });\r\n\r\n  return sprite;\r\n};\r\n","import { TileEngine } from \"kontra\";\r\nimport Player from \"../sprites/player\";\r\nimport Npc from \"../sprites/npc\";\r\nimport Fixed from \"../sprites/fixed\";\r\nimport Pickup from \"../sprites/pickup\";\r\nimport { ENTITY_TYPE } from \"../common/consts\";\r\nimport store from \"../services/store\";\r\n\r\nexport default () => {\r\n  // TODO: I think it's time to move entity and quest stuff out of world manager.\r\n  return {\r\n    createWorld: ({ areaId, playerStartId }) => {\r\n      const { entities, mapKey } = store\r\n        .getWorldData()\r\n        .find(x => x.areaId === areaId);\r\n\r\n      const map = store.getMapData(mapKey);\r\n      const tileEngine = TileEngine(map);\r\n\r\n      const aiPathLayer = tileEngine.layers.find(x => x.id === 2);\r\n      let aiPathGrid = [];\r\n\r\n      for (let i = 0; i < aiPathLayer.width; i++) {\r\n        aiPathGrid.push([]);\r\n        for (let j = 0; j < aiPathLayer.height; j++) {\r\n          const t = tileEngine.tileAtLayer(\"AIPath\", { row: i, col: j });\r\n          aiPathGrid[i].push(t);\r\n        }\r\n      }\r\n\r\n      const playerStart = entities.find(\r\n        x => x.customProperties.playerStartId === playerStartId\r\n      );\r\n\r\n      const playerEntityData = store\r\n        .getEntityData()\r\n        .find(x => x.id === \"player\");\r\n\r\n      const player = Player({\r\n        id: \"player\",\r\n        x: playerStart.x,\r\n        y: playerStart.y,\r\n        entityData: playerEntityData,\r\n        collisionMethod: (layer, sprite) => {\r\n          // If 16x16\r\n          const spriteBody = {\r\n            x: 0,\r\n            y: 4,\r\n            width: 10,\r\n            height: 8\r\n          };\r\n\r\n          const t = {\r\n            width: spriteBody.width,\r\n            height: spriteBody.height,\r\n            x: sprite.x + spriteBody.x,\r\n            y: sprite.y + spriteBody.y,\r\n            anchor: sprite.anchor\r\n          };\r\n\r\n          return tileEngine.layerCollidesWith(layer, t);\r\n        }\r\n      });\r\n\r\n      tileEngine.addObject(player);\r\n\r\n      return {\r\n        mapKey,\r\n        tileEngine,\r\n        aiPathGrid,\r\n        player,\r\n        sprites: entities\r\n          .map(entity => {\r\n            const { id, customProperties } = entity;\r\n            const entityData = store.getEntityData().find(ent => ent.id === id);\r\n\r\n            let ent = null;\r\n\r\n            switch (entityData.type) {\r\n              case ENTITY_TYPE.PICKUP:\r\n                const alreadyCollected = store.getEntityFromStore(\r\n                  customProperties.worldId,\r\n                  \"worldId\"\r\n                );\r\n                if (alreadyCollected) return null;\r\n                ent = Pickup({\r\n                  ...entity,\r\n                  entityData,\r\n                  collisionMethod: (layer, sprite) =>\r\n                    tileEngine.layerCollidesWith(layer, sprite)\r\n                });\r\n                break;\r\n              case ENTITY_TYPE.NPC:\r\n                ent = Npc({\r\n                  ...entity,\r\n                  entityData,\r\n                  aiPathGrid,\r\n                  collisionMethod: (layer, sprite) =>\r\n                    tileEngine.layerCollidesWith(layer, sprite)\r\n                });\r\n                break;\r\n              case ENTITY_TYPE.DOOR:\r\n                // Doors may be animated, this is just temporary usage.\r\n                ent = Fixed({\r\n                  ...entity,\r\n                  entityData,\r\n                  collisionMethod: (layer, sprite) =>\r\n                    tileEngine.layerCollidesWith(layer, sprite)\r\n                });\r\n                break;\r\n              case ENTITY_TYPE.FIXED:\r\n                ent = Fixed({\r\n                  ...entity,\r\n                  entityData,\r\n                  collisionMethod: (layer, sprite) =>\r\n                    tileEngine.layerCollidesWith(layer, sprite)\r\n                });\r\n                break;\r\n              default:\r\n                return null;\r\n            }\r\n\r\n            /* May wish to add a flag if you want to add it to tilemap or not */\r\n            tileEngine.addObject(ent);\r\n            return ent;\r\n          })\r\n          .filter(e => e)\r\n          .concat([player])\r\n      };\r\n    }\r\n  };\r\n};\r\n","export default (reactions = []) => {\n  return {\n    get: type => reactions.find(reaction => reaction.type === type)\n  };\n};\n","/* Credits\r\n * Asset Pack:\r\n * https://pixel-poem.itch.io/dungeon-assetpuck\r\n * https://0x72.itch.io/dungeontileset-ii\r\n * http://www.photonstorm.com/phaser/pixel-perfect-scaling-a-phaser-game\r\n */\r\n\r\n/* Libs */\r\nimport { init, GameLoop, load, initKeys } from \"kontra\";\r\n\r\n/* Common utils, objects and events */\r\nimport { circleCollision, sortByDist } from \"./common/helpers\";\r\nimport { ENTITY_TYPE } from \"./common/consts\";\r\nimport {\r\n  allOff,\r\n  on,\r\n  emit,\r\n  EV_SCENECHANGE,\r\n  EV_UPDATECONVOTRIGGER,\r\n  EV_GIVEQUEST\r\n} from \"./common/events\";\r\n\r\n/* Store services */\r\nimport store from \"./services/store\";\r\n\r\n/* States for global use */\r\nimport startConvo from \"./states/startConvoState\";\r\nimport fieldState from \"./states/fieldState\";\r\nimport curtainState from \"./states/curtainState\";\r\n\r\n/* Game managers */\r\nimport SceneManager from \"./managers/sceneManager\";\r\nimport WorldManager from \"./managers/worldManager\";\r\nimport ReactionManager from \"./managers/reactionManager\";\r\nimport StateMachine from \"./managers/stateManager\";\r\n\r\n/* Screen size (16:9) */\r\nconst resolution = {\r\n  width: 256,\r\n  height: 192,\r\n  scale: 3\r\n};\r\n\r\n/* Canvas initialization */\r\n// Make absolutely sure we have to use two canvases (I'm not convinced)\r\nconst { canvas: gameCanvas } = init(\"gameCanvas\");\r\nconst scaledCanvas = document.getElementById(\"scaledCanvas\");\r\nconst rootElement = document.getElementById(\"root\");\r\n\r\n/* Set correct scales to be universal */\r\ngameCanvas.width = resolution.width;\r\ngameCanvas.height = resolution.height;\r\n\r\n/* Scaled canvas works in the same way only we multiply to zoom it in */\r\nscaledCanvas.width = resolution.width * resolution.scale;\r\nscaledCanvas.height = resolution.height * resolution.scale;\r\n\r\n/* Apply to root element also */\r\nrootElement.style.width = resolution.width * resolution.scale + \"px\";\r\nrootElement.style.height = resolution.height * resolution.scale + \"px\";\r\n\r\n/* Remove smoothing */\r\nconst gameCanvasCtx = gameCanvas.getContext(\"2d\");\r\ngameCanvasCtx.imageSmoothingEnabled = false;\r\ngameCanvasCtx.webkitImageSmoothingEnabled = false;\r\ngameCanvasCtx.mozImageSmoothingEnabled = false;\r\ngameCanvasCtx.msImageSmoothingEnabled = false;\r\ngameCanvasCtx.oImageSmoothingEnabled = false;\r\n\r\nconst ctx = scaledCanvas.getContext(\"2d\");\r\nctx.imageSmoothingEnabled = false;\r\nctx.webkitImageSmoothingEnabled = false;\r\nctx.mozImageSmoothingEnabled = false;\r\nctx.msImageSmoothingEnabled = false;\r\nctx.oImageSmoothingEnabled = false;\r\n\r\n/* Primary field scene */\r\nconst FieldScene = sceneProps => {\r\n  /* World creation (can we not have entities just in store, it's a bit confusing) */\r\n  const { createWorld } = WorldManager();\r\n  const { sprites, player, tileEngine } = createWorld(sceneProps);\r\n\r\n  let spriteCache = sprites.filter(spr => spr.isAlive());\r\n\r\n  // Temporary: Use this to erase storage data\r\n  // NOTE: This brings to light problems with integrity of data and allowing\r\n  // to push the same data (such as quests).\r\n  //store.resetEntityStates();\r\n\r\n  /* Main states creation */\r\n  const sceneStateMachine = StateMachine();\r\n  const screenEffectsStateMachine = StateMachine();\r\n\r\n  /* Decide what happens on different player interaction events (was separated, seemed pointless at this stage) */\r\n  const reactionManager = ReactionManager([\r\n    {\r\n      type: ENTITY_TYPE.DOOR,\r\n      /* First available refers to the first given collision. So it might not always be what\r\n      what you want it to be. This needs to be made a bit more robust. */\r\n      reactionEvent: (interactible, actors = []) => {\r\n        // TODO: Entities should manage their own animations (same problem seen elsewhere)\r\n        //interactible.playAnimation(\"default\");\r\n        screenEffectsStateMachine.push(\r\n          curtainState({\r\n            id: \"curtain\",\r\n            ctx,\r\n            direction: 1,\r\n            onFadeComplete: () => {\r\n              // TODO: This needs testing properly. Events in general.\r\n              allOff([EV_SCENECHANGE, EV_GIVEQUEST, EV_UPDATECONVOTRIGGER]);\r\n              /* Player start becomes part of the collider data so we attempt to use that. */\r\n              emit(EV_SCENECHANGE, {\r\n                areaId: interactible.customProperties.goesTo,\r\n                playerStartId: interactible.customProperties.playerStartId\r\n              });\r\n            }\r\n          })\r\n        );\r\n      }\r\n    },\r\n    {\r\n      type: ENTITY_TYPE.NPC,\r\n      reactionEvent: (interactible, actors = []) => {\r\n        const { customProperties } = interactible;\r\n\r\n        /* So we 'could' get the data from the sprite but it's too static. Instead\r\n        we should use the lookup table and ask it for what we need. */\r\n        const interactibleProgressData = store\r\n          .getProgressDataStore()\r\n          .find(i => i.props.entityId === interactible.id);\r\n\r\n        if (!Object.keys(customProperties).length) return;\r\n\r\n        if (customProperties.triggerConvo) {\r\n          player.onConvoEnter();\r\n\r\n          sceneStateMachine.push(\r\n            startConvo({\r\n              startId: interactibleProgressData !== undefined\r\n                ? interactibleProgressData.props.id\r\n                : customProperties.triggerConvo,\r\n\r\n              onEntry: () =>\r\n                actors.filter(x => x.id !== \"player\").map(spr => {\r\n                  spr.onConvoEnter();\r\n                  spr.lookAt({\r\n                    x: player.x,\r\n                    y: player.y\r\n                  });\r\n                }),\r\n              onExit: () => actors.map(spr => spr.onConvoExit())\r\n            })\r\n          );\r\n        }\r\n      }\r\n    },\r\n    {\r\n      type: ENTITY_TYPE.PICKUP,\r\n      reactionEvent: (interactible, actors = []) => {\r\n        interactible.ttl = 0;\r\n        store.updatePickupData(interactible);\r\n      }\r\n    }\r\n  ]);\r\n\r\n  // TODO: Can we please not have to pass everything in like this? It's a bit too coupled.\r\n  /* Start game within FieldState */\r\n  sceneStateMachine.push(\r\n    fieldState({\r\n      id: \"field\",\r\n      sprites,\r\n      tileEngine,\r\n      reactionManager\r\n    })\r\n  );\r\n\r\n  /* Open up the first scene with a fade */\r\n  screenEffectsStateMachine.push(\r\n    curtainState({\r\n      id: \"curtain\",\r\n      ctx,\r\n      direction: -1\r\n    })\r\n  );\r\n\r\n  /* Primary loop */\r\n  return GameLoop({\r\n    update: () => {\r\n      /* Add a flag to sprite to enable/disable collision checks */\r\n      /* Check for anything dead (GC does the rest) */\r\n      spriteCache = spriteCache.filter(spr => spr.isAlive());\r\n\r\n      /* Player to useable collision with other entities (not tiles) */\r\n      const playerCollidingWith = sortByDist(\r\n        player,\r\n        circleCollision(\r\n          player,\r\n          spriteCache.filter(s => s.id !== \"player\" && s.collidesWithPlayer)\r\n        )\r\n      );\r\n\r\n      /* Update all sprites */\r\n      spriteCache.map(sprite => sprite.update());\r\n\r\n      // ...\r\n      player.isColliding = playerCollidingWith.length > 0;\r\n\r\n      /* Origin is the controller of the scene, so 9/10 that'll probably be the player */\r\n      sceneStateMachine.update({\r\n        origin: player,\r\n        collisions: playerCollidingWith\r\n      });\r\n\r\n      /// Under serious testing\r\n      /*\r\n      Take your map width and height. Say it's 128x128.\r\n      \r\n      If player is:\r\n      x greater than 36 or x less than map width minus 36\r\n      y greater than 36 or y less than map height minus 36\r\n      */\r\n\r\n      //if (tileEngine.mapwidth > resolution.width) {\r\n      tileEngine.sx = player.x - resolution.width / 2;\r\n      //}\r\n\r\n      //if (player.y > pad) {\r\n      tileEngine.sy = player.y - resolution.height / 2; //player.y - 120;\r\n      //}\r\n    },\r\n    render: () => {\r\n      /* Instruct tileEngine to update its frame */\r\n      // tileEngine.render();\r\n      tileEngine.renderLayer(\"rearDecor\");\r\n      tileEngine.renderLayer(\"middleDecor\");\r\n\r\n      /* Edit z-order based on 'y' then change render order */\r\n      spriteCache\r\n        .sort((a, b) => Math.round(a.y - a.z) - Math.round(b.y - b.z))\r\n        .forEach(sprite => sprite.render());\r\n\r\n      /* Update any screen effects that are running */\r\n      screenEffectsStateMachine.update();\r\n\r\n      /* Any layers that need to overlap everything go below here */\r\n      tileEngine.renderLayer(\"forwardDecor\");\r\n\r\n      /* Project the actual game canvas on to the scaled canvas */\r\n      ctx.drawImage(\r\n        gameCanvas,\r\n        0,\r\n        0,\r\n        resolution.width,\r\n        resolution.height,\r\n        0,\r\n        0,\r\n        scaledCanvas.width,\r\n        scaledCanvas.height\r\n      );\r\n    }\r\n  });\r\n};\r\n\r\n/* Make sure to embed your tilesets or it'll run in to problems,\r\nTODO: Can we also const the dataKeys across the board plz. */\r\nload(\r\n  \"assets/tileimages/test.png\",\r\n  \"assets/tiledata/test.json\",\r\n  \"assets/tiledata/test2.json\",\r\n  \"assets/tiledata/test3.json\",\r\n  \"assets/entityimages/little_devil.png\",\r\n  \"assets/entityimages/little_orc.png\",\r\n  \"assets/entityimages/little_bob.png\",\r\n  \"assets/gameData/conversationData.json\",\r\n  \"assets/gameData/entityData.json\",\r\n  \"assets/gameData/worldData.json\",\r\n  \"assets/gameData/questData.json\"\r\n).then(assets => {\r\n  // Optional\r\n  console.log(\"Initialised assets.\");\r\n  store.resetEntityStates();\r\n\r\n  // Should these be done here? Or further up? Do they need to be unsubbed each scene load?\r\n  /* Not sure if we're doing quest giving in the world manager frankly,\r\n  or even the progress cache. So will move all this later on. */\r\n  /* I'm not 100% sure if an integrity check needs to be done to make sure\r\n  the right convo is loaded. As it technically the data should be fairly pristine.\r\n  Keep an eye on it anyway. */\r\n  on(EV_GIVEQUEST, d => store.updateQuestData(d));\r\n  on(EV_UPDATECONVOTRIGGER, d => store.updateProgress(d));\r\n\r\n  // Init things\r\n  initKeys();\r\n\r\n  /// Note: There's now a scene manager in kontra that can be used\r\n  // Hook up player start todo\r\n  const sceneManager = SceneManager({ sceneObject: FieldScene });\r\n\r\n  /* First load instigates a player start so this might be found from saveData\r\n  or if at the very beginning of a game, passed in directly.\r\n  If we look at the worldData, the playerStart id is actually linked to one of the\r\n  entities that gets loaded in. This in theory means you can make anything a player start\r\n  so long as you specify the right id for it. That being said, you do have to make sure\r\n  both of them exist in the same context, otherwise you'll never get access to it.\r\n  */\r\n  sceneManager.loadScene({ areaId: \"area1\", playerStartId: \"area1_entrance\" });\r\n\r\n  on(EV_SCENECHANGE, props => sceneManager.loadScene({ ...props }));\r\n});\r\n"]}